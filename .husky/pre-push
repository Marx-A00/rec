#!/usr/bin/env sh
set -e  # Exit immediately if any command fails

export PATH="/opt/homebrew/bin:/usr/local/bin:$PATH"

echo "ğŸš€ Running pre-push checks..."

# Check if we're pushing to main/master
protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

if [ "$current_branch" = "$protected_branch" ]; then
    echo "ğŸ›¡ï¸  Pushing to protected branch $protected_branch"
    echo "ğŸ”„ Running full test suite..."

    # Build check (ensures code compiles and types are valid)
    echo "ğŸ—ï¸  Build checking..."
    pnpm build

    echo "âœ… All checks passed! Pushing to $protected_branch"
else
    echo "ğŸ“ Quick checks for feature branch..."
    # Type check (must pass)
    pnpm type-check
    echo "âœ… Feature branch checks passed!"
fi

exit 0 