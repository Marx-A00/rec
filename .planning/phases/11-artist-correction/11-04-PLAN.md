---
phase: 11-artist-correction
plan: 04
type: execute
wave: 3
depends_on: ["11-03"]
files_modified:
  - src/hooks/useArtistCorrectionModalState.ts
  - src/components/admin/correction/artist/ArtistCorrectionModal.tsx
  - src/components/admin/correction/artist/search/ArtistSearchView.tsx
  - src/components/admin/correction/artist/search/ArtistSearchCard.tsx
  - src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
  - src/components/admin/correction/artist/apply/ArtistApplyView.tsx
  - src/app/admin/music-database/page.tsx
autonomous: false

must_haves:
  truths:
    - "Fix Data button appears on artist rows in admin table"
    - "Artist correction modal follows same step flow as album correction"
    - "Search results show disambiguation and top releases"
    - "Preview shows all artist fields with diff highlighting"
    - "Apply uses selective field checkboxes"
  artifacts:
    - path: "src/hooks/useArtistCorrectionModalState.ts"
      provides: "Session state management for artist correction modal"
      exports: ["useArtistCorrectionModalState"]
    - path: "src/components/admin/correction/artist/ArtistCorrectionModal.tsx"
      provides: "Main modal component with step navigation"
      exports: ["ArtistCorrectionModal"]
    - path: "src/app/admin/music-database/page.tsx"
      provides: "Fix Data button on artist rows"
      contains: "setCorrectionArtist"
  key_links:
    - from: "src/components/admin/correction/artist/ArtistCorrectionModal.tsx"
      to: "src/generated/graphql.ts"
      via: "Generated GraphQL hooks"
      pattern: "useSearchArtistCorrectionCandidates"
    - from: "src/app/admin/music-database/page.tsx"
      to: "src/components/admin/correction/artist/ArtistCorrectionModal.tsx"
      via: "Modal render with artist prop"
      pattern: "ArtistCorrectionModal.*artist="
---

<objective>
Create the artist correction modal UI and add "Fix Data" button to artist rows in admin table.

Purpose: Enable admins to fix artist data through the same familiar search/preview/apply workflow.
Output: Complete artist correction UI with entry point in admin music database.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-artist-correction/11-RESEARCH.md
@.planning/phases/11-artist-correction/11-CONTEXT.md
@.planning/phases/11-artist-correction/11-03-SUMMARY.md

# Album modal for pattern reference
@src/hooks/useCorrectionModalState.ts
@src/components/admin/correction/CorrectionModal.tsx
@src/components/admin/correction/search/SearchView.tsx
@src/components/admin/correction/search/SearchResultCard.tsx
@src/components/admin/correction/preview/PreviewView.tsx
@src/components/admin/correction/apply/ApplyView.tsx
@src/components/admin/correction/StepIndicator.tsx
@src/app/admin/music-database/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create artist modal state hook and modal shell</name>
  <files>
    src/hooks/useArtistCorrectionModalState.ts
    src/components/admin/correction/artist/ArtistCorrectionModal.tsx
  </files>
  <action>
Create state hook and modal shell for artist correction, adapting album patterns.

In useArtistCorrectionModalState.ts:
- Mirror useCorrectionModalState structure
- Storage key prefix: 'artist-correction-modal-state-'
- Track: currentStep (0-3), searchQuery (just artist name), searchOffset, selectedArtistMbid, isApplied
- 4 steps: Current (0), Search (1), Preview (2), Apply (3)
- No manual edit mode for v1 (artist correction is simpler)
- Include all setters, nextStep, prevStep, clearState

In ArtistCorrectionModal.tsx:
- Props: { artist: Artist | null, onClose: () => void, onSuccess: () => void }
- Same modal styling as CorrectionModal: max-w-[1100px], dark zinc theme
- StepIndicator with 4 steps: "Current", "Search", "Preview", "Apply"
- Fetch artist data internally via GraphQL (same pattern as CorrectionModal)
- Render appropriate view based on currentStep:
  - Step 0: CurrentDataView (reuse/adapt from album)
  - Step 1: ArtistSearchView
  - Step 2: ArtistPreviewView  
  - Step 3: ArtistApplyView
- Close button, step navigation controls
  </action>
  <verify>Run `pnpm type-check` - hook and modal compile</verify>
  <done>ArtistCorrectionModal renders with step navigation and session persistence</done>
</task>

<task type="auto">
  <name>Task 2: Create search and preview views</name>
  <files>
    src/components/admin/correction/artist/search/ArtistSearchView.tsx
    src/components/admin/correction/artist/search/ArtistSearchCard.tsx
    src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
  </files>
  <action>
Create search and preview UI components for artist correction.

In ArtistSearchCard.tsx:
- Display: artist name (large), disambiguation (smaller subtitle)
- Type badge: Person, Group, etc.
- Country flag/code if available
- Top releases list (2-3 items with year and type)
- MB score as percentage match
- onClick handler to select result

In ArtistSearchView.tsx:
- Search input pre-populated with current artist name
- Search button triggers useSearchArtistCorrectionCandidatesQuery
- Loading skeleton during search
- Map results to ArtistSearchCard components
- NoResultsState reuse when empty
- On card click: setSelectedArtistMbid, go to step 2

In ArtistPreviewView.tsx:
- Use useGetArtistCorrectionPreviewQuery(artistId, selectedMbid)
- PreviewSkeleton during loading
- Show "X albums in database by this artist" warning
- Field comparison for all artist fields:
  - name, disambiguation, country, type, area
  - beginDate, endDate (with "Partial date" note)
  - gender (only show if type is Person)
  - External IDs: MBID, IPI, ISNI
- Reuse FieldComparison component where possible
- "Select Fields & Apply" button -> step 3
- "Back to Search" button -> step 1
  </action>
  <verify>Run `pnpm type-check` - search and preview components compile</verify>
  <done>ArtistSearchView shows results with disambiguation, ArtistPreviewView shows field diffs</done>
</task>

<task type="auto">
  <name>Task 3: Create apply view and add entry point</name>
  <files>
    src/components/admin/correction/artist/apply/ArtistApplyView.tsx
    src/app/admin/music-database/page.tsx
  </files>
  <action>
Create apply view and add Fix Data button to artist rows.

In ArtistApplyView.tsx:
- Field selection checkboxes in sections:
  - Metadata: name, disambiguation, country, type, area, beginDate, endDate, gender
  - External IDs: musicbrainzId, ipi, isni
- Show filtered diffs based on selections (same pattern as album)
- "Apply Corrections" button calls useApplyArtistCorrectionMutation
- Pass selections, expectedUpdatedAt, preview data
- Success: show toast, set isApplied, auto-close after 1.5s
- Error: show inline error with stack trace

In page.tsx (admin music-database):
1. Add state: const [correctionArtist, setCorrectionArtist] = useState<Artist | null>(null)
2. Add Fix Data button in artist row Actions cell (before Enrich dropdown):
   - Same pattern as album Fix Data button
   - Wrench icon, ghost variant
   - Color based on dataQuality (red for LOW, zinc otherwise)
   - Tooltip: "Fix artist data"
   - onClick: setCorrectionArtist(artist)
3. Render ArtistCorrectionModal at bottom of component:
   - artist={correctionArtist}
   - onClose={() => setCorrectionArtist(null)}
   - onSuccess={() => { refetch artists, setCorrectionArtist(null) }}
4. Import ArtistCorrectionModal

CONTEXT.md decision: Fix Data button in BOTH artist rows AND detail page (detail page is out of scope for this plan - just table rows).
  </action>
  <verify>Run `pnpm type-check` and manually verify Fix Data button appears in artist rows</verify>
  <done>Fix Data button on artist rows opens ArtistCorrectionModal with full workflow</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete artist correction workflow: search, preview, apply with Fix Data entry point</what-built>
  <how-to-verify>
1. Run `pnpm dev`
2. Navigate to /admin/music-database
3. Switch to Artists tab
4. Find an artist with LOW data quality (red wrench icon)
5. Click the wrench "Fix Data" button
6. Verify modal opens at "Current" step showing artist info
7. Click "Search MusicBrainz" button
8. Verify search is pre-populated with artist name
9. Click Search, verify results show disambiguation and top releases
10. Click a result to go to Preview
11. Verify Preview shows all fields with diffs and "X albums" warning
12. Click "Select Fields & Apply"
13. Toggle some field checkboxes
14. Click "Apply Corrections"
15. Verify success toast and modal auto-closes
16. Verify artist row now shows updated data quality
  </how-to-verify>
  <resume-signal>Type "approved" if workflow works correctly, or describe issues</resume-signal>
</task>

</tasks>

<verification>
```bash
pnpm type-check
pnpm lint
pnpm dev
# Test full workflow manually per checkpoint instructions
```
</verification>

<success_criteria>
1. Fix Data button visible on artist rows in admin table
2. Modal opens with 4-step navigation (Current, Search, Preview, Apply)
3. Search results show disambiguation and top releases for identification
4. Preview shows all artist fields with proper diff highlighting
5. Apply uses checkbox selection for each field group
6. Corrections logged with admin user ID
7. Success feedback with toast and auto-close
</success_criteria>

<output>
After completion, create `.planning/phases/11-artist-correction/11-04-SUMMARY.md`
</output>
