---
phase: 11-artist-correction
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/correction/artist/types.ts
  - src/lib/correction/artist/search-service.ts
autonomous: true

must_haves:
  truths:
    - "Artist search returns MusicBrainz artists with disambiguation"
    - "Artist search results include top releases for identification"
    - "Search uses ADMIN priority for fast queue access"
  artifacts:
    - path: "src/lib/correction/artist/types.ts"
      provides: "ArtistSearchResult, ArtistCorrectionSearchOptions types"
      exports: ["ArtistSearchResult", "ArtistCorrectionSearchOptions", "ArtistTopRelease"]
    - path: "src/lib/correction/artist/search-service.ts"
      provides: "ArtistCorrectionSearchService class"
      exports: ["ArtistCorrectionSearchService"]
  key_links:
    - from: "src/lib/correction/artist/search-service.ts"
      to: "src/lib/musicbrainz/queue-service.ts"
      via: "getQueuedMusicBrainzService import"
      pattern: "getQueuedMusicBrainzService"
    - from: "src/lib/correction/artist/search-service.ts"
      to: "src/lib/queue/index.ts"
      via: "PRIORITY_TIERS.ADMIN"
      pattern: "PRIORITY_TIERS\\.ADMIN"
---

<objective>
Create the artist correction search service that searches MusicBrainz for artists.

Purpose: Enable admins to find the correct MusicBrainz artist to link with a database artist.
Output: ArtistCorrectionSearchService class with search method returning scored results with top releases.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-artist-correction/11-RESEARCH.md
@.planning/phases/11-artist-correction/11-CONTEXT.md

# Album search service for pattern reference
@src/lib/correction/types.ts
@src/lib/correction/search-service.ts
@src/lib/musicbrainz/queue-service.ts
@src/lib/queue/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create artist correction types</name>
  <files>src/lib/correction/artist/types.ts</files>
  <action>
Create type definitions for artist correction search, mirroring album correction types structure.

Define:
- ArtistTopRelease: { title: string, year?: string, type?: string } for disambiguation
- ArtistSearchResult: artistMbid, name, sortName, disambiguation?, type? (string not enum - "Person", "Group", "Orchestra", "Choir", "Character", "Other"), country?, area?, beginDate? (partial date string), endDate?, ended?, gender?, mbScore, topReleases?
- ArtistCorrectionSearchOptions: query, limit?, offset?
- ArtistCorrectionSearchResponse: results, totalCount?, hasMore, query

Key decisions from RESEARCH.md:
- Store artistType as string VARCHAR(20), not enum (MusicBrainz may add new types)
- Partial dates stored as-is ("1965" or "1965-03" or "1965-03-21")
- topReleases array helps disambiguate common artist names
  </action>
  <verify>Run `pnpm type-check` - no errors in artist types</verify>
  <done>ArtistSearchResult and related types exported from src/lib/correction/artist/types.ts</done>
</task>

<task type="auto">
  <name>Task 2: Create artist search service</name>
  <files>src/lib/correction/artist/search-service.ts</files>
  <action>
Create ArtistCorrectionSearchService class that searches MusicBrainz for artists.

Implementation:
1. Import getQueuedMusicBrainzService and PRIORITY_TIERS
2. Create search(query: string, limit?: number) method:
   - Call mbService.searchArtists(query, limit, 0, PRIORITY_TIERS.ADMIN)
   - For each result, fetch top 3 release groups via mbService.getArtistReleaseGroups
   - Map MusicBrainz response to ArtistSearchResult
   - Handle errors gracefully (if release fetch fails, return artist without releases)

3. mapToArtistResult helper:
   - Extract: id -> artistMbid, name, sort-name -> sortName
   - disambiguation, type, country
   - life-span.begin -> beginDate, life-span.end -> endDate, life-span.ended -> ended
   - gender (only meaningful for Person type)
   - area (from area.name if present)
   - score -> mbScore

Pattern reference: Follow CorrectionSearchService from src/lib/correction/search-service.ts

Export: ArtistCorrectionSearchService class and getArtistCorrectionSearchService factory function.
  </action>
  <verify>Run `pnpm type-check` - service compiles without errors</verify>
  <done>ArtistCorrectionSearchService.search() returns ArtistSearchResult[] with top releases</done>
</task>

</tasks>

<verification>
```bash
pnpm type-check
# Verify types compile

# Manual verification:
# - Check src/lib/correction/artist/types.ts exports all required types
# - Check src/lib/correction/artist/search-service.ts uses PRIORITY_TIERS.ADMIN
# - Verify search method signature matches pattern from album search
```
</verification>

<success_criteria>
1. ArtistSearchResult type includes all MusicBrainz artist fields
2. ArtistCorrectionSearchService uses ADMIN priority tier
3. Search results include topReleases for disambiguation
4. TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-artist-correction/11-01-SUMMARY.md`
</output>
