---
phase: 24-discogs-artist-search
plan: 03
type: execute
wave: 3
depends_on: ['24-02']
files_modified:
  - src/components/admin/correction/artist/search/ArtistSearchView.tsx
  - src/components/admin/correction/artist/search/ArtistSearchCard.tsx
autonomous: true

must_haves:
  truths:
    - 'ArtistSearchView calls Discogs query when source is discogs'
    - 'Discogs results appear in same card format as MusicBrainz'
    - 'Discogs cards have subtle visual distinction (orange accent)'
    - 'Selecting Discogs result transitions to preview step'
  artifacts:
    - path: 'src/components/admin/correction/artist/search/ArtistSearchView.tsx'
      provides: 'Source-aware query selection'
      contains: 'source:'
    - path: 'src/components/admin/correction/artist/search/ArtistSearchCard.tsx'
      provides: 'Visual distinction for Discogs results'
      contains: "source === 'discogs'"
  key_links:
    - from: 'src/components/admin/correction/artist/search/ArtistSearchView.tsx'
      to: 'src/generated/graphql.ts'
      via: 'useSearchArtistCorrectionCandidatesQuery with source param'
      pattern: 'source:.*correctionSource'
    - from: 'src/components/admin/correction/artist/search/ArtistSearchCard.tsx'
      to: 'result.source'
      via: 'Conditional styling based on source'
      pattern: 'isDiscogs|source.*discogs'
---

<objective>
Wire frontend to use Discogs search when source toggle is set to discogs.

Purpose: Admin sees Discogs artist search results in correction modal.
Output: ArtistSearchView passes source to GraphQL, results display with Discogs styling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-discogs-artist-search/24-CONTEXT.md
@.planning/phases/24-discogs-artist-search/24-02-SUMMARY.md

<!-- Existing frontend components -->
@src/components/admin/correction/artist/search/ArtistSearchView.tsx
@src/components/admin/correction/artist/search/ArtistSearchCard.tsx
@src/stores/useArtistCorrectionStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ArtistSearchView to pass source and support Discogs</name>
  <files>
    src/components/admin/correction/artist/search/ArtistSearchView.tsx
  </files>
  <action>
1. Add import for CorrectionSource enum:
   ```typescript
   import { CorrectionSource } from '@/generated/graphql';
   ```

2. Update the useSearchArtistCorrectionCandidatesQuery call to include source parameter.
   Find the existing query (currently only enabled for musicbrainz):

   ```typescript
   const { data, isLoading, error, isFetching } =
     useSearchArtistCorrectionCandidatesQuery(
       {
         query: searchQuery ?? '',
         limit: 10,
         source:
           correctionSource === 'discogs'
             ? CorrectionSource.Discogs
             : CorrectionSource.Musicbrainz,
       },
       {
         // Enable for BOTH sources now
         enabled: isSearchTriggered && !!searchQuery,
       }
     );
   ```

3. Remove the Discogs placeholder section entirely. Find and delete:
   ```typescript
   {/* Discogs placeholder (Phase 22+) */}
   {correctionSource === 'discogs' && (
     <div className='p-4 text-center text-zinc-500 border border-dashed border-zinc-700 rounded-lg'>
       <p className='text-sm'>Discogs artist search coming soon</p>
       <p className='text-xs text-zinc-600 mt-1'>
         Switch to MusicBrainz to search
       </p>
     </div>
   )}
   ```

4. Remove the `correctionSource === 'musicbrainz' &&` condition wrapper around the search content. The entire search UI should now render for both sources.

5. Update the no results message to be source-agnostic:
   ```typescript
   <p className='text-sm text-zinc-400 max-w-sm'>
     We couldn&apos;t find any matches. Try adjusting your search.
   </p>
   ```
   (Remove "in MusicBrainz")

6. Update the initial state message:
   ```typescript
   <div className='p-6 text-center text-zinc-400 border border-dashed border-zinc-700 rounded-lg'>
     Search for the correct artist data
   </div>
   ```
   (Remove "MusicBrainz")

7. Update skeleton condition to work for both sources:
   ```typescript
   const showSkeleton = isLoading && isSearchTriggered && searchOffset === 0;
   ```
   (Remove `correctionSource === 'musicbrainz'` check)
  </action>
  <verify>
TypeScript compiles: `pnpm type-check`
  </verify>
  <done>
ArtistSearchView passes source to GraphQL query, renders search UI for both MusicBrainz and Discogs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add visual distinction for Discogs results</name>
  <files>
    src/components/admin/correction/artist/search/ArtistSearchCard.tsx
  </files>
  <action>
1. The result prop type (ArtistCorrectionSearchResult) should now include source field from codegen. If type doesn't include source, add type assertion or optional chaining.

2. Add source-based styling. At the start of the component, detect Discogs:
   ```typescript
   export function ArtistSearchCard({ result, onClick }: ArtistSearchCardProps) {
     const handleClick = () => {
       onClick(result);
     };

     // Determine source for visual distinction
     const isDiscogs = result.source === 'discogs';
     const badgeText = isDiscogs ? 'DG' : 'MB';
   ```

3. Update the button className to include conditional styling:
   ```typescript
   <button
     type='button'
     onClick={handleClick}
     className={`w-full flex gap-3 p-3 text-left transition-colors duration-150 rounded-md ${
       isDiscogs
         ? 'border border-orange-900/30 hover:bg-orange-950/20'
         : 'hover:bg-zinc-800/50 active:bg-zinc-800'
     }`}
     aria-label={'Select ' + result.name}
   >
   ```

4. Update the source badge at the bottom of the card:
   ```typescript
   <Badge
     variant='outline'
     className={`ml-auto text-[10px] px-1.5 py-0 ${
       isDiscogs
         ? 'text-orange-400 border-orange-700'
         : 'text-zinc-500 border-zinc-700'
     }`}
   >
     {badgeText}
   </Badge>
   ```

5. This matches the styling pattern from SearchResultCard (album) which uses orange accent for Discogs results.
  </action>
  <verify>
TypeScript compiles: `pnpm type-check`
  </verify>
  <done>
Discogs artist result cards have subtle orange accent styling, visually distinguishing them from MusicBrainz results.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify result selection flow</name>
  <files>
    src/components/admin/correction/artist/search/ArtistSearchView.tsx
  </files>
  <action>
1. Verify that clicking a Discogs result calls the same handleResultClick:
   ```typescript
   const handleResultClick = (result: ArtistCorrectionSearchResult) => {
     store.getState().selectResult(result.artistMbid);
   };
   ```

   This works for Discogs because we use the Discogs artist ID in the artistMbid field (mapped in 24-01).

2. Verify the store's selectResult action transitions to preview step. The action should:
   - Store the selected artistMbid (which is Discogs ID for Discogs results)
   - Set step to 'preview'

3. The preview step (Phase 25) will need to detect the source and use appropriate service. For now, selection should work and transition to preview.

4. Test flow mentally:
   - Admin selects "Discogs" in source toggle
   - Admin types artist name and clicks Search
   - GraphQL query runs with source: DISCOGS
   - Resolver calls queuedDiscogsService.searchArtists
   - Results return with source: 'discogs'
   - Cards render with orange accent and 'DG' badge
   - Admin clicks result
   - selectResult stores the Discogs artist ID
   - Step transitions to preview (Phase 25 will handle Discogs preview)

5. No code changes needed here - just verification that the flow works end-to-end.
  </action>
  <verify>
`pnpm type-check` passes
`pnpm lint` passes or only unrelated warnings
  </verify>
  <done>
Discogs result selection uses same flow as MusicBrainz, storing Discogs artist ID for preview step.
  </done>
</task>

</tasks>

<verification>
1. `pnpm type-check` passes
2. `pnpm lint` passes (or only unrelated warnings)
3. ArtistSearchView uses source parameter in query
4. Discogs placeholder removed
5. ArtistSearchCard has conditional Discogs styling
6. No TypeScript errors in search components
</verification>

<success_criteria>
- Toggling to Discogs and searching shows Discogs artist results
- Discogs results have subtle orange border/accent
- 'DG' badge distinguishes from 'MB' badge
- Clicking Discogs result stores selection (preview handled in Phase 25)
- Same card format displays artist name, type, country
</success_criteria>

<output>
After completion, create `.planning/phases/24-discogs-artist-search/24-03-SUMMARY.md`
</output>
