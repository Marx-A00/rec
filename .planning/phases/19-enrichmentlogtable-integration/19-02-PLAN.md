---
phase: 19-enrichmentlogtable-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/admin/EnrichmentTimeline.tsx
  - src/components/admin/SkeletonTimeline.tsx
  - src/components/admin/EnrichmentTimelineModal.tsx
autonomous: true

must_haves:
  truths:
    - "EnrichmentTimeline accepts variant='compact' prop with smaller sizing and hidden descriptions"
    - "EnrichmentTimeline accepts truncateChildren prop to override default 15 threshold"
    - "SkeletonTimeline renders 2-3 shimmer placeholder items with accessibility attributes"
    - "EnrichmentTimelineModal opens a dialog showing full timeline variant"
  artifacts:
    - path: "src/components/admin/EnrichmentTimeline.tsx"
      provides: "Compact variant with smaller text, hidden descriptions, configurable truncation"
      contains: "variant"
    - path: "src/components/admin/SkeletonTimeline.tsx"
      provides: "Loading skeleton matching timeline structure"
      contains: "aria-busy"
    - path: "src/components/admin/EnrichmentTimelineModal.tsx"
      provides: "Dialog wrapper rendering full EnrichmentTimeline"
      contains: "DialogContent"
  key_links:
    - from: "src/components/admin/EnrichmentTimelineModal.tsx"
      to: "src/components/admin/EnrichmentTimeline.tsx"
      via: "imports and renders EnrichmentTimeline with variant='default'"
      pattern: "EnrichmentTimeline"
    - from: "src/components/admin/SkeletonTimeline.tsx"
      to: "src/components/ui/skeletons/Skeleton.tsx"
      via: "imports Skeleton component for shimmer effect"
      pattern: "Skeleton"
---

<objective>
Add compact variant to EnrichmentTimeline, create SkeletonTimeline loading state, and create EnrichmentTimelineModal for full inspection view.

Purpose: The table needs a compact timeline in expanded rows (less space, fewer details), a loading skeleton while children are fetched, and a "View full timeline" modal for detailed inspection. These are standalone components that don't depend on the table refactor.

Output: Modified EnrichmentTimeline with variant/truncation props, new SkeletonTimeline component, new EnrichmentTimelineModal component.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-enrichmentlogtable-integration/19-CONTEXT.md
@.planning/phases/19-enrichmentlogtable-integration/19-RESEARCH.md
@.planning/phases/18-timeline-component/18-02-SUMMARY.md

Key reference files:
@src/components/admin/EnrichmentTimeline.tsx (existing - will be modified)
@src/components/ui/skeletons/Skeleton.tsx (existing Skeleton component)
@src/components/ui/dialog.tsx (existing Dialog wrapper)
@src/components/admin/enrichment-timeline-utils.tsx (existing utilities)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add compact variant and configurable truncation to EnrichmentTimeline</name>
  <files>src/components/admin/EnrichmentTimeline.tsx</files>
  <action>
Modify `EnrichmentTimeline.tsx` to support a compact variant for table row context. Changes are ADDITIVE - default behavior must remain unchanged.

1. **Update EnrichmentTimelineProps interface:**
   ```typescript
   interface EnrichmentTimelineProps {
     logs: EnrichmentLog[];
     className?: string;
     variant?: 'default' | 'compact';       // NEW - default: 'default'
     maxHeight?: string;                      // NEW - optional max height with scroll
     truncateChildren?: number;               // NEW - override TRUNCATION_THRESHOLD
   }
   ```

2. **Update EnrichmentTimeline component:**
   - Destructure new props with defaults: `variant = 'default'`, `maxHeight`, `truncateChildren`
   - Compute derived values:
     ```typescript
     const truncationThreshold = truncateChildren ?? TRUNCATION_THRESHOLD;
     const isCompact = variant === 'compact';
     const showViewSwitcher = !isCompact;
     ```
   - Conditionally render ViewSwitcher only when `showViewSwitcher` is true
   - Pass `truncationThreshold` and `compact={isCompact}` to TimelineLogItem
   - Use `size='sm'` on Timeline when compact: `<Timeline size={isCompact ? 'sm' : undefined}>`
   - Apply maxHeight style if provided: `style={maxHeight ? { maxHeight, overflowY: 'auto' } : undefined}`

3. **Update TimelineLogItemProps interface:**
   ```typescript
   interface TimelineLogItemProps {
     log: EnrichmentLog;
     isExpanded: boolean;
     onToggleExpand: () => void;
     showAllChildren: boolean;
     onToggleShowAll: () => void;
     isChild?: boolean;
     compact?: boolean;               // NEW
     truncationThreshold?: number;     // NEW
   }
   ```

4. **Update TimelineLogItem component for compact mode:**
   - Accept `compact = false` and `truncationThreshold = TRUNCATION_THRESHOLD` props
   - Use `truncationThreshold` instead of hardcoded `TRUNCATION_THRESHOLD` for displayedChildren slice
   - Use `truncationThreshold` for hiddenCount calculation
   - Compact mode styling adjustments (all conditional on `compact`):
     - Icon: `className={cn('h-4 w-4', compact && 'h-3 w-3')}`
     - Title: `className={cn(isChild && 'text-sm', compact && 'text-xs')}`
     - Time: `className={cn('text-xs text-zinc-500', compact && 'text-[10px]')}`
     - Content padding: `className={cn(compact && 'mt-1 p-2')}`
     - Description: Only show when NOT compact OR when expanded: `{(!compact || isExpanded) && <TimelineDescription>...`
     - Error text: `className={cn('mt-1 text-xs text-red-400', compact && 'text-[10px]')}`
     - Children container: `className={cn('mt-4', compact && 'mt-2')}`
     - Nested Timeline size: `size={compact ? 'sm' : 'md'}`
   - Pass `compact` and `truncationThreshold` to recursive child TimelineLogItem renders

IMPORTANT: Do NOT change the default behavior. When `variant` is omitted or 'default', everything works exactly as before. The compact variant is purely additive.
  </action>
  <verify>
    Run `pnpm type-check` to verify no type errors.
    Run `pnpm lint src/components/admin/EnrichmentTimeline.tsx` to verify linting passes.
    Verify the component still exports as both named and default export.
  </verify>
  <done>
    EnrichmentTimeline accepts `variant`, `maxHeight`, and `truncateChildren` props.
    Compact variant hides view switcher, uses smaller text, hides descriptions by default.
    Default variant behavior unchanged.
    TimelineLogItem uses configurable truncation threshold.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create SkeletonTimeline and EnrichmentTimelineModal</name>
  <files>
    src/components/admin/SkeletonTimeline.tsx
    src/components/admin/EnrichmentTimelineModal.tsx
  </files>
  <action>
**SkeletonTimeline.tsx** - Create a new file at `src/components/admin/SkeletonTimeline.tsx`:

```typescript
'use client';

import { Skeleton } from '@/components/ui/skeletons/Skeleton';

interface SkeletonTimelineProps {
  itemCount?: number;
}

export function SkeletonTimeline({ itemCount = 3 }: SkeletonTimelineProps) {
  return (
    <div
      className="space-y-4 py-4"
      role="status"
      aria-busy="true"
      aria-live="polite"
    >
      <span className="sr-only">Loading timeline...</span>
      {Array.from({ length: itemCount }).map((_, i) => (
        <div key={i} className="flex gap-3">
          <Skeleton className="h-8 w-8 rounded-full shrink-0" />
          <div className="flex-1 space-y-2">
            <div className="flex items-center justify-between">
              <Skeleton className="h-4 w-32" />
              <Skeleton className="h-3 w-16" />
            </div>
            <Skeleton className="h-3 w-48" />
          </div>
        </div>
      ))}
    </div>
  );
}
```

The component renders `itemCount` placeholder items (default 3) with:
- Circular icon placeholder (h-8 w-8 rounded-full)
- Title placeholder (h-4 w-32)
- Time placeholder (h-3 w-16)
- Description placeholder (h-3 w-48)
- Accessibility: `role="status"`, `aria-busy="true"`, screen-reader text

Check the exact import path for the Skeleton component. It may be `@/components/ui/skeletons/Skeleton` or similar. Read the file first to confirm the export name.

**EnrichmentTimelineModal.tsx** - Create a new file at `src/components/admin/EnrichmentTimelineModal.tsx`:

```typescript
'use client';

import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { ExternalLink } from 'lucide-react';
import { EnrichmentTimeline } from './EnrichmentTimeline';
import type { EnrichmentLog } from '@/generated/graphql';

interface EnrichmentTimelineModalProps {
  parentLog: EnrichmentLog;
  childLogs: EnrichmentLog[];
}

export function EnrichmentTimelineModal({
  parentLog,
  childLogs,
}: EnrichmentTimelineModalProps) {
  const timelineLogs = childLogs.length > 0
    ? [parentLog, ...childLogs]
    : [parentLog];

  return (
    <Dialog>
      <DialogTrigger asChild>
        <Button
          variant="link"
          size="sm"
          className="mt-2 text-xs text-blue-400 hover:text-blue-300 p-0 h-auto"
        >
          <ExternalLink className="h-3 w-3 mr-1" />
          View full timeline
        </Button>
      </DialogTrigger>
      <DialogContent className="max-w-3xl max-h-[85vh] overflow-hidden flex flex-col">
        <DialogHeader>
          <DialogTitle>Enrichment Timeline</DialogTitle>
          <DialogDescription>
            {parentLog.operation} â€” {parentLog.entityType}
            {childLogs.length > 0 && ` (${childLogs.length} child jobs)`}
          </DialogDescription>
        </DialogHeader>
        <div className="flex-1 overflow-y-auto pr-2">
          <EnrichmentTimeline
            logs={timelineLogs}
            variant="default"
            className="mt-4"
          />
        </div>
      </DialogContent>
    </Dialog>
  );
}
```

Key design decisions:
- Props use `parentLog` and `childLogs` (not `log` and `children` which shadows React's `children` prop)
- Dialog uses `max-w-3xl` (768px) and `max-h-[85vh]` with flex column layout
- Content area is scrollable with `overflow-y-auto`
- Trigger is a link-styled button with ExternalLink icon
- EnrichmentTimeline renders in default (full) variant inside the modal
- Check `dialog.tsx` to confirm exact export names (Dialog, DialogContent, etc.)
  </action>
  <verify>
    Run `pnpm type-check` to verify no type errors in new files.
    Run `pnpm lint src/components/admin/SkeletonTimeline.tsx src/components/admin/EnrichmentTimelineModal.tsx` to verify linting passes.
    Verify both files export named components.
  </verify>
  <done>
    SkeletonTimeline renders 3 shimmer placeholders with accessibility attributes.
    EnrichmentTimelineModal opens a dialog with full EnrichmentTimeline view.
    Both files pass type-check and lint.
  </done>
</task>

</tasks>

<verification>
1. `pnpm type-check` passes for all modified/new files
2. `pnpm lint` passes for all modified/new files
3. EnrichmentTimeline default behavior unchanged (no variant prop = original behavior)
4. EnrichmentTimeline compact variant hides view switcher, uses smaller text
5. SkeletonTimeline has proper accessibility attributes (role, aria-busy)
6. EnrichmentTimelineModal renders EnrichmentTimeline in default variant inside Dialog
</verification>

<success_criteria>
- EnrichmentTimeline.tsx has variant, maxHeight, truncateChildren props
- Compact variant hides view switcher, descriptions, uses smaller sizing
- SkeletonTimeline.tsx exists with accessible loading skeleton
- EnrichmentTimelineModal.tsx exists with Dialog + full timeline
- Default EnrichmentTimeline behavior completely unchanged
- All type checks pass
</success_criteria>

<output>
After completion, create `.planning/phases/19-enrichmentlogtable-integration/19-02-SUMMARY.md`
</output>
