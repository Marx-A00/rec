---
phase: 34-album-pool
plan: 03
type: execute
wave: 2
depends_on: ["34-01"]
files_modified:
  - src/app/admin/game-pool/page.tsx
  - src/components/admin/game-pool/GamePoolStats.tsx
  - src/components/admin/game-pool/EligibleAlbumsTable.tsx
  - src/components/admin/game-pool/SuggestedAlbumsTable.tsx
  - src/components/admin/game-pool/StatusBadge.tsx
  - src/graphql/queries/gamePool.graphql
autonomous: true

must_haves:
  truths:
    - "Admin can view game pool stats (eligible, excluded, neutral counts)"
    - "Admin can see list of eligible albums"
    - "Admin can see list of suggested albums (unreviewed with cover art)"
    - "Admin can change album status via inline toggle"
  artifacts:
    - path: "src/app/admin/game-pool/page.tsx"
      provides: "Game Pool admin page"
    - path: "src/components/admin/game-pool/EligibleAlbumsTable.tsx"
      provides: "Table of eligible albums"
    - path: "src/components/admin/game-pool/SuggestedAlbumsTable.tsx"
      provides: "Table of suggested albums"
    - path: "src/graphql/queries/gamePool.graphql"
      provides: "Client GraphQL queries"
  key_links:
    - from: "src/app/admin/game-pool/page.tsx"
      to: "src/generated/graphql.ts"
      via: "useGamePoolStatsQuery hook"
    - from: "src/components/admin/game-pool/EligibleAlbumsTable.tsx"
      to: "src/generated/graphql.ts"
      via: "useUpdateAlbumGameStatusMutation hook"
---

<objective>
Build admin UI for managing the game album pool with stats overview and album tables.

Purpose: Allow admins to review, approve, and exclude albums from the daily game pool via a dedicated admin page.

Output: Working Game Pool page at /admin/game-pool with stats, eligible albums tab, and suggested albums tab.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/34-album-pool/34-CONTEXT.md
@.planning/phases/34-album-pool/34-RESEARCH.md
@.planning/phases/34-album-pool/34-01-SUMMARY.md
@src/app/admin/music-database/page.tsx
@src/app/admin/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GraphQL queries for game pool</name>
  <files>src/graphql/queries/gamePool.graphql</files>
  <action>
Create new file `src/graphql/queries/gamePool.graphql`:

```graphql
# Game Pool Management Queries

query GetGamePoolStats {
  gamePoolStats {
    eligibleCount
    excludedCount
    neutralCount
    totalWithCoverArt
  }
}

query GetAlbumsByGameStatus($status: AlbumGameStatus!, $limit: Int, $offset: Int) {
  albumsByGameStatus(status: $status, limit: $limit, offset: $offset) {
    id
    title
    releaseDate
    coverArtUrl
    cloudflareImageId
    gameStatus
    artists {
      artist {
        id
        name
      }
    }
  }
}

query GetSuggestedGameAlbums($limit: Int) {
  suggestedGameAlbums(limit: $limit) {
    id
    title
    releaseDate
    coverArtUrl
    cloudflareImageId
    gameStatus
    artists {
      artist {
        id
        name
      }
    }
  }
}

mutation UpdateAlbumGameStatus($input: UpdateAlbumGameStatusInput!) {
  updateAlbumGameStatus(input: $input) {
    success
    error
    album {
      id
      gameStatus
    }
  }
}
```

Run `pnpm codegen` to generate hooks.
  </action>
  <verify>
`pnpm codegen` completes successfully.
Generated file includes useGetGamePoolStatsQuery, useGetAlbumsByGameStatusQuery, useSuggestedGameAlbumsQuery, useUpdateAlbumGameStatusMutation.
  </verify>
  <done>
GraphQL queries file created and hooks generated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create game pool components</name>
  <files>
    src/components/admin/game-pool/StatusBadge.tsx
    src/components/admin/game-pool/GamePoolStats.tsx
    src/components/admin/game-pool/EligibleAlbumsTable.tsx
    src/components/admin/game-pool/SuggestedAlbumsTable.tsx
  </files>
  <action>
Create directory: `mkdir -p src/components/admin/game-pool`

**StatusBadge.tsx** - Three-state badge with color coding:
```typescript
'use client';

import { Badge } from '@/components/ui/badge';
import { CheckCircle, XCircle, MinusCircle } from 'lucide-react';
import { AlbumGameStatus } from '@/generated/graphql';

interface StatusBadgeProps {
  status: AlbumGameStatus;
}

export function StatusBadge({ status }: StatusBadgeProps) {
  switch (status) {
    case 'ELIGIBLE':
      return (
        <Badge className="bg-green-500/20 text-green-400 border-green-500/30">
          <CheckCircle className="w-3 h-3 mr-1" />
          Eligible
        </Badge>
      );
    case 'EXCLUDED':
      return (
        <Badge className="bg-red-500/20 text-red-400 border-red-500/30">
          <XCircle className="w-3 h-3 mr-1" />
          Excluded
        </Badge>
      );
    default:
      return (
        <Badge className="bg-zinc-500/20 text-zinc-400 border-zinc-500/30">
          <MinusCircle className="w-3 h-3 mr-1" />
          Not Reviewed
        </Badge>
      );
  }
}
```

**GamePoolStats.tsx** - Stats cards:
```typescript
'use client';

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { useGetGamePoolStatsQuery } from '@/generated/graphql';
import { CheckCircle, XCircle, MinusCircle, Image } from 'lucide-react';

export function GamePoolStats() {
  const { data, isLoading } = useGetGamePoolStatsQuery();
  const stats = data?.gamePoolStats;

  if (isLoading) {
    return (
      <div className="grid grid-cols-4 gap-4 mb-6">
        {[...Array(4)].map((_, i) => (
          <Card key={i} className="bg-zinc-900 border-zinc-800 animate-pulse">
            <CardHeader className="pb-2">
              <div className="h-4 bg-zinc-700 rounded w-20" />
            </CardHeader>
            <CardContent>
              <div className="h-8 bg-zinc-700 rounded w-16" />
            </CardContent>
          </Card>
        ))}
      </div>
    );
  }

  return (
    <div className="grid grid-cols-4 gap-4 mb-6">
      <Card className="bg-zinc-900 border-zinc-800">
        <CardHeader className="pb-2">
          <CardTitle className="text-sm font-medium text-zinc-400 flex items-center gap-2">
            <CheckCircle className="w-4 h-4 text-green-500" />
            Eligible
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold text-green-500">
            {stats?.eligibleCount || 0}
          </div>
        </CardContent>
      </Card>

      <Card className="bg-zinc-900 border-zinc-800">
        <CardHeader className="pb-2">
          <CardTitle className="text-sm font-medium text-zinc-400 flex items-center gap-2">
            <XCircle className="w-4 h-4 text-red-500" />
            Excluded
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold text-red-500">
            {stats?.excludedCount || 0}
          </div>
        </CardContent>
      </Card>

      <Card className="bg-zinc-900 border-zinc-800">
        <CardHeader className="pb-2">
          <CardTitle className="text-sm font-medium text-zinc-400 flex items-center gap-2">
            <MinusCircle className="w-4 h-4 text-zinc-500" />
            Not Reviewed
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold text-zinc-400">
            {stats?.neutralCount || 0}
          </div>
        </CardContent>
      </Card>

      <Card className="bg-zinc-900 border-zinc-800">
        <CardHeader className="pb-2">
          <CardTitle className="text-sm font-medium text-zinc-400 flex items-center gap-2">
            <Image className="w-4 h-4 text-blue-500" />
            With Cover Art
          </CardTitle>
        </CardHeader>
        <CardContent>
          <div className="text-2xl font-bold text-blue-500">
            {stats?.totalWithCoverArt || 0}
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

**EligibleAlbumsTable.tsx** - Table with inline status toggle:
```typescript
'use client';

import { useState } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { AlbumImage } from '@/components/ui/AlbumImage';
import {
  useGetAlbumsByGameStatusQuery,
  useUpdateAlbumGameStatusMutation,
  AlbumGameStatus,
} from '@/generated/graphql';
import { CheckCircle, XCircle, MinusCircle, Loader2 } from 'lucide-react';

export function EligibleAlbumsTable() {
  const queryClient = useQueryClient();
  const [updatingId, setUpdatingId] = useState<string | null>(null);

  const { data, isLoading } = useGetAlbumsByGameStatusQuery({
    status: AlbumGameStatus.Eligible,
    limit: 100,
  });

  const updateMutation = useUpdateAlbumGameStatusMutation({
    onSuccess: (result) => {
      if (result.updateAlbumGameStatus.success) {
        toast.success('Status updated');
        queryClient.invalidateQueries({ queryKey: ['GetGamePoolStats'] });
        queryClient.invalidateQueries({ queryKey: ['GetAlbumsByGameStatus'] });
      } else {
        toast.error(result.updateAlbumGameStatus.error || 'Failed to update');
      }
      setUpdatingId(null);
    },
    onError: (error) => {
      toast.error(`Error: ${error.message}`);
      setUpdatingId(null);
    },
  });

  const handleStatusChange = (albumId: string, newStatus: AlbumGameStatus) => {
    setUpdatingId(albumId);
    updateMutation.mutate({
      input: { albumId, gameStatus: newStatus },
    });
  };

  const albums = data?.albumsByGameStatus || [];

  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="w-6 h-6 animate-spin text-zinc-400" />
      </div>
    );
  }

  if (albums.length === 0) {
    return (
      <div className="text-center py-12 text-zinc-500">
        No eligible albums yet. Add albums from the Suggested tab.
      </div>
    );
  }

  return (
    <Table>
      <TableHeader>
        <TableRow className="border-zinc-800">
          <TableHead className="text-zinc-400">Album</TableHead>
          <TableHead className="text-zinc-400">Artist</TableHead>
          <TableHead className="text-zinc-400">Year</TableHead>
          <TableHead className="text-zinc-400 w-36">Status</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {albums.map((album) => (
          <TableRow key={album.id} className="border-zinc-800">
            <TableCell>
              <div className="flex items-center gap-3">
                <AlbumImage
                  src={album.coverArtUrl}
                  cloudflareImageId={album.cloudflareImageId}
                  alt={album.title}
                  size={40}
                  className="rounded"
                />
                <span className="text-white font-medium">{album.title}</span>
              </div>
            </TableCell>
            <TableCell className="text-zinc-400">
              {album.artists.map((a) => a.artist.name).join(', ')}
            </TableCell>
            <TableCell className="text-zinc-400">
              {album.releaseDate ? new Date(album.releaseDate).getFullYear() : '-'}
            </TableCell>
            <TableCell>
              <Select
                value={album.gameStatus}
                onValueChange={(value) => handleStatusChange(album.id, value as AlbumGameStatus)}
                disabled={updatingId === album.id}
              >
                <SelectTrigger className="w-32 bg-zinc-800 border-zinc-700">
                  {updatingId === album.id ? (
                    <Loader2 className="w-4 h-4 animate-spin" />
                  ) : (
                    <SelectValue />
                  )}
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="ELIGIBLE">
                    <span className="flex items-center gap-2">
                      <CheckCircle className="w-3 h-3 text-green-500" />
                      Eligible
                    </span>
                  </SelectItem>
                  <SelectItem value="EXCLUDED">
                    <span className="flex items-center gap-2">
                      <XCircle className="w-3 h-3 text-red-500" />
                      Excluded
                    </span>
                  </SelectItem>
                  <SelectItem value="NONE">
                    <span className="flex items-center gap-2">
                      <MinusCircle className="w-3 h-3 text-zinc-500" />
                      Neutral
                    </span>
                  </SelectItem>
                </SelectContent>
              </Select>
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
  );
}
```

**SuggestedAlbumsTable.tsx** - Similar structure for suggested albums:
```typescript
'use client';

import { useState } from 'react';
import { useQueryClient } from '@tanstack/react-query';
import { toast } from 'sonner';
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table';
import { Button } from '@/components/ui/button';
import { AlbumImage } from '@/components/ui/AlbumImage';
import {
  useGetSuggestedGameAlbumsQuery,
  useUpdateAlbumGameStatusMutation,
  AlbumGameStatus,
} from '@/generated/graphql';
import { CheckCircle, XCircle, Loader2 } from 'lucide-react';

export function SuggestedAlbumsTable() {
  const queryClient = useQueryClient();
  const [updatingId, setUpdatingId] = useState<string | null>(null);

  const { data, isLoading } = useGetSuggestedGameAlbumsQuery({ limit: 100 });

  const updateMutation = useUpdateAlbumGameStatusMutation({
    onSuccess: (result) => {
      if (result.updateAlbumGameStatus.success) {
        toast.success('Status updated');
        queryClient.invalidateQueries({ queryKey: ['GetGamePoolStats'] });
        queryClient.invalidateQueries({ queryKey: ['GetSuggestedGameAlbums'] });
        queryClient.invalidateQueries({ queryKey: ['GetAlbumsByGameStatus'] });
      } else {
        toast.error(result.updateAlbumGameStatus.error || 'Failed to update');
      }
      setUpdatingId(null);
    },
    onError: (error) => {
      toast.error(`Error: ${error.message}`);
      setUpdatingId(null);
    },
  });

  const handleApprove = (albumId: string) => {
    setUpdatingId(albumId);
    updateMutation.mutate({
      input: { albumId, gameStatus: AlbumGameStatus.Eligible },
    });
  };

  const handleExclude = (albumId: string) => {
    setUpdatingId(albumId);
    updateMutation.mutate({
      input: { albumId, gameStatus: AlbumGameStatus.Excluded },
    });
  };

  const albums = data?.suggestedGameAlbums || [];

  if (isLoading) {
    return (
      <div className="flex items-center justify-center py-12">
        <Loader2 className="w-6 h-6 animate-spin text-zinc-400" />
      </div>
    );
  }

  if (albums.length === 0) {
    return (
      <div className="text-center py-12 text-zinc-500">
        No suggested albums. All albums with cover art have been reviewed.
      </div>
    );
  }

  return (
    <Table>
      <TableHeader>
        <TableRow className="border-zinc-800">
          <TableHead className="text-zinc-400">Album</TableHead>
          <TableHead className="text-zinc-400">Artist</TableHead>
          <TableHead className="text-zinc-400">Year</TableHead>
          <TableHead className="text-zinc-400 w-48">Actions</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {albums.map((album) => (
          <TableRow key={album.id} className="border-zinc-800">
            <TableCell>
              <div className="flex items-center gap-3">
                <AlbumImage
                  src={album.coverArtUrl}
                  cloudflareImageId={album.cloudflareImageId}
                  alt={album.title}
                  size={40}
                  className="rounded"
                />
                <span className="text-white font-medium">{album.title}</span>
              </div>
            </TableCell>
            <TableCell className="text-zinc-400">
              {album.artists.map((a) => a.artist.name).join(', ')}
            </TableCell>
            <TableCell className="text-zinc-400">
              {album.releaseDate ? new Date(album.releaseDate).getFullYear() : '-'}
            </TableCell>
            <TableCell>
              <div className="flex items-center gap-2">
                <Button
                  size="sm"
                  variant="outline"
                  className="border-green-500/30 text-green-400 hover:bg-green-500/20"
                  onClick={() => handleApprove(album.id)}
                  disabled={updatingId === album.id}
                >
                  {updatingId === album.id ? (
                    <Loader2 className="w-4 h-4 animate-spin" />
                  ) : (
                    <>
                      <CheckCircle className="w-4 h-4 mr-1" />
                      Approve
                    </>
                  )}
                </Button>
                <Button
                  size="sm"
                  variant="outline"
                  className="border-red-500/30 text-red-400 hover:bg-red-500/20"
                  onClick={() => handleExclude(album.id)}
                  disabled={updatingId === album.id}
                >
                  <XCircle className="w-4 h-4 mr-1" />
                  Exclude
                </Button>
              </div>
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
  );
}
```
  </action>
  <verify>
`pnpm type-check` passes.
All component files exist and export their components.
  </verify>
  <done>
Four components created: StatusBadge, GamePoolStats, EligibleAlbumsTable, SuggestedAlbumsTable.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Game Pool admin page</name>
  <files>src/app/admin/game-pool/page.tsx</files>
  <action>
Create directory: `mkdir -p src/app/admin/game-pool`

Create the page:

```typescript
// src/app/admin/game-pool/page.tsx
'use client';

import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { GamePoolStats } from '@/components/admin/game-pool/GamePoolStats';
import { EligibleAlbumsTable } from '@/components/admin/game-pool/EligibleAlbumsTable';
import { SuggestedAlbumsTable } from '@/components/admin/game-pool/SuggestedAlbumsTable';
import { Gamepad2 } from 'lucide-react';

export default function GamePoolPage() {
  return (
    <div className="p-8">
      {/* Header */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-white flex items-center gap-3">
          <Gamepad2 className="w-8 h-8" />
          Game Pool
        </h1>
        <p className="text-zinc-400 mt-1">
          Manage albums eligible for the daily Uncover game
        </p>
      </div>

      {/* Stats */}
      <GamePoolStats />

      {/* Tabs */}
      <Tabs defaultValue="eligible" className="space-y-4">
        <TabsList className="bg-zinc-900 border border-zinc-800">
          <TabsTrigger
            value="eligible"
            className="data-[state=active]:bg-zinc-800"
          >
            Eligible Albums
          </TabsTrigger>
          <TabsTrigger
            value="suggested"
            className="data-[state=active]:bg-zinc-800"
          >
            Suggested Albums
          </TabsTrigger>
        </TabsList>

        <TabsContent value="eligible" className="bg-zinc-900 rounded-lg border border-zinc-800">
          <EligibleAlbumsTable />
        </TabsContent>

        <TabsContent value="suggested" className="bg-zinc-900 rounded-lg border border-zinc-800">
          <SuggestedAlbumsTable />
        </TabsContent>
      </Tabs>
    </div>
  );
}
```

The page will be accessible at `/admin/game-pool` using the existing admin layout.
  </action>
  <verify>
`pnpm type-check` passes.
`pnpm build` passes (or at least this page compiles).
  </verify>
  <done>
Game Pool page created at /admin/game-pool with stats, eligible tab, and suggested tab.
  </done>
</task>

</tasks>

<verification>
1. `pnpm codegen` completes successfully
2. `pnpm type-check` passes
3. Navigate to /admin/game-pool - page loads without errors
4. Stats cards display (may show 0 initially)
5. Eligible tab shows table (empty initially)
6. Suggested tab shows albums with cover art that haven't been reviewed
7. Clicking Approve on suggested album moves it to eligible
8. Clicking Exclude on suggested album removes it from suggestions
9. Changing status via dropdown in eligible table works
</verification>

<success_criteria>
- Game Pool page accessible at /admin/game-pool
- Stats cards show eligible, excluded, neutral, and with-cover-art counts
- Eligible Albums tab shows all ELIGIBLE albums with inline status toggle
- Suggested Albums tab shows NONE albums with cover art + approve/exclude buttons
- Status changes work and update UI reactively
- Toast notifications appear on success/error
</success_criteria>

<output>
After completion, create `.planning/phases/34-album-pool/34-03-SUMMARY.md`
</output>
