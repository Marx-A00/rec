---
phase: 27-code-rename
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/enrichment/enrichment-logger.ts
  - src/lib/logging/llama-logger.ts
  - src/lib/queue/processors/enrichment-processor.ts
  - src/lib/queue/processors/discogs-processor.ts
  - src/lib/queue/processors/cache-processor.ts
  - src/lib/musicbrainz/enrichment-logic.ts
  - src/lib/enrichment/preview-enrichment.ts
autonomous: true

must_haves:
  truths:
    - "LlamaLogger class exists and can be instantiated"
    - "All enrichment processors use LlamaLogger instead of EnrichmentLogger"
    - "No EnrichmentLogger references remain in processor files"
  artifacts:
    - path: "src/lib/logging/llama-logger.ts"
      provides: "LlamaLogger class and factory function"
      exports: ["LlamaLogger", "createLlamaLogger"]
    - path: "src/lib/enrichment/enrichment-logger.ts"
      provides: "Deleted or empty (no longer needed)"
      min_lines: 0
  key_links:
    - from: "src/lib/queue/processors/enrichment-processor.ts"
      to: "src/lib/logging/llama-logger.ts"
      via: "import LlamaLogger"
      pattern: "import.*LlamaLogger.*llama-logger"
    - from: "src/lib/queue/processors/cache-processor.ts"
      to: "src/lib/logging/llama-logger.ts"
      via: "import LlamaLogger"
      pattern: "import.*LlamaLogger.*llama-logger"
---

<objective>
Rename EnrichmentLogger class to LlamaLogger and move to new location.

Purpose: This is the foundational code rename - the logger class is imported by all processors and must be renamed first before other code updates can reference it.
Output: LlamaLogger class in src/lib/logging/llama-logger.ts with all processors updated to import from new location.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-code-rename/27-RESEARCH.md

@src/lib/enrichment/enrichment-logger.ts
@src/lib/queue/processors/enrichment-processor.ts
@src/lib/queue/processors/discogs-processor.ts
@src/lib/queue/processors/cache-processor.ts
@src/lib/musicbrainz/enrichment-logic.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LlamaLogger class in new location</name>
  <files>src/lib/logging/llama-logger.ts</files>
  <action>
  Create src/lib/logging/llama-logger.ts by copying content from src/lib/enrichment/enrichment-logger.ts and performing these renames:

  1. Rename class: `EnrichmentLogger` -> `LlamaLogger`
  2. Rename factory: `createEnrichmentLogger` -> `createLlamaLogger`
  3. Update Prisma imports: `EnrichmentLog` -> `LlamaLog` (already available from Phase 26)
  4. Update Prisma calls: `prisma.enrichmentLog` -> `prisma.llamaLog`
  5. Update console log prefix: `[EnrichmentLogger]` -> `[LlamaLogger]`
  6. Update type exports: `EnrichmentLogData` -> `LlamaLogData` (optional but cleaner)
  7. Keep `EnrichmentOperation` and `EnrichmentSource` types unchanged (these describe the operation categories, not the log entity)

  Critical: Import LlamaLog and LlamaLogCategory from @prisma/client (the schema already has these from Phase 26).
  </action>
  <verify>
  - File exists at src/lib/logging/llama-logger.ts
  - Contains `export class LlamaLogger`
  - Contains `export function createLlamaLogger`
  - Contains `prisma.llamaLog.create`
  - No references to `EnrichmentLog` type (only `EnrichmentOperation` and `EnrichmentSource` are OK)
  - TypeScript compiles the new file: `pnpm tsc --noEmit src/lib/logging/llama-logger.ts` succeeds
  - LlamaLogger can be instantiated: Run `pnpm type-check` to verify class structure is valid
  </verify>
  <done>LlamaLogger class is exported, uses LlamaLog Prisma model, and TypeScript validates its structure</done>
</task>

<task type="auto">
  <name>Task 2: Update all processor imports to use LlamaLogger</name>
  <files>
    src/lib/queue/processors/enrichment-processor.ts
    src/lib/queue/processors/discogs-processor.ts
    src/lib/queue/processors/cache-processor.ts
    src/lib/musicbrainz/enrichment-logic.ts
    src/lib/enrichment/preview-enrichment.ts
  </files>
  <action>
  For each file that imports from enrichment-logger.ts:

  1. Update import path: 
     `from '@/lib/enrichment/enrichment-logger'` -> `from '@/lib/logging/llama-logger'`
  
  2. Update import names:
     - `EnrichmentLogger` -> `LlamaLogger`
     - `createEnrichmentLogger` -> `createLlamaLogger`
     - `EnrichmentLogData` -> `LlamaLogData` (if imported)
  
  3. Update variable names (if any):
     - `enrichmentLogger` -> `llamaLogger` (local variable names)
  
  4. Keep EnrichmentOperation and EnrichmentSource imports unchanged (these are still valid type names).

  Files to update:
  - src/lib/queue/processors/enrichment-processor.ts - Main enrichment processor
  - src/lib/queue/processors/discogs-processor.ts - Discogs operations
  - src/lib/queue/processors/cache-processor.ts - Cache operations
  - src/lib/musicbrainz/enrichment-logic.ts - MusicBrainz enrichment
  - src/lib/enrichment/preview-enrichment.ts - Preview enrichment
  </action>
  <verify>
  1. No stale imports remain:
     `grep -r "EnrichmentLogger" src/lib/queue/processors/ src/lib/musicbrainz/ src/lib/enrichment/`
     Should return empty (no matches) except for potentially the old enrichment-logger.ts file.
  
  2. New imports compile successfully:
     `pnpm tsc --noEmit src/lib/queue/processors/enrichment-processor.ts src/lib/queue/processors/discogs-processor.ts src/lib/queue/processors/cache-processor.ts src/lib/musicbrainz/enrichment-logic.ts src/lib/enrichment/preview-enrichment.ts`
     Should exit with code 0 (no type errors related to LlamaLogger imports).
  </verify>
  <done>All processors import LlamaLogger from new location and TypeScript confirms imports resolve correctly</done>
</task>

<task type="auto">
  <name>Task 3: Delete old enrichment-logger.ts file</name>
  <files>src/lib/enrichment/enrichment-logger.ts</files>
  <action>
  Delete the old file: src/lib/enrichment/enrichment-logger.ts

  Verify no imports remain pointing to the old location before deleting.
  If any imports still point to old location, update them first.
  </action>
  <verify>
  - File src/lib/enrichment/enrichment-logger.ts does not exist
  - No TypeScript errors from missing imports
  - Run: `pnpm type-check` to verify no import errors
  </verify>
  <done>Old enrichment-logger.ts is deleted, no import errors remain</done>
</task>

</tasks>

<verification>
1. LlamaLogger class exists and exports correctly:
   - `grep "export class LlamaLogger" src/lib/logging/llama-logger.ts` returns match
   - `grep "export function createLlamaLogger" src/lib/logging/llama-logger.ts` returns match

2. All processors use new import:
   - `grep -r "from.*llama-logger" src/lib/` shows all 5 processor files

3. No stale references:
   - `grep -r "EnrichmentLogger" src/lib/` returns empty (excluding comments)
   - `grep -r "enrichment-logger" src/lib/` returns empty

4. TypeScript compiles:
   - `pnpm type-check` passes (may have errors from other files not yet updated)
</verification>

<success_criteria>
- LlamaLogger class is in src/lib/logging/llama-logger.ts
- All 5 processor files import from new location
- Old enrichment-logger.ts is deleted
- No EnrichmentLogger class references remain in processor code
- TypeScript can resolve all imports (other files may have type errors that will be fixed in Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/27-code-rename/27-01-SUMMARY.md`
</output>
