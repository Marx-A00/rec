---
phase: 27-code-rename
plan: 03
type: execute
wave: 3
depends_on: ["27-01", "27-02"]
files_modified:
  - src/lib/graphql/resolvers/queries.ts
  - src/lib/graphql/resolvers/mutations.ts
  - src/lib/graphql/resolvers/index.ts
  - src/lib/correction/apply/apply-service.ts
  - src/lib/correction/artist/apply/apply-service.ts
autonomous: true

must_haves:
  truths:
    - "GraphQL resolvers return LlamaLog[] instead of EnrichmentLog[]"
    - "Resolvers use prisma.llamaLog instead of prisma.enrichmentLog"
    - "Correction services use LlamaLogger instead of EnrichmentLogger"
  artifacts:
    - path: "src/lib/graphql/resolvers/queries.ts"
      provides: "llamaLogs resolver function"
      contains: "llamaLogs:"
    - path: "src/lib/graphql/resolvers/mutations.ts"
      provides: "Updated mutations using LlamaLog types"
      min_lines: 100
  key_links:
    - from: "src/lib/graphql/resolvers/queries.ts"
      to: "prisma.llamaLog"
      via: "Prisma client calls"
      pattern: "prisma\\.llamaLog\\."
    - from: "src/lib/correction/apply/apply-service.ts"
      to: "src/lib/logging/llama-logger.ts"
      via: "import LlamaLogger"
      pattern: "import.*from.*llama-logger"
---

<objective>
Update GraphQL resolvers and correction services to use LlamaLog types.

Purpose: Resolvers must return the new LlamaLog type and use prisma.llamaLog. Correction services that log operations must use LlamaLogger.
Output: All resolvers and services compile with LlamaLog types, no EnrichmentLog references remain.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-code-rename/27-01-SUMMARY.md
@.planning/phases/27-code-rename/27-02-SUMMARY.md

@src/lib/graphql/resolvers/queries.ts
@src/lib/graphql/resolvers/mutations.ts
@src/lib/graphql/resolvers/index.ts
@src/lib/correction/apply/apply-service.ts
@src/lib/correction/artist/apply/apply-service.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update GraphQL resolver imports and types</name>
  <files>
    src/lib/graphql/resolvers/queries.ts
    src/lib/graphql/resolvers/mutations.ts
    src/lib/graphql/resolvers/index.ts
  </files>
  <action>
  Update resolver files to use LlamaLog types:

  **src/lib/graphql/resolvers/queries.ts:**
  1. Update imports:
     - Change `EnrichmentLog` imports from @prisma/client to `LlamaLog`
     - If importing from generated/graphql.ts, update to use `LlamaLog` type
  
  2. Rename resolver functions:
     - `enrichmentLogs: async (...)` -> `llamaLogs: async (...)`
  
  3. Update Prisma calls:
     - `prisma.enrichmentLog.findMany` -> `prisma.llamaLog.findMany`
     - `prisma.enrichmentLog.findFirst` -> `prisma.llamaLog.findFirst`
     - `prisma.enrichmentLog.count` -> `prisma.llamaLog.count`
  
  4. Update return type annotations:
     - `Promise<EnrichmentLog[]>` -> `Promise<LlamaLog[]>`
     - `Promise<EnrichmentLog | null>` -> `Promise<LlamaLog | null>`

  **src/lib/graphql/resolvers/mutations.ts:**
  1. Update imports similarly
  2. Update any enrichmentLog Prisma calls
  3. Update type annotations
  4. Keep EnrichmentLogger -> LlamaLogger import (from Plan 01)

  **src/lib/graphql/resolvers/index.ts:**
  1. Update exports if resolver names changed
  2. Update type imports if needed

  Important: The resolver field names MUST match the schema field names:
  - Schema has `llamaLogs(...)` -> resolver object needs `llamaLogs: async (...)`
  </action>
  <verify>
  - `grep "llamaLogs:" src/lib/graphql/resolvers/queries.ts` returns match
  - `grep "prisma.llamaLog" src/lib/graphql/resolvers/queries.ts` returns matches
  - `grep "EnrichmentLog" src/lib/graphql/resolvers/queries.ts` returns empty
  - `grep "enrichmentLog" src/lib/graphql/resolvers/queries.ts` returns empty (for Prisma calls)
  </verify>
  <done>Resolver files use LlamaLog types and prisma.llamaLog calls</done>
</task>

<task type="auto">
  <name>Task 2: Update correction services</name>
  <files>
    src/lib/correction/apply/apply-service.ts
    src/lib/correction/artist/apply/apply-service.ts
  </files>
  <action>
  Update correction services to use LlamaLogger:

  **src/lib/correction/apply/apply-service.ts (album corrections):**
  1. Update logger import:
     - `from '@/lib/enrichment/enrichment-logger'` -> `from '@/lib/logging/llama-logger'`
  
  2. Update logger class reference:
     - `EnrichmentLogger` -> `LlamaLogger`
     - `createEnrichmentLogger` -> `createLlamaLogger`
  
  3. Update any direct Prisma calls:
     - `prisma.enrichmentLog` -> `prisma.llamaLog`
  
  4. Keep EnrichmentLogData parameter type updates if applicable (now LlamaLogData)

  **src/lib/correction/artist/apply/apply-service.ts (artist corrections):**
  1. Same updates as album apply-service

  Both services log admin_correction operations, so they need the new logger.
  </action>
  <verify>
  - `grep "LlamaLogger" src/lib/correction/apply/apply-service.ts` returns match
  - `grep "EnrichmentLogger" src/lib/correction/` returns empty
  - `grep "llama-logger" src/lib/correction/` returns matches for import paths
  </verify>
  <done>Correction services use LlamaLogger for logging operations</done>
</task>

<task type="auto">
  <name>Task 3: Run type check to verify all resolver/service updates</name>
  <files>None (verification only)</files>
  <action>
  Run TypeScript type checking to verify resolver and service updates:

  ```bash
  pnpm type-check
  ```

  If errors remain:
  1. Check which files have errors
  2. Common issues:
     - Missing LlamaLog import
     - Resolver function name mismatch with schema
     - Prisma property not updated (enrichmentLog -> llamaLog)
  3. Fix remaining errors

  Note: Some component files may still have errors - those are fixed in Plan 04.
  Focus on ensuring:
  - All files in src/lib/graphql/resolvers/ compile
  - All files in src/lib/correction/ compile
  - All files in src/lib/queue/processors/ compile (from Plan 01)
  </action>
  <verify>
  - `pnpm type-check` either passes OR shows errors only in component files (src/components/*)
  - No errors in src/lib/graphql/resolvers/*
  - No errors in src/lib/correction/*
  </verify>
  <done>All resolver and service files pass TypeScript type checking</done>
</task>

</tasks>

<verification>
1. Resolver functions renamed:
   - `llamaLogs` resolver exists in queries.ts
   - Returns LlamaLog[] type

2. Prisma calls updated:
   - `grep -r "prisma.llamaLog" src/lib/graphql/resolvers/` shows matches
   - `grep -r "prisma.enrichmentLog" src/lib/graphql/resolvers/` shows empty

3. Correction services updated:
   - Import from llama-logger.ts
   - Use LlamaLogger class

4. TypeScript compiles:
   - `pnpm type-check` shows no errors in resolver/service files
</verification>

<success_criteria>
- Resolver queries.ts has `llamaLogs:` resolver function
- All Prisma calls use prisma.llamaLog
- Correction services import and use LlamaLogger
- No EnrichmentLog or enrichmentLog references in resolver/service files
- TypeScript type check passes for resolver and service files
</success_criteria>

<output>
After completion, create `.planning/phases/27-code-rename/27-03-SUMMARY.md`
</output>
