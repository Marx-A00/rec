---
phase: 27-code-rename
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - src/graphql/schema.graphql
  - src/graphql/queries/enrichment.graphql
  - src/graphql/queries/albums.graphql
  - src/graphql/queries/getArtistDetails.graphql
  - src/generated/graphql.ts
  - src/generated/resolvers-types.ts
autonomous: true

must_haves:
  truths:
    - "GraphQL schema defines LlamaLog type instead of EnrichmentLog"
    - "GraphQL queries use llamaLogs field instead of enrichmentLogs"
    - "Generated types include LlamaLog and LlamaLogCategory"
  artifacts:
    - path: "src/graphql/schema.graphql"
      provides: "LlamaLog type, LlamaLogStatus enum, llamaLogs query"
      contains: "type LlamaLog"
    - path: "src/graphql/queries/enrichment.graphql"
      provides: "GetLlamaLogs query"
      contains: "query GetLlamaLogs"
    - path: "src/generated/graphql.ts"
      provides: "Generated LlamaLog types and React Query hooks"
      exports: ["LlamaLog", "useGetLlamaLogsQuery"]
  key_links:
    - from: "src/graphql/schema.graphql"
      to: "src/generated/graphql.ts"
      via: "pnpm codegen"
      pattern: "type LlamaLog"
    - from: "src/graphql/queries/enrichment.graphql"
      to: "src/generated/graphql.ts"
      via: "pnpm codegen"
      pattern: "useGetLlamaLogsQuery"
---

<objective>
Update GraphQL schema and queries from EnrichmentLog to LlamaLog, then regenerate types.

Purpose: GraphQL schema must be updated before components can use the new types. Codegen produces the React Query hooks that components import.
Output: Updated schema with LlamaLog types and regenerated TypeScript types/hooks.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-code-rename/27-RESEARCH.md

@src/graphql/schema.graphql
@src/graphql/queries/enrichment.graphql
@src/graphql/queries/albums.graphql
@src/graphql/queries/getArtistDetails.graphql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update GraphQL schema.graphql</name>
  <files>src/graphql/schema.graphql</files>
  <action>
  Perform the following renames in src/graphql/schema.graphql:

  1. Type rename: `type EnrichmentLog` -> `type LlamaLog`
  
  2. Add new field to LlamaLog type:
     - Add `category: LlamaLogCategory!` field (from Phase 26 schema)
  
  3. Enum rename: `enum EnrichmentLogStatus` -> `enum LlamaLogStatus`
  
  4. Add new enum (if not present):
     ```graphql
     enum LlamaLogCategory {
       CREATED
       ENRICHED
       CORRECTED
       CACHED
       FAILED
     }
     ```
  
  5. Query field renames:
     - `enrichmentLogs(...)` -> `llamaLogs(...)`
     - In Artist, Album, Track types: `enrichmentLogs(limit: Int): [EnrichmentLog!]!` -> `llamaLogs(limit: Int): [LlamaLog!]!`
     - `latestEnrichmentLog: EnrichmentLog` -> `latestLlamaLog: LlamaLog`
  
  6. Update return types:
     - All `[EnrichmentLog!]!` -> `[LlamaLog!]!`
     - All `: EnrichmentLog` -> `: LlamaLog`
  
  7. Update parameter types:
     - `status: EnrichmentLogStatus` -> `status: LlamaLogStatus`
  
  8. Keep `EnrichmentEntityType` unchanged (describes entity types, not log type)
  9. Keep `EnrichmentStatus` unchanged (describes operation status, not log status)
  10. Keep `EnrichmentPriority` unchanged (describes priority levels)
  11. Keep `EnrichmentType` unchanged (describes enrichment type for batch operations)

  The enum `LlamaLogStatus` should have the same values as the old EnrichmentLogStatus:
  SUCCESS, PARTIAL_SUCCESS, FAILED, NO_DATA_AVAILABLE, SKIPPED, PREVIEW
  </action>
  <verify>
  - `grep "type LlamaLog" src/graphql/schema.graphql` returns match
  - `grep "enum LlamaLogStatus" src/graphql/schema.graphql` returns match
  - `grep "enum LlamaLogCategory" src/graphql/schema.graphql` returns match
  - `grep "llamaLogs(" src/graphql/schema.graphql` returns match
  - `grep "EnrichmentLog" src/graphql/schema.graphql` returns empty (no matches)
  </verify>
  <done>GraphQL schema uses LlamaLog, LlamaLogStatus, LlamaLogCategory types</done>
</task>

<task type="auto">
  <name>Task 2: Update GraphQL query documents</name>
  <files>
    src/graphql/queries/enrichment.graphql
    src/graphql/queries/albums.graphql
    src/graphql/queries/getArtistDetails.graphql
  </files>
  <action>
  Update all .graphql query files that reference EnrichmentLog:

  **src/graphql/queries/enrichment.graphql:**
  1. Query names:
     - `GetEnrichmentLogs` -> `GetLlamaLogs`
     - `GetEnrichmentLogsWithChildren` -> `GetLlamaLogsWithChildren`
     - `GetEnrichmentStats` -> `GetEnrichmentStats` (keep - describes the operation, not the log)
  
  2. Query fields:
     - `enrichmentLogs(...)` -> `llamaLogs(...)`
  
  3. Parameter types:
     - `$status: EnrichmentLogStatus` -> `$status: LlamaLogStatus`
  
  4. Add `category` to selected fields (after status):
     ```graphql
     category
     ```
  
  5. Update children selection to include category:
     ```graphql
     children {
       ...
       category
       ...
     }
     ```

  **src/graphql/queries/albums.graphql:**
  - If it references enrichmentLogs, update to llamaLogs
  - If it references EnrichmentLog type, update to LlamaLog

  **src/graphql/queries/getArtistDetails.graphql:**
  - If it references enrichmentLogs, update to llamaLogs
  - If it references EnrichmentLog type, update to LlamaLog

  Also consider renaming the file:
  - src/graphql/queries/enrichment.graphql could stay (describes enrichment operations)
  - OR rename to llama.graphql (for consistency with LlamaLog)
  
  Decision: Keep as enrichment.graphql for now - it describes enrichment queries, file rename is optional Phase 31 work.
  </action>
  <verify>
  - `grep "query GetLlamaLogs" src/graphql/queries/enrichment.graphql` returns match
  - `grep "llamaLogs(" src/graphql/queries/enrichment.graphql` returns match
  - `grep "EnrichmentLog" src/graphql/queries/*.graphql` returns empty
  - `grep "enrichmentLogs" src/graphql/queries/*.graphql` returns empty
  </verify>
  <done>All GraphQL query documents use llamaLogs field and LlamaLog types</done>
</task>

<task type="auto">
  <name>Task 3: Regenerate GraphQL types via codegen</name>
  <files>
    src/generated/graphql.ts
    src/generated/resolvers-types.ts
  </files>
  <action>
  Run GraphQL codegen to regenerate TypeScript types:

  ```bash
  pnpm codegen
  ```

  This will:
  1. Read updated schema.graphql
  2. Read updated query documents
  3. Generate new types: LlamaLog, LlamaLogStatus, LlamaLogCategory
  4. Generate new hooks: useGetLlamaLogsQuery, useGetLlamaLogsWithChildrenQuery
  5. Update resolver types in resolvers-types.ts

  After codegen:
  - Restart TypeScript server in VS Code if needed (Cmd+Shift+P -> "TypeScript: Restart TS Server")
  - Types may show errors until resolver files are updated (Plan 03)

  IMPORTANT: Do not manually edit generated files (src/generated/*). They are overwritten by codegen.
  </action>
  <verify>
  - `pnpm codegen` completes without errors
  - `grep "export type LlamaLog" src/generated/graphql.ts` returns match
  - `grep "useGetLlamaLogsQuery" src/generated/graphql.ts` returns match
  - `grep "LlamaLogCategory" src/generated/graphql.ts` returns match
  - `grep "EnrichmentLog" src/generated/graphql.ts` returns empty (should be fully replaced)
  </verify>
  <done>Generated types include LlamaLog, LlamaLogStatus, LlamaLogCategory, and associated hooks</done>
</task>

</tasks>

<verification>
1. Schema updated correctly:
   - `grep -c "LlamaLog" src/graphql/schema.graphql` shows multiple matches
   - `grep "EnrichmentLog" src/graphql/schema.graphql` shows no matches

2. Query documents updated:
   - All queries in src/graphql/queries/ use llamaLogs field
   - No EnrichmentLog references remain

3. Codegen successful:
   - `pnpm codegen` exits with code 0
   - Generated files contain LlamaLog types
   - Generated files contain useGetLlamaLogsQuery hooks

4. Type sanity check:
   - `pnpm type-check` may show errors in resolver files (fixed in Plan 03)
   - But generated types should be consistent internally
</verification>

<success_criteria>
- GraphQL schema has LlamaLog type with category field
- GraphQL schema has LlamaLogStatus and LlamaLogCategory enums
- All query documents use llamaLogs field name
- `pnpm codegen` succeeds
- Generated types include LlamaLog and associated hooks
- No EnrichmentLog references in schema or query documents
</success_criteria>

<output>
After completion, create `.planning/phases/27-code-rename/27-02-SUMMARY.md`
</output>
