---
phase: 38-game-ui
plan: 03
type: execute
wave: 2
depends_on: ["38-01"]
files_modified:
  - src/components/uncover/UncoverGame.tsx
  - src/app/m/game/MobileGameClient.tsx
autonomous: true

must_haves:
  truths:
    - "Unauthenticated users see obscured album image (stage 1 teaser)"
    - "Login CTA overlays the teaser image"
    - "Short tagline explains the game concept"
    - "Login redirects back to game after authentication"
  artifacts:
    - path: "src/components/uncover/UncoverGame.tsx"
      provides: "Auth gate with teaser for desktop"
      contains: "stage 1 teaser image"
    - path: "src/app/m/game/MobileGameClient.tsx"
      provides: "Auth gate with teaser for mobile"
      contains: "stage 1 teaser image"
  key_links:
    - from: "UncoverGame auth gate"
      to: "/auth/signin"
      via: "signIn callback with callbackUrl"
---

<objective>
Implement auth gate teaser showing obscured album image for unauthenticated visitors.

Purpose: Create curiosity by letting unauthenticated users see the puzzle they can't play, driving sign-ups.

Output: Unauthenticated visitors see stage 1 obscured image with login CTA overlay and game explanation tagline.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/38-game-ui/38-CONTEXT.md
@.planning/phases/38-game-ui/38-01-SUMMARY.md

Key existing files:
@src/components/uncover/UncoverGame.tsx
@src/components/uncover/RevealImage.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create auth gate teaser for desktop</name>
  <files>src/components/uncover/UncoverGame.tsx</files>
  <action>
Update the auth gate section in UncoverGame.tsx (around line 57-72) to show a teaser:

Current code shows just text "Login Required" and a button.

Replace with teaser approach:

1. Fetch today's challenge image URL for unauthenticated users:
   - Create a new GraphQL query `dailyChallengeTeaser` that returns ONLY the image URL (no answer)
   - OR use existing `dailyChallenge` query which already doesn't expose the answer
   - Use `useDailyChallengeQuery` to fetch challenge data for teaser

2. Update the auth gate return block:
   ```tsx
   // AUTH-02: Show teaser for unauthenticated users
   if (!game.isAuthenticated) {
     if (game.isAuthLoading) {
       return (
         <div className="flex min-h-[400px] items-center justify-center">
           <div className="text-muted-foreground">Loading...</div>
         </div>
       );
     }
     
     return (
       <div className="flex min-h-[400px] flex-col items-center gap-6 p-4 md:p-8">
         {/* Title */}
         <div className="text-center">
           <h2 className="mb-2 text-2xl font-bold">Daily Uncover</h2>
           <p className="text-muted-foreground max-w-sm">
             Guess the album from its cover art. 6 attempts. New puzzle daily.
           </p>
         </div>
         
         {/* Teaser image with login overlay */}
         <div className="relative w-full max-w-md">
           {/* Stage 1 obscured image (most obscured) */}
           <TeaserImage />
           
           {/* Login CTA overlay */}
           <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/60 rounded-lg">
             <div className="text-center p-6">
               <p className="text-white mb-4 font-medium">
                 Sign in to play
               </p>
               <button
                 onClick={() => signIn(undefined, { callbackUrl: '/game' })}
                 className="rounded-md bg-emerald-500 px-6 py-3 font-medium text-black hover:bg-emerald-400 transition-colors"
               >
                 Sign In
               </button>
             </div>
           </div>
         </div>
         
         {/* How it works */}
         <div className="text-center text-sm text-muted-foreground max-w-sm">
           <p>The image starts heavily obscured. Each guess reveals more.</p>
         </div>
       </div>
     );
   }
   ```

3. Create TeaserImage subcomponent (or inline):
   - Use `useDailyChallengeQuery` to fetch challenge
   - Render `RevealImage` at stage 1 with showToggle={false}
   - Handle loading state with skeleton/placeholder
   
   ```tsx
   function TeaserImage() {
     const { data, isLoading } = useDailyChallengeQuery();
     
     if (isLoading || !data?.dailyChallenge) {
       return (
         <div className="aspect-square w-full rounded-lg bg-zinc-800 animate-pulse" />
       );
     }
     
     return (
       <RevealImage
         imageUrl={data.dailyChallenge.imageUrl}
         challengeId={data.dailyChallenge.id}
         stage={1}
         showToggle={false}
         className="aspect-square w-full rounded-lg overflow-hidden"
       />
     );
   }
   ```

4. Import useDailyChallengeQuery:
   ```tsx
   import { useDailyChallengeQuery } from '@/generated/graphql';
   ```

5. Update signIn call to include callbackUrl:
   ```tsx
   signIn(undefined, { callbackUrl: '/game' })
   ```
   This ensures users return to the game after logging in.
  </action>
  <verify>
    - `pnpm type-check` passes
    - Log out and visit /game
    - See obscured album image (stage 1)
    - See "Sign in to play" overlay
    - Click sign in, complete auth, return to /game
  </verify>
  <done>
    - Unauthenticated users see stage 1 teaser image
    - Login CTA overlays the image
    - Tagline explains game concept
    - Login redirects back to /game
  </done>
</task>

<task type="auto">
  <name>Task 2: Create auth gate teaser for mobile</name>
  <files>src/app/m/game/MobileGameClient.tsx</files>
  <action>
Apply the same teaser pattern to MobileGameClient:

1. Import useDailyChallengeQuery:
   ```tsx
   import { useDailyChallengeQuery } from '@/generated/graphql';
   ```

2. Create MobileTeaserImage component (similar to desktop but mobile-sized):
   ```tsx
   function MobileTeaserImage() {
     const { data, isLoading } = useDailyChallengeQuery();
     
     if (isLoading || !data?.dailyChallenge) {
       return (
         <div className="aspect-square w-full rounded-lg bg-zinc-800 animate-pulse" />
       );
     }
     
     return (
       <RevealImage
         imageUrl={data.dailyChallenge.imageUrl}
         challengeId={data.dailyChallenge.id}
         stage={1}
         showToggle={false}
         className="aspect-square w-full rounded-lg overflow-hidden"
       />
     );
   }
   ```

3. Update auth gate section in MobileGameClient:
   ```tsx
   if (!game.isAuthenticated) {
     if (game.isAuthLoading) {
       return (
         <div className="min-h-screen bg-black">
           <div className="flex min-h-[60vh] items-center justify-center">
             <div className="text-zinc-400">Loading...</div>
           </div>
         </div>
       );
     }
     
     return (
       <div className="min-h-screen bg-black">
         {/* Mobile header */}
         <div className="sticky top-0 z-10 bg-black/90 backdrop-blur-sm border-b border-zinc-800 px-4 py-3">
           <Link href="/m" className="flex items-center gap-2 text-white min-h-[44px]">
             <ArrowLeft className="h-5 w-5" />
             <span>Back</span>
           </Link>
         </div>
         
         <div className="flex flex-col items-center gap-6 px-4 py-8">
           {/* Title */}
           <div className="text-center">
             <h1 className="text-xl font-bold text-white">Daily Uncover</h1>
             <p className="text-sm text-zinc-400 mt-1">
               Guess the album from its cover art
             </p>
           </div>
           
           {/* Teaser image with login overlay */}
           <div className="relative w-full">
             <MobileTeaserImage />
             
             {/* Login overlay */}
             <div className="absolute inset-0 flex flex-col items-center justify-center bg-black/60 rounded-lg">
               <div className="text-center p-6">
                 <p className="text-white mb-4 font-medium">
                   Sign in to play
                 </p>
                 <button
                   onClick={() => signIn(undefined, { callbackUrl: '/m/game' })}
                   className="rounded-md bg-emerald-500 px-6 py-3 min-h-[48px] font-medium text-black active:scale-[0.98] transition-transform"
                 >
                   Sign In
                 </button>
               </div>
             </div>
           </div>
           
           {/* How it works */}
           <div className="text-center text-sm text-zinc-500">
             <p>6 attempts. New puzzle daily.</p>
             <p className="mt-1">Each guess reveals more of the image.</p>
           </div>
         </div>
       </div>
     );
   }
   ```

4. Note mobile-specific adjustments:
   - callbackUrl is `/m/game` (not `/game`)
   - Touch-friendly button with `min-h-[48px]` and `active:scale-[0.98]`
   - Mobile header with back navigation present
  </action>
  <verify>
    - `pnpm type-check` passes
    - Log out and visit /m/game
    - See mobile header with back button
    - See obscured album image (stage 1)
    - See "Sign in to play" overlay
    - Click sign in, complete auth, return to /m/game
  </verify>
  <done>
    - Mobile auth gate shows stage 1 teaser
    - Login CTA with mobile-friendly button
    - Login redirects to /m/game
    - Mobile header present for navigation
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `pnpm type-check` - no type errors
2. `pnpm lint` - passes
3. Manual test (logged out):
   - Visit /game - see teaser with login overlay
   - Visit /m/game - see mobile teaser with login overlay
   - Sign in from either - return to correct route
4. Manual test (logged in):
   - Visit /game - see normal game (no overlay)
   - Visit /m/game - see mobile game (no overlay)
</verification>

<success_criteria>
- AUTH-02 requirement satisfied: unauthenticated users see login prompt
- Teaser shows stage 1 obscured image (creates curiosity)
- Login CTA overlays the image
- Tagline explains game: "Guess the album from its cover art. 6 attempts. New puzzle daily."
- Login redirects back to appropriate route (/game or /m/game)
</success_criteria>

<output>
After completion, create `.planning/phases/38-game-ui/38-03-SUMMARY.md`
</output>
