---
phase: 38-game-ui
plan: 02
type: execute
wave: 2
depends_on: ["38-01"]
files_modified:
  - src/app/m/game/page.tsx
  - src/app/m/game/MobileGameClient.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile users can play the game at /m/game"
    - "Mobile layout is touch-friendly with 44px+ tap targets"
    - "Game functions identically to desktop (search, guess, skip)"
  artifacts:
    - path: "src/app/m/game/page.tsx"
      provides: "Mobile game route (server component)"
    - path: "src/app/m/game/MobileGameClient.tsx"
      provides: "Mobile game client component"
      exports: ["default"]
  key_links:
    - from: "src/app/m/game/page.tsx"
      to: "MobileGameClient"
      via: "server component renders client component"
    - from: "src/app/m/game/MobileGameClient.tsx"
      to: "useUncoverGame"
      via: "game state and actions"
---

<objective>
Create dedicated mobile game route following established /m/* architecture.

Purpose: Provide a mobile-optimized game experience with touch-friendly controls and appropriate layout for smaller screens.

Output: Mobile game at /m/game with touch-friendly autocomplete, proper spacing, and mobile-specific layout adjustments.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/38-game-ui/38-CONTEXT.md
@.planning/phases/38-game-ui/38-01-SUMMARY.md

Key existing files:
@src/app/m/layout.tsx
@src/app/m/albums/[id]/page.tsx (pattern reference)
@src/components/uncover/AlbumGuessInput.tsx
@src/components/uncover/GuessList.tsx
@src/components/uncover/AttemptDots.tsx
@src/hooks/useUncoverGame.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create mobile game route and client component</name>
  <files>
    src/app/m/game/page.tsx
    src/app/m/game/MobileGameClient.tsx
  </files>
  <action>
1. Create `src/app/m/game/page.tsx` (Server Component):
   ```tsx
   import MobileGameClient from './MobileGameClient';

   export const metadata = {
     title: 'Daily Challenge | Uncover',
   };

   export default function MobileGamePage() {
     return <MobileGameClient />;
   }
   ```

2. Create `src/app/m/game/MobileGameClient.tsx` (Client Component):

   Import dependencies:
   ```tsx
   'use client';

   import { useEffect, useState } from 'react';
   import { signIn } from 'next-auth/react';
   import Link from 'next/link';
   import { ArrowLeft } from 'lucide-react';

   import { useUncoverGame } from '@/hooks/useUncoverGame';
   import { useRevealStore } from '@/stores/useRevealStore';
   import { RevealImage } from '@/components/uncover/RevealImage';
   import { AlbumGuessInput } from '@/components/uncover/AlbumGuessInput';
   import { GuessList } from '@/components/uncover/GuessList';
   import { AttemptDots } from '@/components/uncover/AttemptDots';
   ```

   Structure similar to UncoverGame.tsx but with mobile-specific layout:

   a) Mobile header with back navigation:
      ```tsx
      <div className="sticky top-0 z-10 bg-black/90 backdrop-blur-sm border-b border-zinc-800 px-4 py-3">
        <Link href="/m" className="flex items-center gap-2 text-white min-h-[44px]">
          <ArrowLeft className="h-5 w-5" />
          <span>Back</span>
        </Link>
      </div>
      ```

   b) Game content with mobile padding/spacing:
      - Use `px-4 py-6` for content container
      - Larger touch targets: all buttons min-h-[44px] min-w-[44px]
      - Full-width image container (no max-w-md, just w-full with aspect-square)
      - Search input takes full width
      - Skip button full width below input (not inline)

   c) Auth gate:
      - Same logic as desktop: check `game.isAuthenticated`
      - Mobile-styled login button with min-h-[48px]

   d) Game states (loading, error, in-progress, game-over):
      - Same logic as desktop UncoverGame
      - Adjusted padding and font sizes for mobile (text-lg instead of text-2xl for headers)

   e) Auto-start session on mount (same pattern as UncoverGame):
      ```tsx
      useEffect(() => {
        if (!game.isAuthenticated || game.isAuthLoading) return;
        if (game.sessionId || isInitializing) return;
        
        const initializeGame = async () => {
          setIsInitializing(true);
          try {
            const result = await game.startGame();
            setChallengeImageUrl(result.imageUrl);
            setChallengeImageId(result.cloudflareImageId);
          } catch (error) {
            console.error('Failed to start game:', error);
          } finally {
            setIsInitializing(false);
          }
        };
        
        initializeGame();
      }, [game.isAuthenticated, game.isAuthLoading, game.sessionId, isInitializing]);
      ```

   f) Mobile-specific layout for game board:
      ```tsx
      <div className="flex flex-col items-center gap-4 px-4 pb-8">
        {/* Title */}
        <div className="text-center pt-4">
          <h1 className="text-xl font-bold">Daily Uncover</h1>
          <p className="text-sm text-zinc-400">Guess the album</p>
        </div>
        
        {/* Image - full width */}
        {challengeImageUrl && (
          <div className="w-full">
            <RevealImage
              imageUrl={challengeImageUrl}
              challengeId={game.challengeId ?? 'unknown'}
              stage={game.revealStage}
              className="aspect-square w-full overflow-hidden rounded-lg"
            />
          </div>
        )}
        
        {/* Attempt dots */}
        <AttemptDots attemptCount={game.attemptCount} />
        
        {/* Search input - full width */}
        <div className="w-full">
          <AlbumGuessInput
            onGuess={game.submitGuess}
            onSkip={game.skipGuess}
            disabled={game.isGameOver}
            isSubmitting={game.isSubmitting}
          />
        </div>
        
        {/* Previous guesses */}
        {game.guesses.length > 0 && (
          <div className="w-full">
            <GuessList guesses={game.guesses} />
          </div>
        )}
        
        {/* Error */}
        {game.error && (
          <div className="w-full rounded-md border border-red-500/50 bg-red-950/20 p-4 text-center text-red-400 text-sm">
            {game.error}
          </div>
        )}
      </div>
      ```

   g) Mobile game-over screen:
      - Same content as desktop but adjusted spacing
      - "Come back tomorrow" message
      - Full revealed image
      - All guesses shown
  </action>
  <verify>
    - `pnpm type-check` passes
    - `pnpm lint` passes
    - Navigate to http://localhost:3000/m/game and verify:
      - Page loads without errors
      - Mobile layout with back navigation
      - Game is playable
      - Touch targets are appropriately sized
  </verify>
  <done>
    - Mobile game route exists at /m/game
    - MobileGameClient implements full game flow
    - Touch-friendly layout with 44px+ tap targets
    - Back navigation to /m
  </done>
</task>

<task type="auto">
  <name>Task 2: Ensure AlbumGuessInput works well on mobile</name>
  <files>src/components/uncover/AlbumGuessInput.tsx</files>
  <action>
Review and adjust AlbumGuessInput for mobile compatibility:

1. Ensure input has sufficient height for touch:
   - CommandInput should have `className` with min-h-[44px]

2. Ensure dropdown items have sufficient height:
   - CommandItem should have padding that results in 44px+ row height
   - Add `py-3` to CommandItem for better touch targets

3. Skip button adjustments:
   - Make skip button full-width on mobile via responsive class
   - Add `w-full md:w-auto` to skip button
   - Ensure min-h-[44px]

4. Dropdown positioning:
   - Ensure dropdown doesn't get cut off on mobile
   - Use `max-h-[200px]` or similar to limit height on small screens
   - Ensure `overflow-y-auto` for scrolling

5. Input focus behavior:
   - On mobile, opening keyboard should not cause layout shift
   - Consider adding `scroll-margin-top` to input container

The changes should be additive/compatible - desktop should still work.
  </action>
  <verify>
    - `pnpm type-check` passes
    - Test on desktop - autocomplete still works
    - Test on mobile viewport:
      - Tap targets are easy to hit
      - Dropdown is scrollable if many results
      - Skip button is easy to tap
  </verify>
  <done>
    - AlbumGuessInput has 44px+ touch targets
    - Skip button is full-width on mobile
    - Dropdown is mobile-friendly
  </done>
</task>

</tasks>

<verification>
After all tasks:
1. `pnpm type-check` - no type errors
2. `pnpm lint` - passes
3. Manual test on mobile viewport (Chrome DevTools device mode):
   - Navigate to /m/game while logged in
   - Verify mobile header with back button
   - Play through game loop
   - Verify touch targets are appropriately sized
   - Verify dropdown doesn't overflow screen
</verification>

<success_criteria>
- Mobile game route exists at /m/game
- Mobile layout follows existing /m/* architecture patterns
- Touch targets are 44px+ for all interactive elements
- Full game loop playable on mobile
- AlbumGuessInput works on both desktop and mobile
</success_criteria>

<output>
After completion, create `.planning/phases/38-game-ui/38-02-SUMMARY.md`
</output>
