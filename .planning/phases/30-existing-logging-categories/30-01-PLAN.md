---
phase: 30-existing-logging-categories
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/queue/processors/enrichment-processor.ts
  - src/lib/queue/processors/cache-processor.ts
  - src/lib/queue/processors/discogs-processor.ts
autonomous: true

must_haves:
  truths:
    - "Album enrichment operations produce LlamaLog entries with category: ENRICHED"
    - "Artist enrichment operations produce LlamaLog entries with category: ENRICHED"
    - "Track enrichment operations produce LlamaLog entries with category: ENRICHED"
    - "Image caching operations produce LlamaLog entries with category: ENRICHED"
    - "Failed operations produce LlamaLog entries with category: FAILED"
  artifacts:
    - path: "src/lib/queue/processors/enrichment-processor.ts"
      provides: "Album, artist, track enrichment with explicit category"
      contains: "category: 'ENRICHED'"
    - path: "src/lib/queue/processors/cache-processor.ts"
      provides: "Image caching with explicit category"
      contains: "category: 'ENRICHED'"
    - path: "src/lib/queue/processors/discogs-processor.ts"
      provides: "Discogs enrichment with explicit category"
      contains: "category: 'ENRICHED'"
  key_links:
    - from: "src/lib/queue/processors/enrichment-processor.ts"
      to: "src/lib/logging/llama-logger.ts"
      via: "logEnrichment with category param"
      pattern: "category:\\s*['\"]ENRICHED['\"]"
    - from: "src/lib/queue/processors/cache-processor.ts"
      to: "src/lib/logging/llama-logger.ts"
      via: "logEnrichment with category param"
      pattern: "category:\\s*['\"]ENRICHED['\"]"
---

<objective>
Add explicit category values to all existing logEnrichment() calls in queue processors.

Purpose: Fulfill requirements EXIST-01 (enrichment -> ENRICHED), EXIST-03 (cache -> ENRICHED per CONTEXT.md), and EXIST-04 (failed -> FAILED) by adding explicit category parameters to all logging calls.
Output: All processor files updated with explicit category values on every logEnrichment() call.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/30-existing-logging-categories/30-CONTEXT.md

Key decisions from CONTEXT.md:
- Category reflects **outcome**, not intent
- ENRICHED = External data fetched AND applied to entity (automated)
- FAILED = Any operation that didn't succeed
- Image uploads to Cloudflare = ENRICHED (adding cloudflareImageId field)
- CACHED category kept in enum for future use, but not applied in Phase 30

@src/lib/logging/llama-logger.ts
@src/lib/queue/processors/enrichment-processor.ts
@src/lib/queue/processors/cache-processor.ts
@src/lib/queue/processors/discogs-processor.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add category to enrichment-processor.ts logEnrichment calls</name>
  <files>src/lib/queue/processors/enrichment-processor.ts</files>
  <action>
Add `category` parameter to all logEnrichment() calls that don't already have one.

**Calls to update (by line reference):**

1. Line ~388 (album skip): Add `category: 'ENRICHED'` (skipped enrichment is still outcome of enrichment operation)
2. Line ~845 (Spotify track fallback): Add `category: 'ENRICHED'`
3. Line ~917 (album enrichment success): Add `category: 'ENRICHED'`
4. Line ~963 (album enrichment failure): Add `category: 'FAILED'`
5. Line ~1040 (artist skip): Add `category: 'ENRICHED'`
6. Line ~1234 (artist enrichment success): Add `category: 'ENRICHED'`
7. Line ~1311 (artist enrichment failure): Add `category: 'FAILED'`
8. Line ~1501 (track enrichment success): Add `category: 'ENRICHED'`
9. Line ~1584 (track enrichment failure): Add `category: 'FAILED'`

**Calls that already have category (do not modify):**
- Line ~2345: `category: 'CREATED'` (track creation)
- Line ~2408: `category: 'CREATED'` (artist creation)
- Line ~2432: `category: 'LINKED'` (artist linking)
- Line ~2486: `category: 'FAILED'` (track creation failure)

For each call, add the category field after the `operation` field for consistency.
  </action>
  <verify>
Run: `grep -n "category:" src/lib/queue/processors/enrichment-processor.ts | wc -l`
Expected: 13 (9 new + 4 existing)

Run: `pnpm type-check`
Expected: No type errors
  </verify>
  <done>All 13 logEnrichment calls in enrichment-processor.ts have explicit category values</done>
</task>

<task type="auto">
  <name>Task 2: Add category to cache-processor.ts logEnrichment calls</name>
  <files>src/lib/queue/processors/cache-processor.ts</files>
  <action>
Add `category` parameter to all 12 logEnrichment() calls in cache-processor.ts.

Per CONTEXT.md: "Image uploads to Cloudflare = ENRICHED (adding cloudflareImageId field)"

**Album cover art caching calls:**
- Line ~40 (album not found): Add `category: 'FAILED'`
- Line ~63 (already cached skip): Add `category: 'ENRICHED'`
- Line ~99 (no cover art skip): Add `category: 'ENRICHED'`
- Line ~141 (upload failed): Add `category: 'FAILED'`
- Line ~180 (cache success): Add `category: 'ENRICHED'`
- Line ~223 (catch block failure): Add `category: 'FAILED'`

**Artist image caching calls:**
- Line ~276 (artist not found): Add `category: 'FAILED'`
- Line ~299 (already cached skip): Add `category: 'ENRICHED'`
- Line ~335 (no image skip): Add `category: 'ENRICHED'`
- Line ~379 (upload failed): Add `category: 'FAILED'`
- Line ~418 (cache success): Add `category: 'ENRICHED'`
- Line ~461 (catch block failure): Add `category: 'FAILED'`

For each call, add the category field after the `operation` field for consistency.
  </action>
  <verify>
Run: `grep -n "category:" src/lib/queue/processors/cache-processor.ts | wc -l`
Expected: 12

Run: `pnpm type-check`
Expected: No type errors
  </verify>
  <done>All 12 logEnrichment calls in cache-processor.ts have explicit category values</done>
</task>

<task type="auto">
  <name>Task 3: Add category to discogs-processor.ts logEnrichment calls</name>
  <files>src/lib/queue/processors/discogs-processor.ts</files>
  <action>
Add `category` parameter to all 7 logEnrichment() calls in discogs-processor.ts.

Discogs operations are enrichment operations (fetching external data to enhance entities).

**Search artist calls:**
- Line ~57 (no results): Add `category: 'ENRICHED'` (operation completed, just no data found)
- Line ~98 (no confident match): Add `category: 'ENRICHED'`
- Line ~161 (search success, queued fetch): Add `category: 'ENRICHED'`
- Line ~197 (search failed): Add `category: 'FAILED'`

**Get artist calls:**
- Line ~250 (no image found): Add `category: 'ENRICHED'` (partial success is still enrichment)
- Line ~304 (fetch success): Add `category: 'ENRICHED'`
- Line ~339 (fetch failed): Add `category: 'FAILED'`

For each call, add the category field after the `operation` field for consistency.
  </action>
  <verify>
Run: `grep -n "category:" src/lib/queue/processors/discogs-processor.ts | wc -l`
Expected: 7

Run: `pnpm type-check`
Expected: No type errors
  </verify>
  <done>All 7 logEnrichment calls in discogs-processor.ts have explicit category values</done>
</task>

</tasks>

<verification>
After completing all tasks:

1. Count total category usages across all processor files:
```bash
grep -rn "category:" src/lib/queue/processors/*.ts | wc -l
```
Expected: 32 (13 enrichment + 12 cache + 7 discogs = 32)

2. Verify no logEnrichment calls without category in processors:
```bash
grep -A10 "logEnrichment({" src/lib/queue/processors/*.ts | grep -v "category:" | head -20
```
Expected: No logEnrichment calls without a following category line

3. Type check passes:
```bash
pnpm type-check
```
Expected: No errors
</verification>

<success_criteria>
1. All logEnrichment() calls in enrichment-processor.ts have explicit category (13 total)
2. All logEnrichment() calls in cache-processor.ts have explicit category (12 total)
3. All logEnrichment() calls in discogs-processor.ts have explicit category (7 total)
4. Category values follow CONTEXT.md rules: ENRICHED for enrichment outcomes, FAILED for failures
5. `pnpm type-check` passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/30-existing-logging-categories/30-01-SUMMARY.md`
</output>
