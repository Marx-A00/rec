---
phase: 21-source-selection-ui
plan: 02
type: execute
wave: 2
depends_on: ["21-01"]
files_modified:
  - src/components/admin/correction/shared/SourceToggle.tsx
  - src/components/admin/correction/shared/index.ts
  - src/components/admin/correction/search/SearchView.tsx
  - src/components/admin/correction/artist/search/ArtistSearchView.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Source toggle appears at top of search view"
    - "Switching sources clears previous search results"
    - "Toggle shows MusicBrainz and Discogs options"
  artifacts:
    - path: "src/components/admin/correction/shared/SourceToggle.tsx"
      provides: "Reusable source toggle component"
      exports: ["SourceToggle", "CorrectionSource"]
    - path: "src/components/admin/correction/search/SearchView.tsx"
      provides: "Album search with source toggle"
      contains: "SourceToggle"
    - path: "src/components/admin/correction/artist/search/ArtistSearchView.tsx"
      provides: "Artist search with source toggle"
      contains: "SourceToggle"
  key_links:
    - from: "SourceToggle"
      to: "useCorrectionStore"
      via: "correctionSource state and setCorrectionSource action"
      pattern: "setCorrectionSource"
    - from: "SearchView"
      to: "SourceToggle"
      via: "component composition"
      pattern: "<SourceToggle"
---

<objective>
Create the SourceToggle component and integrate it into both album and artist search views.

Purpose: Admins can toggle between MusicBrainz and Discogs at the top of the search step, with visual clarity on which source is active.

Output:
- Reusable SourceToggle component
- Updated SearchView with toggle integration
- Updated ArtistSearchView with toggle integration
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-source-selection-ui/21-RESEARCH.md
@.planning/phases/21-source-selection-ui/21-01-SUMMARY.md

@src/components/ui/toggle-group.tsx
@src/stores/useCorrectionStore.ts
@src/stores/useArtistCorrectionStore.ts
@src/components/admin/correction/search/SearchView.tsx
@src/components/admin/correction/artist/search/ArtistSearchView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SourceToggle component</name>
  <files>
    src/components/admin/correction/shared/SourceToggle.tsx
    src/components/admin/correction/shared/index.ts
  </files>
  <action>
Create the SourceToggle component in the shared folder.

Create src/components/admin/correction/shared/SourceToggle.tsx:

```typescript
'use client';

import { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group';
import type { CorrectionSource } from '@/stores/useCorrectionStore';

export interface SourceToggleProps {
  /** Currently selected source */
  value: CorrectionSource;
  /** Callback when source changes */
  onChange: (value: CorrectionSource) => void;
  /** Additional class names */
  className?: string;
  /** Disable toggle (e.g., during search) */
  disabled?: boolean;
}

/**
 * Toggle between MusicBrainz and Discogs correction sources.
 * 
 * Uses Radix Toggle Group for accessibility:
 * - Full keyboard navigation
 * - ARIA attributes
 * - Focus management
 * 
 * Note: Discogs search is NOT implemented yet (Phase 22+).
 * Toggle exists but Discogs selection will show "Coming soon" state.
 */
export function SourceToggle({ 
  value, 
  onChange, 
  className,
  disabled = false 
}: SourceToggleProps) {
  return (
    <div className={className}>
      <label className="text-xs font-medium text-zinc-400 mb-1.5 block">
        Search Source
      </label>
      <ToggleGroup
        type="single"
        value={value}
        onValueChange={(v) => {
          // Guard against undefined (double-click on same button)
          if (v) {
            onChange(v as CorrectionSource);
          }
        }}
        disabled={disabled}
        className="justify-start"
      >
        <ToggleGroupItem 
          value="musicbrainz" 
          className="px-3 py-1.5 text-sm"
          aria-label="Search MusicBrainz"
        >
          MusicBrainz
        </ToggleGroupItem>
        <ToggleGroupItem 
          value="discogs" 
          className="px-3 py-1.5 text-sm"
          aria-label="Search Discogs"
        >
          Discogs
        </ToggleGroupItem>
      </ToggleGroup>
    </div>
  );
}
```

Update src/components/admin/correction/shared/index.ts to export SourceToggle:
Add: export { SourceToggle } from './SourceToggle';

Re-export type for convenience:
Add: export type { CorrectionSource } from '@/stores/useCorrectionStore';
  </action>
  <verify>
1. File exists: ls src/components/admin/correction/shared/SourceToggle.tsx
2. Export exists: grep "SourceToggle" src/components/admin/correction/shared/index.ts
3. pnpm type-check passes
  </verify>
  <done>SourceToggle component created and exported from shared/index.ts</done>
</task>

<task type="auto">
  <name>Task 2: Integrate SourceToggle into album SearchView</name>
  <files>src/components/admin/correction/search/SearchView.tsx</files>
  <action>
Add the SourceToggle component to the top of SearchView.

1. Import SourceToggle and store access:
```typescript
import { SourceToggle } from '../shared';
```

2. Read correctionSource from store (add to existing store selectors):
```typescript
const correctionSource = store(s => s.correctionSource);
const setCorrectionSource = store.getState().setCorrectionSource;
```

3. Add SourceToggle at the TOP of the component return, BEFORE SearchInputs:
```typescript
return (
  <div className="space-y-4">
    {/* Source toggle */}
    <SourceToggle
      value={correctionSource}
      onChange={setCorrectionSource}
      disabled={isLoading}
    />

    {/* Existing SearchInputs */}
    <SearchInputs
      initialAlbumTitle={currentQuery.albumTitle}
      // ...
    />

    {/* Rest of existing content */}
  </div>
);
```

4. Add "Coming soon" state when Discogs is selected (temporary until Phase 22):
After the SourceToggle, before SearchInputs:
```typescript
{correctionSource === 'discogs' && (
  <div className="p-4 text-center text-zinc-500 border border-dashed border-zinc-700 rounded-lg">
    <p className="text-sm">Discogs search coming soon</p>
    <p className="text-xs text-zinc-600 mt-1">Switch to MusicBrainz to search</p>
  </div>
)}

{correctionSource === 'musicbrainz' && (
  <>
    {/* Existing SearchInputs and results */}
    <SearchInputs ... />
    {/* ... rest of content ... */}
  </>
)}
```

This ensures UI is present for testing Phase 21 before Phase 22 adds Discogs search.
  </action>
  <verify>
1. SourceToggle import exists: grep "SourceToggle" src/components/admin/correction/search/SearchView.tsx
2. correctionSource read from store: grep "correctionSource" src/components/admin/correction/search/SearchView.tsx
3. pnpm type-check passes
4. pnpm lint passes
  </verify>
  <done>Album SearchView displays source toggle at top with placeholder for Discogs</done>
</task>

<task type="auto">
  <name>Task 3: Integrate SourceToggle into artist ArtistSearchView</name>
  <files>src/components/admin/correction/artist/search/ArtistSearchView.tsx</files>
  <action>
Add the SourceToggle component to ArtistSearchView, mirroring the album SearchView pattern.

1. Import SourceToggle:
```typescript
import { SourceToggle } from '../../shared';
```

2. Read correctionSource from artist store:
```typescript
const correctionSource = store(s => s.correctionSource);
const setCorrectionSource = store.getState().setCorrectionSource;
```

3. Add SourceToggle at the TOP of the component return:
```typescript
return (
  <div className="space-y-4">
    {/* Source toggle */}
    <SourceToggle
      value={correctionSource}
      onChange={setCorrectionSource}
      disabled={isLoading}
    />

    {/* Coming soon for Discogs */}
    {correctionSource === 'discogs' && (
      <div className="p-4 text-center text-zinc-500 border border-dashed border-zinc-700 rounded-lg">
        <p className="text-sm">Discogs artist search coming soon</p>
        <p className="text-xs text-zinc-600 mt-1">Switch to MusicBrainz to search</p>
      </div>
    )}

    {/* MusicBrainz search (existing content) */}
    {correctionSource === 'musicbrainz' && (
      <>
        {/* Existing search input and results */}
        <div className="flex gap-2">
          <Input ... />
          <Button ...>Search</Button>
        </div>
        {/* ... rest of existing content ... */}
      </>
    )}
  </div>
);
```

Note: Artist search view has slightly different structure (single input vs album+artist inputs).
Wrap the ENTIRE existing search content in the musicbrainz conditional.
  </action>
  <verify>
1. SourceToggle import exists: grep "SourceToggle" src/components/admin/correction/artist/search/ArtistSearchView.tsx
2. correctionSource read from store: grep "correctionSource" src/components/admin/correction/artist/search/ArtistSearchView.tsx
3. pnpm type-check passes
4. pnpm lint passes
  </verify>
  <done>Artist ArtistSearchView displays source toggle at top with placeholder for Discogs</done>
</task>

</tasks>

<verification>
1. SourceToggle component exists in shared folder
2. Both SearchView and ArtistSearchView render SourceToggle
3. Clicking toggle updates store state (verify in React DevTools or by observing UI change)
4. Switching from MusicBrainz to Discogs shows "Coming soon" message
5. Switching sources clears search results (verify by searching, then toggling)
6. pnpm type-check passes
7. pnpm lint passes
</verification>

<success_criteria>
1. SourceToggle component renders MusicBrainz/Discogs options
2. Toggle appears at top of album search step (CorrectionModal step 1)
3. Toggle appears at top of artist search step (ArtistCorrectionModal step 1)
4. Selecting Discogs shows placeholder message (Phase 22 will replace)
5. Selecting MusicBrainz shows existing search functionality
6. Source selection persists when navigating between modal steps
</success_criteria>

<output>
After completion, create `.planning/phases/21-source-selection-ui/21-02-SUMMARY.md`
</output>
