---
phase: 21-source-selection-ui
plan: 03
type: execute
wave: 2
depends_on: ['21-01']
files_modified:
  - src/components/admin/correction/preview/PreviewView.tsx
  - src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - 'Preview view shows source indicator badge'
    - "Badge displays 'MusicBrainz' or 'Discogs' text"
    - 'Badge is visible in header area of preview'
  artifacts:
    - path: 'src/components/admin/correction/preview/PreviewView.tsx'
      provides: 'Album preview with source badge'
      contains: 'Badge'
    - path: 'src/components/admin/correction/artist/preview/ArtistPreviewView.tsx'
      provides: 'Artist preview with source badge'
      contains: 'Badge'
  key_links:
    - from: 'PreviewView'
      to: 'useCorrectionStore'
      via: 'correctionSource read for badge display'
      pattern: 'correctionSource'
    - from: 'ArtistPreviewView'
      to: 'useArtistCorrectionStore'
      via: 'correctionSource read for badge display'
      pattern: 'correctionSource'
---

<objective>
Add source indicator badges to preview views showing which data source (MusicBrainz/Discogs) the preview data comes from.

Purpose: Admins have clear visual confirmation of which source they're previewing data from before applying corrections.

Output:

- PreviewView with source indicator badge
- ArtistPreviewView with source indicator badge
  </objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/21-source-selection-ui/21-RESEARCH.md
@.planning/phases/21-source-selection-ui/21-01-SUMMARY.md

@src/components/ui/badge.tsx
@src/stores/useCorrectionStore.ts
@src/stores/useArtistCorrectionStore.ts
@src/components/admin/correction/preview/PreviewView.tsx
@src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add source badge to album PreviewView</name>
  <files>src/components/admin/correction/preview/PreviewView.tsx</files>
  <action>
Add source indicator badge to the PreviewView header.

1. Import Badge component:

```typescript
import { Badge } from '@/components/ui/badge';
```

2. Read correctionSource from store (add near other store reads):

```typescript
const correctionSource = store(s => s.correctionSource);
```

3. Find the preview header/title area. Look for where the preview content starts.
   Add a source badge in the header section. The exact location depends on existing structure.

   Option A - If there's a clear header div:

```typescript
<div className="flex items-center justify-between mb-4">
  <h3 className="text-lg font-semibold text-zinc-100">Preview Changes</h3>
  <Badge
    variant="outline"
    className="text-xs border-zinc-600 text-zinc-300"
  >
    {correctionSource === 'musicbrainz' ? 'MusicBrainz' : 'Discogs'}
  </Badge>
</div>
```

Option B - If header is inline with other elements:

```typescript
<div className="flex items-center gap-2 mb-4">
  <h3 className="text-lg font-semibold text-zinc-100">Preview Changes</h3>
  <Badge
    variant="outline"
    className="text-xs border-zinc-600 text-zinc-300"
  >
    {correctionSource === 'musicbrainz' ? 'MusicBrainz' : 'Discogs'}
  </Badge>
</div>
```

4. Style the badge to match the dark theme:
   - variant="outline" for subtle appearance
   - text-xs for small text
   - border-zinc-600 and text-zinc-300 for muted appearance
   - Capitalize the source name for readability

Note: The badge should appear near the top of the preview, NOT on every field comparison row.
It serves as a header-level indicator of the data source.
</action>
<verify>

1. Badge import exists: grep "Badge" src/components/admin/correction/preview/PreviewView.tsx
2. correctionSource read: grep "correctionSource" src/components/admin/correction/preview/PreviewView.tsx
3. Badge rendered with source text: grep -A2 "Badge" src/components/admin/correction/preview/PreviewView.tsx
4. pnpm type-check passes
   </verify>
   <done>Album PreviewView shows source indicator badge in header</done>
   </task>

<task type="auto">
  <name>Task 2: Add source badge to artist ArtistPreviewView</name>
  <files>src/components/admin/correction/artist/preview/ArtistPreviewView.tsx</files>
  <action>
Add source indicator badge to the ArtistPreviewView header, mirroring the album preview pattern.

1. Import Badge component:

```typescript
import { Badge } from '@/components/ui/badge';
```

2. Read correctionSource from artist store (add near other store reads):

```typescript
const correctionSource = store(s => s.correctionSource);
```

3. Find the preview header area and add the badge. Look for where artist preview starts.
   The artist preview has a similar structure to album preview with accordion sections.

   Add badge near the preview header:

```typescript
<div className="flex items-center gap-2 mb-4">
  <h3 className="text-lg font-semibold text-zinc-100">Preview Changes</h3>
  <Badge
    variant="outline"
    className="text-xs border-zinc-600 text-zinc-300"
  >
    {correctionSource === 'musicbrainz' ? 'MusicBrainz' : 'Discogs'}
  </Badge>
</div>
```

4. If there's no clear header element, add one BEFORE the accordion sections:
   - Wrap existing content in a structure that includes the header
   - Keep existing accordion layout intact

5. Ensure the badge uses the same styling as the album preview badge for consistency:
   - variant="outline"
   - text-xs border-zinc-600 text-zinc-300
   - Readable source name (MusicBrainz / Discogs)
     </action>
     <verify>
6. Badge import exists: grep "Badge" src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
7. correctionSource read: grep "correctionSource" src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
8. pnpm type-check passes
9. pnpm lint passes
   </verify>
   <done>Artist ArtistPreviewView shows source indicator badge in header</done>
   </task>

</tasks>

<verification>
1. Both preview views import Badge component
2. Both preview views read correctionSource from their respective stores
3. Badge displays correct source text (MusicBrainz when that's selected)
4. Badge styling is consistent between album and artist previews
5. Badge is visible in header area, not repeated on every row
6. pnpm type-check passes
7. pnpm lint passes
</verification>

<success_criteria>

1. Album PreviewView shows "MusicBrainz" badge (when MusicBrainz selected)
2. Artist ArtistPreviewView shows "MusicBrainz" badge (when MusicBrainz selected)
3. Badge uses outline variant with muted zinc styling
4. Badge is positioned in header area for clarity
5. Source badge text matches selected source in store
   </success_criteria>

<output>
After completion, create `.planning/phases/21-source-selection-ui/21-03-SUMMARY.md`
</output>
