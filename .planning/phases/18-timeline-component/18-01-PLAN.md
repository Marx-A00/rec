---
phase: 18-timeline-component
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/timeline/timeline.tsx
  - src/components/ui/timeline/timeline-layout.tsx
  - src/components/ui/timeline/index.ts
  - src/components/admin/enrichment-timeline-utils.ts
autonomous: true

must_haves:
  truths:
    - Timeline component exports are importable from @/components/ui/timeline
    - mapEnrichmentStatus converts EnrichmentLogStatus to timeline status
    - getOperationIcon returns appropriate icon for each operation type
    - getStatusColor returns color variant based on status
  artifacts:
    - path: src/components/ui/timeline/timeline.tsx
      provides: Timeline, TimelineItem, TimelineIcon, TimelineConnector, TimelineHeader, TimelineTitle, TimelineDescription, TimelineTime, TimelineContent, TimelineEmpty
      min_lines: 200
    - path: src/components/ui/timeline/timeline-layout.tsx
      provides: TimelineLayout with Framer Motion animations
      min_lines: 50
    - path: src/components/ui/timeline/index.ts
      provides: Re-exports from timeline and timeline-layout
      exports: ['Timeline', 'TimelineItem', 'TimelineLayout']
    - path: src/components/admin/enrichment-timeline-utils.ts
      provides: Mapping utilities for EnrichmentLog to timeline
      exports: ['mapEnrichmentStatus', 'getOperationIcon', 'getStatusColor', 'formatOperationTitle', 'mapLogToTimelineItem']
  key_links:
    - from: src/components/ui/timeline/timeline.tsx
      to: framer-motion
      via: motion.div import
      pattern: "from 'framer-motion'"
    - from: src/components/admin/enrichment-timeline-utils.ts
      to: '@/generated/graphql'
      via: EnrichmentLogStatus import
      pattern: "from '@/generated/graphql'"
---

<objective>
Copy shadcn-timeline component and create EnrichmentLog mapping utilities.

Purpose: Establish the foundational timeline UI components and status/icon mapping functions that EnrichmentTimeline will consume.

Output: Timeline component in src/components/ui/timeline/ and mapping utilities in src/components/admin/enrichment-timeline-utils.ts
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-timeline-component/18-RESEARCH.md
@.planning/phases/18-timeline-component/18-CONTEXT.md

@src/generated/graphql.ts (EnrichmentLogStatus enum, EnrichmentLog type)
@src/lib/queue/jobs.ts (JOB_TYPES constants for operation mapping)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Copy shadcn-timeline components to project</name>
  <files>
    src/components/ui/timeline/timeline.tsx
    src/components/ui/timeline/timeline-layout.tsx
    src/components/ui/timeline/index.ts
  </files>
  <action>
    Create the timeline directory and copy components from shadcn-timeline (https://github.com/timDeHof/shadcn-timeline/tree/main/src/components/timeline).

    1. Create src/components/ui/timeline/ directory

    2. Create timeline.tsx with these components:
       - Timeline: Container with cva variants for size (sm/md/lg)
       - TimelineItem: Individual item with motion support, status (completed/in-progress/pending), loading state
       - TimelineIcon: Icon display with color variants (primary/secondary/muted/accent) and size variants
       - TimelineConnector: Vertical line between items
       - TimelineHeader, TimelineTitle, TimelineDescription: Content structure
       - TimelineTime: Date/time formatting with Intl.DateTimeFormat and relative time
       - TimelineContent: Wrapper for item content
       - TimelineEmpty: Fallback when no items

       Key implementation notes:
       - Add 'use client' directive (Framer Motion requires client-side)
       - Import from 'framer-motion', 'lucide-react', 'class-variance-authority'
       - Use cn() from '@/lib/utils' for className merging
       - Filter Framer Motion props before passing to DOM elements
       - Support status states: completed, in-progress, pending
       - Support loading state with Loader2 icon and pulse animation
       - Support error state with AlertCircle and alert styling

    3. Create timeline-layout.tsx:
       - TimelineLayout: Wrapper component that renders timeline with animated items
       - Animation: initial={{ opacity: 0, y: 20 }}, animate={{ opacity: 1, y: 0 }}
       - Transition: 0.5s duration, staggered delay 0.1s per item, easeOut
       - Renders items in reverse order (newest first at top)
       - Hides connector on final item

    4. Create index.ts:
       - Re-export all from './timeline'
       - Re-export all from './timeline-layout'

    Adapt imports for project conventions:
    - Use import { cn } from '@/lib/utils' (not local cn)
    - Use existing lucide-react icons (Loader2, AlertCircle, Check)
  </action>
  <verify>
    - ls src/components/ui/timeline/ shows timeline.tsx, timeline-layout.tsx, index.ts
    - pnpm type-check passes (no TypeScript errors in timeline files)
    - Can import: import { Timeline, TimelineItem, TimelineLayout } from '@/components/ui/timeline'
  </verify>
  <done>
    Timeline component files exist with proper exports. TypeScript compiles without errors. Components are importable from @/components/ui/timeline.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create EnrichmentLog mapping utilities</name>
  <files>src/components/admin/enrichment-timeline-utils.ts</files>
  <action>
    Create utility functions to map EnrichmentLog data to timeline component props.

    Create src/components/admin/enrichment-timeline-utils.ts with:

    1. Type definitions:
       - TimelineStatus = 'completed' | 'in-progress' | 'pending'
       - TimelineIconColor = 'primary' | 'secondary' | 'muted' | 'accent'

    2. mapEnrichmentStatus(status: EnrichmentLogStatus): TimelineStatus
       - SUCCESS, PARTIAL_SUCCESS, FAILED, NO_DATA_AVAILABLE, SKIPPED -> 'completed' (finished states)
       - PREVIEW -> 'pending' (not yet applied)
       - unknown -> 'in-progress' (safeguard)

    3. getStatusColor(status: EnrichmentLogStatus): TimelineIconColor
       - SUCCESS -> 'primary' (green)
       - PARTIAL_SUCCESS -> 'accent' (yellow)
       - FAILED -> 'secondary' (red)
       - NO_DATA_AVAILABLE, SKIPPED -> 'muted' (gray)
       - PREVIEW -> 'accent' (blue-ish)

    4. OPERATION_ICONS mapping and getOperationIcon(operation: string): LucideIcon
       - Album operations: enrichment:album, check:album-enrichment -> Disc, cache:album-cover-art -> Cloud
       - Artist operations: enrichment:artist, check:artist-enrichment -> User, cache:artist-image -> Cloud
       - Track operations: enrichment:track, check:track-enrichment -> Music
       - Discogs operations: discogs:search-artist -> Search, discogs:get-artist -> Database
       - MusicBrainz operations: musicbrainz:search-artists -> Search, musicbrainz:lookup-* -> Database
       - Default fallback: Database icon

    5. formatOperationTitle(operation: string, entityType?: string | null): string
       - 'enrichment:album' -> 'Album Enrichment'
       - 'cache:album-cover-art' -> 'Album Cover Art (cache)'
       - 'PREVIEW_ENRICHMENT' -> 'Preview Enrichment'

    6. truncateError(error: string | null | undefined, maxLength = 100): string | undefined
       - Per CONTEXT.md: first line of error visible inline, full error on expand
       - Returns first line, truncated to maxLength with '...'

    7. getItemDescription(log: Pick<EnrichmentLog, 'reason' | 'fieldsEnriched' | 'status'>): string
       - If log.reason exists, return it
       - Otherwise: 'X fields enriched' or 'Skipped - no changes needed'

    Import from:
    - @/generated/graphql for EnrichmentLogStatus, EnrichmentLog types
    - lucide-react for Disc, User, Music, Cloud, Search, Database icons

    All exports should have JSDoc comments for IntelliSense.
  </action>
  <verify>
    - pnpm type-check passes
    - File exists at src/components/admin/enrichment-timeline-utils.ts
    - Can import: import { mapEnrichmentStatus, getOperationIcon } from '@/components/admin/enrichment-timeline-utils'
  </verify>
  <done>
    Mapping utilities exist with correct type signatures. mapEnrichmentStatus maps all 6 EnrichmentLogStatus values. getOperationIcon maps all operation types from JOB_TYPES.
  </done>
</task>

</tasks>

<verification>
1. Timeline components exist and export correctly
2. Mapping utilities compile with no TypeScript errors
3. All EnrichmentLogStatus values are handled (no switch fallthrough warnings)
4. Operation icons cover album, artist, track, discogs, and cache operations
</verification>

<success_criteria>
- src/components/ui/timeline/ directory exists with 3 files
- Timeline, TimelineItem, TimelineLayout importable
- mapEnrichmentStatus, getOperationIcon, getStatusColor, formatOperationTitle exportable
- pnpm type-check passes
- No new lint errors
</success_criteria>

<output>
After completion, create .planning/phases/18-timeline-component/18-01-SUMMARY.md
</output>
