---
phase: 18-timeline-component
plan: 02
type: execute
wave: 2
depends_on: ['18-01']
files_modified:
  - src/components/admin/EnrichmentTimeline.tsx
  - src/components/admin/EnrichmentTree.tsx
autonomous: true

must_haves:
  truths:
    - EnrichmentTimeline renders parent logs with nested children
    - View switcher toggles between timeline and tree view
    - Long chains (15+ children) are truncated with "Show more" button
    - Status icons and colors reflect EnrichmentLogStatus correctly
    - Click anywhere on item expands to show details
    - Staggered fade-in animation on load
  artifacts:
    - path: src/components/admin/EnrichmentTimeline.tsx
      provides: Main timeline wrapper with view switcher, truncation, and parent-child rendering
      min_lines: 150
    - path: src/components/admin/EnrichmentTree.tsx
      provides: Simple tree fallback view for when timeline is problematic
      min_lines: 50
  key_links:
    - from: src/components/admin/EnrichmentTimeline.tsx
      to: src/components/ui/timeline
      via: Timeline, TimelineItem imports
      pattern: "from '@/components/ui/timeline'"
    - from: src/components/admin/EnrichmentTimeline.tsx
      to: src/components/admin/enrichment-timeline-utils.ts
      via: mapping function imports
      pattern: "from './enrichment-timeline-utils'"
    - from: src/components/admin/EnrichmentTimeline.tsx
      to: '@/generated/graphql'
      via: EnrichmentLog type
      pattern: "from '@/generated/graphql'"
---

<objective>
Create the EnrichmentTimeline wrapper component with view switcher and tree fallback.

Purpose: Provide a ready-to-use component that takes EnrichmentLog[] (with children) and renders a beautiful, animated timeline with proper status/icon mapping and UX features from CONTEXT.md.

Output: EnrichmentTimeline.tsx and EnrichmentTree.tsx in src/components/admin/
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-timeline-component/18-RESEARCH.md
@.planning/phases/18-timeline-component/18-CONTEXT.md
@.planning/phases/18-timeline-component/18-01-SUMMARY.md

@src/components/ui/timeline/index.ts
@src/components/admin/enrichment-timeline-utils.ts
@src/generated/graphql.ts (EnrichmentLog type with children field)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EnrichmentTree fallback component</name>
  <files>src/components/admin/EnrichmentTree.tsx</files>
  <action>
    Create a simple tree view fallback component per CONTEXT.md decision (view switcher as safety valve).

    Create src/components/admin/EnrichmentTree.tsx with:

    1. 'use client' directive

    2. Props interface:
       - logs: EnrichmentLog[] (may have children arrays)

    3. Simple tree rendering:
       - Map over logs, render each as a div with indentation
       - Show: operation, status badge, timestamp
       - If log.children exists, render nested list with left margin
       - Use existing Badge component for status
       - Use formatDistanceToNow from date-fns for relative timestamps

    4. Styling:
       - Simple left-border or indent for nested items
       - Compact view compared to timeline
       - Use existing project Tailwind patterns (bg-zinc-800, text-zinc-400, etc.)

    This is intentionally simple - it's a fallback when timeline rendering fails.

  </action>
  <verify>
    - File exists at src/components/admin/EnrichmentTree.tsx
    - pnpm type-check passes
    - Component accepts EnrichmentLog[] prop
  </verify>
  <done>
    EnrichmentTree component exists as a simple, functional tree view fallback. Renders parent logs with indented children.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create EnrichmentTimeline wrapper component</name>
  <files>src/components/admin/EnrichmentTimeline.tsx</files>
  <action>
    Create the main timeline component that consumes EnrichmentLog data.

    Create src/components/admin/EnrichmentTimeline.tsx with:

    1. 'use client' directive

    2. Props interface:
       - logs: EnrichmentLog[] (parent logs with optional children arrays from resolver)
       - className?: string (optional container styling)

    3. State:
       - viewMode: 'timeline' | 'tree' (default: 'timeline')
       - expandedItems: Set<string> for tracking which items are expanded
       - showAllChildren: Record<string, boolean> for truncation toggle per parent

    4. View Switcher (per CONTEXT.md):
       - Two buttons at top: Timeline (List icon), Tree (GitBranch icon)
       - Active state styling (bg-primary vs bg-muted)
       - Render EnrichmentTimeline content or EnrichmentTree based on mode

    5. Timeline Rendering:
       - Import Timeline, TimelineItem from '@/components/ui/timeline'
       - Import mapping functions from './enrichment-timeline-utils'
       - For each log:
         a. Create TimelineItem with:
            - date: new Date(log.createdAt)
            - title: formatOperationTitle(log.operation, log.entityType)
            - description: getItemDescription(log)
            - icon: Render getOperationIcon(log.operation) with size={16}
            - iconColor: getStatusColor(log.status)
            - status: mapEnrichmentStatus(log.status)
            - error: if status is FAILED, truncateError(log.errorMessage)
         b. If log.children exists and length > 0:
            - Render nested Timeline with size="sm"
            - Apply TRUNCATION_THRESHOLD = 15 logic
            - Show first 15 children by default
            - "Show X more..." button to expand

    6. Item Expansion (per CONTEXT.md: click anywhere to expand):
       - Track expandedItems in state
       - On click, toggle log.id in expandedItems set
       - When expanded, show:
         - Full error message (if exists)
         - Duration if available in metadata
         - Fields enriched list
       - Parent item collapse/expand toggle for children

    7. Empty State:
       - If logs.length === 0, show TimelineEmpty or custom empty message
       - "No enrichment history" with subtle icon

    8. Animation:
       - Use TimelineLayout for staggered animation OR
       - Apply motion variants to container for staggerChildren effect

    Key patterns from RESEARCH.md:
    - Parent larger/bolder than children (use default vs sm size)
    - Relative timestamps by default ("2m ago")
    - Hover: subtle shadow (Tailwind: hover:shadow-md)

  </action>
  <verify>
    - File exists at src/components/admin/EnrichmentTimeline.tsx
    - pnpm type-check passes
    - pnpm lint passes (no unused imports, proper React patterns)
    - Component renders without errors when given empty array
    - Component renders with mock data showing parent and children
  </verify>
  <done>
    EnrichmentTimeline component exists with:
    - View switcher (timeline/tree)
    - Parent-child rendering with proper hierarchy
    - Truncation for long chains (15+ children)
    - Click-to-expand for details
    - Staggered animations on load
    - Empty state handling
  </done>
</task>

</tasks>

<verification>
1. Both EnrichmentTimeline.tsx and EnrichmentTree.tsx exist and compile
2. View switcher toggles between timeline and tree view
3. Timeline renders parent items with nested children
4. Long chains (15+ children) show truncation with "Show more" button
5. Status colors and icons map correctly for all EnrichmentLogStatus values
6. Empty state renders appropriately
7. pnpm type-check and pnpm lint both pass
</verification>

<success_criteria>

- EnrichmentTimeline component is complete and importable
- View switcher works (toggle between timeline and tree)
- Parent-child hierarchy renders correctly
- Truncation works for chains > 15 children
- All status types show appropriate icon and color
- Component is ready for integration in Phase 19
  </success_criteria>

<output>
After completion, create .planning/phases/18-timeline-component/18-02-SUMMARY.md
</output>
