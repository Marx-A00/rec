---
phase: 12-polish-recovery
plan: 01
type: execute
wave: 1
depends_on: ["11-04"]
files_modified:
  - src/components/admin/correction/shared/ErrorState.tsx
  - src/components/admin/correction/shared/RetryButton.tsx
  - src/components/admin/correction/search/SearchView.tsx
  - src/components/admin/correction/preview/PreviewView.tsx
  - src/components/admin/correction/artist/search/ArtistSearchView.tsx
  - src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
autonomous: true

must_haves:
  truths:
    - "Failed API calls show retry button with clear error message"
    - "Error types are categorized (network, rate-limit, validation)"
    - "Error state is visually distinct and actionable"
  artifacts:
    - path: "src/components/admin/correction/shared/ErrorState.tsx"
      provides: "Reusable error display component"
      exports: ["ErrorState"]
    - path: "src/components/admin/correction/shared/RetryButton.tsx"
      provides: "Retry button with loading state"
      exports: ["RetryButton"]
---

<objective>
Add proper error states with retry functionality to correction modal components.

Purpose: Failed searches and previews should provide clear feedback and recovery options.
Output: Reusable error components integrated into search and preview views.
</objective>

<context>
@.planning/phases/12-polish-recovery/12-RESEARCH.md
@src/components/admin/correction/search/SearchView.tsx
@src/components/admin/correction/preview/PreviewView.tsx
@src/components/admin/correction/artist/search/ArtistSearchView.tsx
@src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared error components</name>
  <files>
    src/components/admin/correction/shared/ErrorState.tsx
    src/components/admin/correction/shared/RetryButton.tsx
    src/components/admin/correction/shared/index.ts
  </files>
  <action>
Create reusable error display components.

In ErrorState.tsx:
```typescript
interface ErrorStateProps {
  title?: string;
  message: string;
  type?: 'network' | 'rate-limit' | 'validation' | 'unknown';
  onRetry?: () => void;
  isRetrying?: boolean;
  className?: string;
}
```
- AlertCircle icon (red) for errors
- Title defaults based on type:
  - network: "Connection Error"
  - rate-limit: "Too Many Requests"
  - validation: "Invalid Request"
  - unknown: "Something Went Wrong"
- Message displayed below title
- Helpful hints based on type (e.g., "Check your internet connection")
- Optional retry button when onRetry provided
- Dark theme styling (zinc-800 background, red-500 accents)

In RetryButton.tsx:
```typescript
interface RetryButtonProps {
  onClick: () => void;
  isLoading?: boolean;
  children?: React.ReactNode;
}
```
- RefreshCw icon with spin animation when loading
- "Try Again" default text
- Disabled when loading
- Ghost variant, zinc styling

In index.ts:
- Export both components
  </action>
  <verify>Run `pnpm type-check` - components compile</verify>
  <done>ErrorState and RetryButton components created with proper types</done>
</task>

<task type="auto">
  <name>Task 2: Integrate error states into album correction views</name>
  <files>
    src/components/admin/correction/search/SearchView.tsx
    src/components/admin/correction/preview/PreviewView.tsx
  </files>
  <action>
Replace inline error handling with ErrorState component.

In SearchView.tsx:
- Import ErrorState from shared
- Replace existing error display with ErrorState component
- Add onRetry that calls refetch() from useSearchCorrectionCandidatesQuery
- Categorize error type based on error message/code:
  - Contains "network" or "fetch" → 'network'
  - Contains "rate" or "429" → 'rate-limit'
  - Otherwise → 'unknown'
- Pass isRetrying based on query isFetching state

In PreviewView.tsx:
- Import ErrorState from shared
- Replace existing error display with ErrorState component
- Add onRetry that calls refetch() from useGetCorrectionPreviewQuery
- Same error categorization logic
- Show error state when query fails but user has selected a result

Keep existing success/loading patterns, only improve error states.
  </action>
  <verify>Run `pnpm type-check` - no type errors in modified files</verify>
  <done>Album search and preview show proper error states with retry</done>
</task>

<task type="auto">
  <name>Task 3: Integrate error states into artist correction views</name>
  <files>
    src/components/admin/correction/artist/search/ArtistSearchView.tsx
    src/components/admin/correction/artist/preview/ArtistPreviewView.tsx
  </files>
  <action>
Apply same error state pattern to artist correction views.

In ArtistSearchView.tsx:
- Import ErrorState from shared (adjust path: ../../shared)
- Replace existing error handling with ErrorState
- Add retry functionality
- Same error categorization

In ArtistPreviewView.tsx:
- Import ErrorState from shared
- Replace existing error handling with ErrorState
- Add retry functionality

Mirror the album correction patterns exactly for consistency.
  </action>
  <verify>Run `pnpm type-check && pnpm lint`</verify>
  <done>Artist search and preview show proper error states with retry</done>
</task>

</tasks>

<verification>
```bash
pnpm type-check
pnpm lint
# Manual: Open correction modal, simulate network error, verify retry works
```
</verification>

<success_criteria>
1. ErrorState component renders with appropriate icon and message
2. RetryButton shows loading spinner when retrying
3. Search views show error state with retry when API fails
4. Preview views show error state with retry when API fails
5. Error type categorization provides helpful context
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish-recovery/12-01-SUMMARY.md`
</output>
