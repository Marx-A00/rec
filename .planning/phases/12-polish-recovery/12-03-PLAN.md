---
phase: 12-polish-recovery
plan: 03
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified:
  - src/components/admin/correction/apply/ApplyView.tsx
  - src/components/admin/correction/artist/apply/ArtistApplyView.tsx
autonomous: true

must_haves:
  truths:
    - "Checkbox option to trigger re-enrichment after correction is applied"
    - "Enrichment is queued only when checkbox is checked and apply succeeds"
    - "User sees confirmation that enrichment was queued"
  artifacts:
    - path: "src/components/admin/correction/apply/ApplyView.tsx"
      provides: "Re-enrichment checkbox integrated into album apply flow"
    - path: "src/components/admin/correction/artist/apply/ArtistApplyView.tsx"
      provides: "Re-enrichment checkbox integrated into artist apply flow"
---

<objective>
Add "Re-enrich after correction" checkbox to ApplyView components.

Purpose: After applying corrections, users may want fresh data from MusicBrainz. This option queues an enrichment job automatically.
Output: Checkbox in apply view that triggers enrichment on successful correction.
</objective>

<context>
@src/components/admin/correction/apply/ApplyView.tsx
@src/components/admin/correction/artist/apply/ArtistApplyView.tsx
@src/components/albumDetails/AlbumAdminActions.tsx (reference for useTriggerAlbumEnrichmentMutation pattern)
@src/generated/graphql.ts (for mutation hooks)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add re-enrichment checkbox to album ApplyView</name>
  <files>
    src/components/admin/correction/apply/ApplyView.tsx
  </files>
  <action>
Add a checkbox option to trigger enrichment after successful correction.

1. Import required:
   - `useTriggerAlbumEnrichmentMutation, EnrichmentPriority` from '@/generated/graphql'
   - `Checkbox` from '@/components/ui/checkbox' (if not already)

2. Add state:
   ```typescript
   const [triggerEnrichment, setTriggerEnrichment] = useState(false);
   ```

3. Initialize mutation:
   ```typescript
   const enrichMutation = useTriggerAlbumEnrichmentMutation();
   ```

4. Add checkbox UI above or near the "Apply Corrections" button:
   ```tsx
   <div className="flex items-center gap-2">
     <Checkbox
       id="trigger-enrichment"
       checked={triggerEnrichment}
       onCheckedChange={(checked) => setTriggerEnrichment(checked === true)}
     />
     <label
       htmlFor="trigger-enrichment"
       className="text-sm text-zinc-400 cursor-pointer"
     >
       Re-enrich from MusicBrainz after applying
     </label>
   </div>
   ```

5. Modify the apply success handler (onSuccess callback or after successful mutation):
   ```typescript
   // After successful apply
   if (triggerEnrichment && albumId) {
     try {
       await enrichMutation.mutateAsync({
         id: albumId,
         priority: EnrichmentPriority.High,
       });
       // Toast already shows success, maybe append "Enrichment queued"
     } catch (error) {
       // Log but don't fail the correction - it already succeeded
       console.error('Failed to queue enrichment:', error);
     }
   }
   ```

6. Update success toast to indicate if enrichment was queued:
   - If triggerEnrichment: "Corrections applied. Enrichment queued."
   - If not: "Corrections applied successfully."
  </action>
  <verify>Run `pnpm type-check` - no type errors</verify>
  <done>Album ApplyView has re-enrichment checkbox that queues job on success</done>
</task>

<task type="auto">
  <name>Task 2: Add re-enrichment checkbox to artist ArtistApplyView</name>
  <files>
    src/components/admin/correction/artist/apply/ArtistApplyView.tsx
  </files>
  <action>
Apply same pattern to artist correction flow.

1. Import required:
   - `useTriggerArtistEnrichmentMutation, EnrichmentPriority` from '@/generated/graphql'
   - `Checkbox` from '@/components/ui/checkbox'

2. Add state and mutation (same pattern as album)

3. Add checkbox UI (same styling/placement)

4. Queue enrichment on successful artist correction apply

Note: Check if `useTriggerArtistEnrichmentMutation` exists. If not, use the album pattern as reference and check if artist enrichment is available. If no artist enrichment mutation exists, skip this task and note it in summary.
  </action>
  <verify>Run `pnpm type-check && pnpm lint`</verify>
  <done>Artist ApplyView has re-enrichment checkbox (or documented why skipped)</done>
</task>

</tasks>

<verification>
```bash
pnpm type-check
pnpm lint
# Manual: Open correction modal, apply with checkbox checked, verify enrichment queues
```
</verification>

<success_criteria>
1. Checkbox appears in album ApplyView
2. Checkbox is unchecked by default
3. Checking it and applying triggers enrichment mutation
4. Success message reflects whether enrichment was queued
5. Enrichment failure doesn't block correction success
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish-recovery/12-03-SUMMARY.md`
</output>
