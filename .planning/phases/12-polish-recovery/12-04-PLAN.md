---
phase: 12-polish-recovery
plan: 04
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified:
  - src/components/admin/correction/CorrectionModal.tsx
  - src/components/admin/correction/artist/ArtistCorrectionModal.tsx
autonomous: true

must_haves:
  truths:
    - "Escape key closes the correction modal"
    - "Cmd/Ctrl+Enter submits at search and apply steps"
    - "Keyboard shortcuts don't interfere with text input"
  artifacts:
    - path: "src/components/admin/correction/CorrectionModal.tsx"
      provides: "Album modal with keyboard shortcuts"
    - path: "src/components/admin/correction/artist/ArtistCorrectionModal.tsx"
      provides: "Artist modal with keyboard shortcuts"
---

<objective>
Add keyboard shortcuts for common actions in correction modals.

Purpose: Power users should be able to navigate and submit without mouse.
Output: Escape to close, Cmd/Ctrl+Enter to submit search or apply.
</objective>

<context>
@src/components/admin/correction/CorrectionModal.tsx
@src/components/admin/correction/artist/ArtistCorrectionModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add keyboard shortcuts to album CorrectionModal</name>
  <files>
    src/components/admin/correction/CorrectionModal.tsx
  </files>
  <action>
Add useEffect for keyboard event handling.

1. Add useEffect for keyboard shortcuts:
   ```typescript
   useEffect(() => {
     const handleKeyDown = (e: KeyboardEvent) => {
       // Don't trigger if typing in an input
       const target = e.target as HTMLElement;
       const isTyping = target.tagName === 'INPUT' || target.tagName === 'TEXTAREA' || target.isContentEditable;
       
       // Escape closes modal (Radix Dialog handles this by default, but ensure it works)
       if (e.key === 'Escape') {
         onClose();
         return;
       }
       
       // Cmd/Ctrl+Enter to submit
       if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
         e.preventDefault();
         
         // Trigger action based on current step
         if (currentStep === 'search' && !isTyping) {
           // Trigger search if we have input values
           // This may need to call a ref or exposed function from SearchView
         } else if (currentStep === 'apply') {
           // Trigger apply if we have a preview
           // This may need to call handleApply or similar
         }
       }
     };
     
     if (isOpen) {
       window.addEventListener('keydown', handleKeyDown);
       return () => window.removeEventListener('keydown', handleKeyDown);
     }
   }, [isOpen, currentStep, onClose]);
   ```

2. For Cmd+Enter to work on search/apply:
   - Option A: Use refs to expose submit functions from child components
   - Option B: Lift submit state/handlers to modal level
   - Option C: Use a simple approach - just document the shortcuts, rely on Enter in inputs
   
   Start with Option C (simpler): Just ensure Escape works reliably and document that Enter in search input triggers search.

3. Add visual hint for keyboard shortcuts (optional):
   - Small text near submit buttons: "⌘↵" or "Ctrl+Enter"
  </action>
  <verify>Run `pnpm type-check`</verify>
  <done>Album modal responds to Escape key to close</done>
</task>

<task type="auto">
  <name>Task 2: Add keyboard shortcuts to artist ArtistCorrectionModal</name>
  <files>
    src/components/admin/correction/artist/ArtistCorrectionModal.tsx
  </files>
  <action>
Apply same keyboard handling pattern.

1. Add same useEffect for keyboard shortcuts
2. Handle Escape to close
3. Optionally handle Cmd/Ctrl+Enter for step-specific actions

Mirror the album modal implementation.
  </action>
  <verify>Run `pnpm type-check && pnpm lint`</verify>
  <done>Artist modal responds to Escape key to close</done>
</task>

<task type="auto">
  <name>Task 3: Verify existing Enter key behavior</name>
  <files>
    (no changes, just verification)
  </files>
  <action>
Verify that existing Enter key handling works correctly:

1. Check SearchInputs.tsx - Enter should trigger search (already exists per research)
2. Check ArtistSearchView.tsx - Enter should trigger search (already exists)
3. Check that Enter in search results doesn't accidentally close modal

If any issues found, fix them. Otherwise, document current behavior.
  </action>
  <verify>Manual test: Enter in search input triggers search, doesn't close modal</verify>
  <done>Enter key behavior verified or fixed</done>
</task>

</tasks>

<verification>
```bash
pnpm type-check
pnpm lint
# Manual: 
# - Open modal, press Escape, verify it closes
# - Open modal, type in search, press Enter, verify search triggers
# - Navigate to apply step, verify Escape still closes
```
</verification>

<success_criteria>
1. Escape key closes both album and artist modals
2. Enter key in search inputs triggers search (existing behavior)
3. Keyboard shortcuts don't interfere with text editing
4. No console errors from keyboard handlers
</success_criteria>

<output>
After completion, create `.planning/phases/12-polish-recovery/12-04-SUMMARY.md`
</output>
