---
phase: 39-stats-streaks
plan: 03
type: execute
wave: 3
depends_on: ["39-02"]
files_modified:
  - src/components/uncover/StatsModal.tsx
  - src/components/uncover/GuessDistributionChart.tsx
  - src/components/uncover/UncoverGame.tsx
autonomous: true

must_haves:
  truths:
    - "Stats modal appears after game completion (won or lost)"
    - "Modal shows played, win rate, current streak, max streak"
    - "Guess distribution displays as horizontal bar chart"
    - "Today's result highlighted in distribution (if won)"
    - "Modal is dismissable (close button)"
  artifacts:
    - path: "src/components/uncover/StatsModal.tsx"
      provides: "Post-game stats modal component"
      exports: ["StatsModal"]
    - path: "src/components/uncover/GuessDistributionChart.tsx"
      provides: "Bar chart for guess distribution"
      exports: ["GuessDistributionChart"]
    - path: "src/components/uncover/UncoverGame.tsx"
      provides: "Stats modal integration"
      contains: "StatsModal"
  key_links:
    - from: "src/components/uncover/StatsModal.tsx"
      to: "src/generated/graphql.ts"
      via: "useMyUncoverStatsQuery hook"
      pattern: "useMyUncoverStatsQuery"
    - from: "src/components/uncover/UncoverGame.tsx"
      to: "src/components/uncover/StatsModal.tsx"
      via: "render on game over"
      pattern: "<StatsModal"
---

<objective>
Create stats modal UI with guess distribution chart and integrate into game component.

Purpose: STATS-07 requires stats viewable after each game. This plan creates the Wordle-style stats modal with 4-stat grid and horizontal bar chart for guess distribution.

Output: StatsModal and GuessDistributionChart components, UncoverGame integration to show modal on game completion.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/39-stats-streaks/39-RESEARCH.md
@.planning/phases/39-stats-streaks/39-02-SUMMARY.md
@src/components/uncover/UncoverGame.tsx
@src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GuessDistributionChart component</name>
  <files>src/components/uncover/GuessDistributionChart.tsx</files>
  <action>
Create horizontal bar chart component for guess distribution:

```typescript
'use client';

import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Cell,
  ResponsiveContainer,
  LabelList,
} from 'recharts';

interface GuessDistributionChartProps {
  /** Array of 6 integers: wins by attempt count (index 0 = 1-guess, etc.) */
  distribution: number[];
  /** If player won today, which attempt number (1-6) to highlight */
  todayAttempts?: number | null;
}

/**
 * Horizontal bar chart showing guess distribution (Wordle-style).
 * Displays wins by number of attempts (1-6).
 */
export function GuessDistributionChart({
  distribution,
  todayAttempts,
}: GuessDistributionChartProps) {
  // Transform array to chart data
  const data = distribution.map((count, index) => ({
    attempt: index + 1, // 1-6
    count,
    isToday: todayAttempts === index + 1,
  }));

  const maxCount = Math.max(...distribution, 1);

  return (
    <div className="w-full">
      <h3 className="mb-3 text-sm font-medium uppercase tracking-wide text-muted-foreground">
        Guess Distribution
      </h3>
      <div className="space-y-1.5">
        {data.map((item) => (
          <div key={item.attempt} className="flex items-center gap-2">
            <span className="w-4 text-sm font-medium">{item.attempt}</span>
            <div className="flex-1">
              <div
                className={`flex h-6 items-center justify-end rounded px-2 text-sm font-medium text-white transition-all ${
                  item.isToday
                    ? 'bg-green-600'
                    : item.count > 0
                      ? 'bg-zinc-600'
                      : 'bg-zinc-800'
                }`}
                style={{
                  width:
                    item.count > 0
                      ? `${Math.max((item.count / maxCount) * 100, 10)}%`
                      : '24px',
                  minWidth: '24px',
                }}
              >
                {item.count}
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}
```

This uses CSS for the bars instead of Recharts for simpler, more reliable horizontal bars that match Wordle's style. The Recharts ResponsiveContainer can be finicky with horizontal bars.
  </action>
  <verify>
`pnpm type-check` passes for GuessDistributionChart.tsx
  </verify>
  <done>
GuessDistributionChart component created with CSS-based horizontal bars, today highlight support
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StatsModal component</name>
  <files>src/components/uncover/StatsModal.tsx</files>
  <action>
Create the post-game stats modal:

```typescript
'use client';

import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { useMyUncoverStatsQuery } from '@/generated/graphql';
import { GuessDistributionChart } from './GuessDistributionChart';
import { Flame, Trophy } from 'lucide-react';

interface StatsModalProps {
  /** Whether modal is open */
  open: boolean;
  /** Callback when modal should close */
  onClose: () => void;
  /** Whether player won this game */
  won: boolean;
  /** Number of attempts in this game (for highlight) */
  attemptCount: number;
}

/**
 * Post-game stats modal (Wordle-style).
 * Shows games played, win rate, streaks, and guess distribution.
 */
export function StatsModal({
  open,
  onClose,
  won,
  attemptCount,
}: StatsModalProps) {
  const { data, isLoading } = useMyUncoverStatsQuery(
    {},
    { enabled: open } // Only fetch when modal opens
  );

  const stats = data?.myUncoverStats;

  return (
    <Dialog open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>
      <DialogContent className="max-w-sm">
        <DialogHeader>
          <DialogTitle className="text-center text-2xl">
            {won ? 'ðŸŽ‰ You Won!' : 'Game Over'}
          </DialogTitle>
        </DialogHeader>

        {isLoading ? (
          <div className="flex items-center justify-center py-8">
            <div className="text-muted-foreground">Loading stats...</div>
          </div>
        ) : stats ? (
          <div className="space-y-6 py-4">
            {/* Stats Grid - 4 columns */}
            <div className="grid grid-cols-4 gap-2 text-center">
              <div>
                <div className="text-2xl font-bold md:text-3xl">
                  {stats.gamesPlayed}
                </div>
                <div className="text-[10px] text-muted-foreground md:text-xs">
                  Played
                </div>
              </div>
              <div>
                <div className="text-2xl font-bold md:text-3xl">
                  {Math.round(stats.winRate * 100)}
                </div>
                <div className="text-[10px] text-muted-foreground md:text-xs">
                  Win %
                </div>
              </div>
              <div>
                <div className="flex items-center justify-center gap-1 text-2xl font-bold md:text-3xl">
                  <Flame className="h-5 w-5 text-orange-500 md:h-6 md:w-6" />
                  {stats.currentStreak}
                </div>
                <div className="text-[10px] text-muted-foreground md:text-xs">
                  Streak
                </div>
              </div>
              <div>
                <div className="flex items-center justify-center gap-1 text-2xl font-bold md:text-3xl">
                  <Trophy className="h-5 w-5 text-yellow-500 md:h-6 md:w-6" />
                  {stats.maxStreak}
                </div>
                <div className="text-[10px] text-muted-foreground md:text-xs">
                  Best
                </div>
              </div>
            </div>

            {/* Guess Distribution Chart */}
            <GuessDistributionChart
              distribution={stats.winDistribution}
              todayAttempts={won ? attemptCount : null}
            />

            {/* Next Game Message */}
            <p className="text-center text-sm text-muted-foreground">
              Come back tomorrow for a new challenge!
            </p>

            {/* Close Button */}
            <button
              onClick={onClose}
              className="w-full rounded-md bg-primary px-4 py-3 font-medium text-primary-foreground transition-colors hover:bg-primary/90"
            >
              Close
            </button>
          </div>
        ) : (
          <div className="py-8 text-center text-muted-foreground">
            No stats available
          </div>
        )}
      </DialogContent>
    </Dialog>
  );
}
```

Uses shadcn/ui Dialog for accessible modal. Fetches stats with generated hook. Shows 4-stat grid and distribution chart.
  </action>
  <verify>
`pnpm type-check` passes for StatsModal.tsx
  </verify>
  <done>
StatsModal component created with 4-stat grid, distribution chart, close button
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate StatsModal into UncoverGame</name>
  <files>src/components/uncover/UncoverGame.tsx</files>
  <action>
Update UncoverGame.tsx to show StatsModal on game completion:

1. **Add imports at top:**
```typescript
import { StatsModal } from '@/components/uncover/StatsModal';
```

2. **Add state for modal visibility** (inside UncoverGame function, with other useState):
```typescript
const [showStats, setShowStats] = useState(false);
```

3. **Add effect to auto-show modal on game over** (after existing useEffect):
```typescript
// Auto-show stats modal when game ends
useEffect(() => {
  if (game.isGameOver && !showStats) {
    // Delay slightly for game-over animation to complete
    const timer = setTimeout(() => setShowStats(true), 800);
    return () => clearTimeout(timer);
  }
}, [game.isGameOver, showStats]);
```

4. **Add StatsModal to the game over section** (in the `if (game.isGameOver)` block, at the end before closing `</div>`):
```typescript
{/* Stats Modal */}
<StatsModal
  open={showStats}
  onClose={() => setShowStats(false)}
  won={game.won}
  attemptCount={game.attemptCount}
/>
```

5. **Add "View Stats" button** in the game over section (after "Come back tomorrow" text):
```typescript
<button
  onClick={() => setShowStats(true)}
  className="mt-4 rounded-md bg-primary px-6 py-2 font-medium text-primary-foreground transition-colors hover:bg-primary/90"
>
  View Stats
</button>
```

This allows users to re-open the stats modal after dismissing it.
  </action>
  <verify>
`pnpm type-check` passes for UncoverGame.tsx
  </verify>
  <done>
UncoverGame shows StatsModal automatically on game end, with button to re-open
  </done>
</task>

</tasks>

<verification>
1. `pnpm type-check` passes for all modified files
2. `pnpm lint` passes
3. Stats modal renders with correct data
4. Distribution chart highlights today's result when won
5. Modal auto-shows after game completion with slight delay
</verification>

<success_criteria>
- StatsModal component created with Wordle-style layout
- GuessDistributionChart shows horizontal bars with highlight
- UncoverGame shows modal automatically on game end
- View Stats button allows re-opening modal
- All TypeScript types correct
</success_criteria>

<output>
After completion, create `.planning/phases/39-stats-streaks/39-03-SUMMARY.md`
</output>
