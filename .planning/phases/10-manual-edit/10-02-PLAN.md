---
phase: 10-manual-edit
plan: 02
type: execute
wave: 2
depends_on: ['10-01']
files_modified:
  - src/components/admin/correction/manual/EditableField.tsx
  - src/components/admin/correction/manual/ArtistChipsInput.tsx
  - src/components/admin/correction/manual/ExternalIdInput.tsx
  - src/components/admin/correction/manual/DateInput.tsx
  - src/components/admin/correction/manual/ReleaseTypeSelect.tsx
  - src/components/admin/correction/manual/index.ts
autonomous: true

must_haves:
  truths:
    - 'Text fields support click-to-edit with Enter to save, Escape to cancel'
    - 'Artists render as removable chips with add button'
    - 'External ID fields show format hints on focus'
    - 'Clear button (X) explicitly sets field to null'
    - 'All inputs validate on blur, not just submit'
    - 'ArtistChipsInput validates artist count after each add/remove'
    - 'External ID fields distinguish between null (cleared) and empty string (invalid)'
  artifacts:
    - path: 'src/components/admin/correction/manual/EditableField.tsx'
      provides: 'Inline editable text field component'
      exports: ['EditableField']
    - path: 'src/components/admin/correction/manual/ArtistChipsInput.tsx'
      provides: 'Multi-value artist input with chips'
      exports: ['ArtistChipsInput']
    - path: 'src/components/admin/correction/manual/ExternalIdInput.tsx'
      provides: 'External ID input with validation and clear button'
      exports: ['ExternalIdInput']
    - path: 'src/components/admin/correction/manual/DateInput.tsx'
      provides: 'Flexible date input (YYYY, YYYY-MM, YYYY-MM-DD)'
      exports: ['DateInput']
    - path: 'src/components/admin/correction/manual/ReleaseTypeSelect.tsx'
      provides: 'Release type dropdown'
      exports: ['ReleaseTypeSelect']
  key_links:
    - from: 'src/components/admin/correction/manual/ExternalIdInput.tsx'
      to: 'src/components/admin/correction/manual/validation.ts'
      via: 'schema prop for validation'
      pattern: "schema\\.safeParse"
    - from: 'src/components/admin/correction/manual/ArtistChipsInput.tsx'
      to: 'src/components/ui/badge.tsx'
      via: 'Badge component import'
      pattern: 'import.*Badge'
---

<objective>
Create reusable input components for manual field editing.

Purpose: Build the UI atoms for inline editing - editable text, artist chips, date input, external ID inputs with validation. These components are the building blocks for the ManualEditView in Plan 03.

Output: Five specialized input components with consistent interaction patterns.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/10-manual-edit/10-CONTEXT.md
@.planning/phases/10-manual-edit/10-RESEARCH.md
@.planning/phases/10-manual-edit/10-01-SUMMARY.md

@src/components/admin/correction/manual/validation.ts
@src/components/admin/correction/manual/types.ts
@src/components/ui/input.tsx
@src/components/ui/badge.tsx
@src/components/ui/select.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EditableField and ExternalIdInput components</name>
  <files>src/components/admin/correction/manual/EditableField.tsx, src/components/admin/correction/manual/ExternalIdInput.tsx</files>
  <action>
**EditableField.tsx** - Inline editable text field:

Props interface:

- `value: string`
- `onChange: (value: string) => void`
- `label: string`
- `placeholder?: string`
- `schema?: z.ZodType` (optional validation)
- `className?: string`

Behavior:

1. Click-to-edit: Display mode shows value as styled text button
2. Edit mode: Show Input component with autoFocus
3. Enter key: Validate with schema (if provided), save if valid, show error if not
4. Escape key: Revert to original value, exit edit mode
5. onBlur: Same as Enter (validate and save)
6. Error state: Show red border and error message below input
7. Keep edit mode active on validation error (don't lose focus)

Styling:

- Display mode: `text-zinc-100 hover:bg-zinc-800 rounded px-2 py-1 cursor-pointer`
- Edit mode: Standard Input with zinc-800 bg
- Error: `border-red-500` on input, `text-xs text-red-400` for message

**ExternalIdInput.tsx** - External ID with format validation:

Props interface:

- `label: string` (e.g., "MusicBrainz ID")
- `value: string | null`
- `onChange: (value: string | null) => void`
- `schema: z.ZodType` (required - from validation.ts)
- `placeholder: string` (e.g., "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx")
- `hint: string` (e.g., "UUID format")

Behavior:

1. Controlled input with localValue state (initialize with value ?? '')
2. Show hint on focus (below input, text-xs text-zinc-500)
3. Validate on blur using schema.safeParse
4. Show error instead of hint if validation fails
5. Clear button (X icon) at right side when value exists
6. **Null vs empty semantics:**
   - Clear button sets value to `null` (intentionally cleared)
   - Empty string after typing then deleting is NOT automatically null (user may still be typing)
   - On blur with empty string: if schema allows empty, keep empty; otherwise show validation error
   - Pass `null` to onChange when X clicked, pass trimmed string otherwise
7. When X is clicked, also clear localValue state

Styling:

- Dark theme: bg-zinc-800, border-zinc-700
- Clear button: Absolute positioned right-2, text-zinc-500 hover:text-zinc-300
- Use X icon from lucide-react
  </action>
  <verify>Render EditableField, click to edit, type text, press Enter - value updates. Render ExternalIdInput with invalid UUID, blur - error message appears. Click X - onChange called with null.</verify>
  <done>Both components render correctly with validation and clear functionality</done>
  </task>

<task type="auto">
  <name>Task 2: Create ArtistChipsInput component</name>
  <files>src/components/admin/correction/manual/ArtistChipsInput.tsx</files>
  <action>
**ArtistChipsInput.tsx** - Multi-value artist chips:

Props interface:

- `artists: string[]`
- `onChange: (artists: string[]) => void`
- `error?: string` (external error message, e.g., from parent form validation)

Behavior:

1. Display each artist as Badge with "secondary" variant
2. Each chip has X button to remove (handleRemove by index)
3. Input field at end for adding new artists
4. Enter key: Add trimmed value to array if not empty and not duplicate
5. Backspace on empty input: Remove last artist from array
6. After add: Clear input, keep focus for rapid entry
7. **Immediate validation on remove:**
   - After removing an artist, check if array is now empty
   - If empty (last artist removed), immediately show error: "At least one artist required"
   - Error clears when an artist is added back

Chip styling:

- Use existing Badge component with variant="secondary"
- Add gap-1.5 for icon spacing, pl-2.5 pr-1.5 for padding
- X button: hover:bg-zinc-700 rounded-sm p-0.5

Accessibility:

- X button: `role="button"`, `tabIndex={0}`, `aria-label="Remove {artistName}"`
- Support Enter/Space to remove when X button focused
- Tab navigation through chips

Container styling:

- Wrapper: `flex flex-wrap gap-2 p-2 border border-zinc-700 rounded-md bg-zinc-800`
- Input: `flex-1 min-w-[120px] bg-transparent border-none outline-none text-sm text-zinc-100`
- Placeholder: "Add artist name" when empty, "Add another" when not

Error state:

- If artists.length === 0 OR error prop provided: Show `text-xs text-red-400` message below
- Border changes to border-red-500 when in error state
  </action>
  <verify>Render with 2 artists, click X on first - removed. Type "New Artist", press Enter - added as chip. Remove all artists - error appears immediately.</verify>
  <done>Artist chips render with add/remove functionality, keyboard support, and immediate validation on artist count</done>
  </task>

<task type="auto">
  <name>Task 3: Create DateInput and ReleaseTypeSelect components</name>
  <files>src/components/admin/correction/manual/DateInput.tsx, src/components/admin/correction/manual/ReleaseTypeSelect.tsx, src/components/admin/correction/manual/index.ts</files>
  <action>
**DateInput.tsx** - Flexible partial date input:

Props interface:

- `value: string | null`
- `onChange: (value: string | null) => void`
- `label?: string`

Behavior:

1. Text input accepting YYYY, YYYY-MM, or YYYY-MM-DD
2. Validate on blur using partialDateSchema from validation.ts
3. Show hint on focus: "Format: YYYY, YYYY-MM, or YYYY-MM-DD"
4. Show error if format invalid
5. Clear button (X) when value exists
6. Handle null properly (cleared state)

Styling:

- Same as ExternalIdInput (consistent dark theme)
- Placeholder: "e.g., 2024 or 2024-05-15"

**ReleaseTypeSelect.tsx** - Release type dropdown:

Props interface:

- `value: string | null`
- `onChange: (value: string | null) => void`
- `label?: string`

Behavior:

1. Use Radix UI Select component (already installed)
2. Options from RELEASE_TYPES constant: Album, EP, Single, Compilation, Soundtrack, Live, Remix, Other
3. Include "None" or empty option at top to allow clearing
4. Match dark theme styling

Import existing Select primitives:

```typescript
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
```

Import RELEASE_TYPES from validation.ts:

```typescript
import { RELEASE_TYPES } from './validation';
```

**index.ts** - Barrel export:

```typescript
export { EditableField } from './EditableField';
export { ArtistChipsInput } from './ArtistChipsInput';
export { ExternalIdInput } from './ExternalIdInput';
export { DateInput } from './DateInput';
export { ReleaseTypeSelect } from './ReleaseTypeSelect';
export * from './validation';
export * from './types';
```

  </action>
  <verify>Render DateInput with "2024-05", blur - valid. Enter "2024-13", blur - error. ReleaseTypeSelect opens dropdown with all options.</verify>
  <done>All input components created and exported from barrel file</done>
</task>

</tasks>

<verification>
1. Run `pnpm type-check` - no TypeScript errors
2. Create test harness page or Storybook story to verify each component:
   - EditableField: click → edit → Enter saves, Escape cancels
   - ExternalIdInput: UUID validation works, clear button works, null vs empty distinction works
   - ArtistChipsInput: add/remove chips, keyboard navigation, error shows on last artist removal
   - DateInput: partial dates validate correctly
   - ReleaseTypeSelect: dropdown opens, selection works
3. All components use dark theme (zinc-800/700 backgrounds)
</verification>

<success_criteria>

- EditableField supports click-to-edit with Enter/Escape
- ArtistChipsInput renders chips with add/remove and validates artist count after each change
- ExternalIdInput validates format, shows clear button, distinguishes null from empty string
- DateInput accepts flexible date formats
- ReleaseTypeSelect uses Radix UI Select with all options
- All components follow dark theme and zinc color scheme
  </success_criteria>

<output>
After completion, create `.planning/phases/10-manual-edit/10-02-SUMMARY.md`
</output>
