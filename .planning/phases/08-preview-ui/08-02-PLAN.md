---
phase: 08-preview-ui
plan: 02
type: execute
wave: 2
depends_on: [08-01]
files_modified:
  - src/components/admin/correction/preview/InlineTextDiff.tsx
  - src/components/admin/correction/preview/FieldComparison.tsx
  - src/components/admin/correction/preview/FieldComparisonList.tsx
  - src/components/admin/correction/preview/index.ts
autonomous: true

must_haves:
  truths:
    - "Changed text shows inline highlighting (green for added, yellow for modified, red for removed)"
    - "UNCHANGED fields are hidden from the preview"
    - "Each field shows label, current value, and source value with diff"
  artifacts:
    - path: "src/components/admin/correction/preview/InlineTextDiff.tsx"
      provides: "Inline span-based text highlighting from TextDiffPart arrays"
      min_lines: 30
    - path: "src/components/admin/correction/preview/FieldComparison.tsx"
      provides: "Single field diff display with change type badge"
      min_lines: 50
    - path: "src/components/admin/correction/preview/FieldComparisonList.tsx"
      provides: "Renders all fieldDiffs, filtering UNCHANGED"
      min_lines: 40
  key_links:
    - from: "src/components/admin/correction/preview/InlineTextDiff.tsx"
      to: "TextDiffPart type"
      via: "parts prop rendering"
      pattern: "parts\\.map"
    - from: "src/components/admin/correction/preview/FieldComparisonList.tsx"
      to: "fieldDiffs from preview"
      via: "filter and map"
      pattern: "filter.*UNCHANGED"
---

<objective>
Create field-level diff highlighting components for inline text changes.

Purpose: Renders the core diff visualization - showing exactly what text changed in each field with color-coded inline highlighting.
Output: InlineTextDiff, FieldComparison, and FieldComparisonList components ready for integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/08-preview-ui/08-CONTEXT.md
@.planning/phases/08-preview-ui/08-RESEARCH.md
@.planning/phases/08-preview-ui/08-01-SUMMARY.md

# Type definitions
@src/lib/correction/preview/types.ts
@src/graphql/queries/correctionPreview.graphql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create InlineTextDiff component</name>
  <files>
    src/components/admin/correction/preview/InlineTextDiff.tsx
  </files>
  <action>
**InlineTextDiff.tsx:**

Props interface - matches GraphQL TextDiffPart structure:
```typescript
interface TextDiffPart {
  value: string;
  added?: boolean | null;
  removed?: boolean | null;
}

interface InlineTextDiffProps {
  parts: TextDiffPart[];
  className?: string;
}
```

Implementation:
- Render inline span containing mapped parts
- Each part renders as a `<span>` with conditional styling:
  - `added`: `bg-green-500/20 text-green-400` 
  - `removed`: `bg-red-500/20 text-red-400 line-through`
  - unchanged: `text-zinc-300` (no background)
- Use unique key for each span (index is fine, list won't reorder)
- Handle empty parts array gracefully (return null or empty span)

Color scheme follows CONTEXT.md decisions:
- Green for additions (new data from MB)
- Red for removals (data would be lost)
- Yellow/amber reserved for MODIFIED field badges (not inline text)

Export component for use in FieldComparison.
  </action>
  <verify>
TypeScript compiles: `pnpm type-check`
Component correctly types TextDiffPart array prop.
  </verify>
  <done>
InlineTextDiff renders character-level diff highlighting with color-coded spans.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FieldComparison component</name>
  <files>
    src/components/admin/correction/preview/FieldComparison.tsx
  </files>
  <action>
**FieldComparison.tsx:**

Type the fieldDiff union - extract from GraphQL generated types or define locally:
```typescript
type ChangeType = 'ADDED' | 'MODIFIED' | 'REMOVED' | 'CONFLICT' | 'UNCHANGED';

interface FieldDiff {
  field: string;
  changeType: ChangeType;
  currentValue?: string | null;
  sourceValue?: string | null;
  parts?: TextDiffPart[] | null;
  // Additional fields for specific diff types (array, date) - handle generically
}

interface FieldComparisonProps {
  diff: FieldDiff;
}
```

Implementation:
1. **Skip UNCHANGED**: Return null early if `changeType === 'UNCHANGED'`

2. **Field label row**:
   - Format field name: `formatFieldName('releaseDate')` -> "Release Date"
   - Helper function: split on camelCase, capitalize each word
   - Show change type badge next to label:
     - ADDED: `text-green-400` "(New)"
     - MODIFIED: `text-yellow-400` "(Modified)"
     - REMOVED: `text-red-400` "(Removed)"
     - CONFLICT: `text-orange-400` "(Conflict)"

3. **Value display**:
   - Current value: `text-zinc-400` (slightly muted)
   - Source value with diff highlighting:
     - If `diff.parts` exists: render `<InlineTextDiff parts={diff.parts} />`
     - Otherwise: plain text in `text-zinc-200`
   - Use em-dash ("â€”") for null/empty values

4. **Layout**: 
   - Vertical stack with field label at top
   - Two-line display: current then source
   - Border bottom `border-zinc-800` for separation
   - Padding `py-3`

5. **Dark zinc styling** consistent with CurrentDataView patterns.
  </action>
  <verify>
TypeScript compiles: `pnpm type-check`
Component renders field label, current/source values, and inline diff.
  </verify>
  <done>
FieldComparison displays single field diff with change badge and inline highlighting.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create FieldComparisonList and update exports</name>
  <files>
    src/components/admin/correction/preview/FieldComparisonList.tsx
    src/components/admin/correction/preview/index.ts
  </files>
  <action>
**FieldComparisonList.tsx:**

Props interface:
```typescript
interface FieldComparisonListProps {
  fieldDiffs: FieldDiff[];
  artistDiff?: ArtistDiff;  // Special handling for artist credits
}
```

Implementation:
1. **Filter UNCHANGED**: Only show fields with actual changes
   ```typescript
   const changedFields = fieldDiffs.filter(d => d.changeType !== 'UNCHANGED');
   ```

2. **Empty state**: If no changed fields, show "No field changes detected" in zinc-500

3. **Render list**: Map changedFields to FieldComparison components
   - Key by field name (unique within preview)

4. **Artist diff handling** (if artistDiff provided and has changes):
   - Render as special FieldComparison-like element
   - Label: "Artist Credits"
   - Current: `artistDiff.currentDisplay`
   - Source: If `artistDiff.nameDiff`, render InlineTextDiff, else `artistDiff.sourceDisplay`
   - Show change badge based on `artistDiff.changeType`

5. **Container**: `space-y-1 divide-y divide-zinc-800` for subtle separation

**Update index.ts:**
- Export InlineTextDiff, FieldComparison, FieldComparisonList
  </action>
  <verify>
TypeScript compiles: `pnpm type-check`
ESLint passes: `pnpm lint`
List filters out UNCHANGED and renders only changed fields.
  </verify>
  <done>
FieldComparisonList renders all changed fields with diff highlighting, filtering unchanged.
  </done>
</task>

</tasks>

<verification>
- `pnpm type-check` passes
- `pnpm lint` passes
- InlineTextDiff correctly renders green/red highlighted spans
- FieldComparison shows field labels with change badges
- FieldComparisonList filters UNCHANGED fields
</verification>

<success_criteria>
1. Text additions render with green background
2. Text removals render with red background and line-through
3. Field labels show formatted name + change type badge
4. UNCHANGED fields are not rendered
5. Artist credits diff handled specially with name comparison
</success_criteria>

<output>
After completion, create `.planning/phases/08-preview-ui/08-02-SUMMARY.md`
</output>
