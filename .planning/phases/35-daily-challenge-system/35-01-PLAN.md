---
phase: 35-daily-challenge-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/schema.prisma
  - prisma/migrations/XXXXXX_add_curated_challenge_list/migration.sql
autonomous: true

must_haves:
  truths:
    - "CuratedChallenge model stores ordered album list for daily selection"
    - "Admin can pin specific albums to specific dates"
    - "Sequence numbers are unique and contiguous (0, 1, 2, ...)"
  artifacts:
    - path: "prisma/schema.prisma"
      provides: "CuratedChallenge model definition"
      contains: "model CuratedChallenge"
    - path: "prisma/migrations/"
      provides: "Migration for curated_challenges table"
  key_links:
    - from: "CuratedChallenge"
      to: "Album"
      via: "albumId foreign key"
      pattern: "albumId.*@db.Uuid"
---

<objective>
Add CuratedChallenge Prisma model for storing the ordered list of albums used for daily challenge selection.

Purpose: This model stores the admin-curated ordered list of albums. Each album has a sequence number (0, 1, 2, ...) for deterministic date-to-album mapping, and an optional pinnedDate for admin overrides.

Output: Database migration creating curated_challenges table with proper indexes and constraints.
</objective>

<execution_context>
@/Users/marcosandrade/.claude/get-shit-done/workflows/execute-plan.md
@/Users/marcosandrade/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-daily-challenge-system/35-CONTEXT.md
@.planning/phases/35-daily-challenge-system/35-RESEARCH.md
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CuratedChallenge model to Prisma schema</name>
  <files>prisma/schema.prisma</files>
  <action>
Add CuratedChallenge model after UncoverPlayerStats model (around line 672), before the enums section.

Model definition:
```prisma
/// Curated album for daily challenge selection
/// Admin pre-curates an ordered list; selection uses sequence number
model CuratedChallenge {
  id          String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  albumId     String    @map("album_id") @db.Uuid
  album       Album     @relation(fields: [albumId], references: [id], onDelete: Cascade)
  
  sequence    Int       @unique  // Position in ordered list (0, 1, 2, ...)
  pinnedDate  DateTime? @unique @db.Date @map("pinned_date")  // Optional: Force this album on this date
  
  createdAt   DateTime  @default(now()) @map("created_at")
  
  @@index([sequence])
  @@index([pinnedDate])
  @@index([albumId])
  @@map("curated_challenges")
}
```

Also add the relation to the Album model (find the Album model and add to its relations):
```prisma
curatedChallenges CuratedChallenge[]
```

Key constraints:
- sequence is unique (only one album per position)
- pinnedDate is unique (only one album can be pinned to a specific date)
- albumId references Album with Cascade delete
- Uses same UUID pattern as other models
- Uses snake_case table mapping per project convention
  </action>
  <verify>Run `pnpm prisma validate` to confirm schema is valid</verify>
  <done>CuratedChallenge model added to schema.prisma with sequence and pinnedDate fields, Album model has curatedChallenges relation</done>
</task>

<task type="auto">
  <name>Task 2: Run Prisma migration</name>
  <files>prisma/migrations/</files>
  <action>
Run Prisma migration to create the curated_challenges table:

```bash
pnpm prisma migrate dev --name add_curated_challenge_list
```

This will:
1. Create migration SQL file in prisma/migrations/
2. Apply migration to local database
3. Auto-run `prisma generate` to update Prisma client types

After migration, verify the Prisma client has the new types by running:
```bash
pnpm type-check
```
  </action>
  <verify>
1. Migration file created in prisma/migrations/
2. `pnpm type-check` passes
3. Can import CuratedChallenge type from @prisma/client
  </verify>
  <done>Migration applied, curated_challenges table exists in database, TypeScript types generated</done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Schema validation passes: `pnpm prisma validate`
2. Type checking passes: `pnpm type-check`
3. Migration file exists with expected SQL (CREATE TABLE curated_challenges)
4. CuratedChallenge model has:
   - id (UUID, primary key)
   - albumId (UUID, foreign key to Album)
   - sequence (Int, unique)
   - pinnedDate (Date, nullable, unique)
   - createdAt (DateTime)
   - Proper indexes on sequence, pinnedDate, albumId
</verification>

<success_criteria>
- CuratedChallenge model exists in schema.prisma
- Migration successfully applied
- TypeScript compilation passes
- Album model has curatedChallenges relation
</success_criteria>

<output>
After completion, create `.planning/phases/35-daily-challenge-system/35-01-SUMMARY.md`
</output>
