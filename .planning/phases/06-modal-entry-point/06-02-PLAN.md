---
phase: 06-modal-entry-point
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - src/components/admin/correction/CurrentDataView.tsx
  - src/components/admin/correction/DataQualityBadge.tsx
  - src/components/admin/correction/ExternalIdStatus.tsx
  - src/components/admin/correction/TrackListing.tsx
  - src/components/admin/correction/CorrectionModal.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Modal header shows album title and primary artist name"
    - "Current data displays in collapsible accordion sections"
    - "Data quality badge shows Excellent/Good/Fair/Poor based on quality + external IDs"
    - "External IDs show present (with link) or missing status"
    - "Track listing collapses when 30+ tracks"
  artifacts:
    - path: "src/components/admin/correction/CurrentDataView.tsx"
      provides: "Step 1 content with accordion layout"
      exports: ["CurrentDataView"]
    - path: "src/components/admin/correction/DataQualityBadge.tsx"
      provides: "Quality indicator badge"
      exports: ["DataQualityBadge"]
    - path: "src/components/admin/correction/ExternalIdStatus.tsx"
      provides: "External ID status display"
      exports: ["ExternalIdStatus"]
    - path: "src/components/admin/correction/TrackListing.tsx"
      provides: "Track list with auto-collapse"
      exports: ["TrackListing"]
  key_links:
    - from: "src/components/admin/correction/CorrectionModal.tsx"
      to: "src/components/admin/correction/CurrentDataView.tsx"
      via: "component import for Step 0"
      pattern: "currentStep === 0.*CurrentDataView"
    - from: "src/components/admin/correction/CurrentDataView.tsx"
      to: "@/components/ui/accordion"
      via: "accordion import"
      pattern: "Accordion.*AccordionItem"
---

<objective>
Build CurrentDataView with album data display in collapsible sections.

Purpose: Display the current album data prominently in Step 1 of the correction wizard, organized into logical sections (Basic Info, Tracks, External IDs) with quality indicator.
Output: Complete Step 1 content showing all album fields, cover art, and external ID status.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-modal-entry-point/06-RESEARCH.md
@.planning/phases/06-modal-entry-point/06-CONTEXT.md
@.planning/phases/06-modal-entry-point/06-01-SUMMARY.md
@src/components/ui/accordion.tsx
@src/components/ui/AlbumImage.tsx
@prisma/schema.prisma
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataQualityBadge and ExternalIdStatus components</name>
  <files>
    src/components/admin/correction/DataQualityBadge.tsx
    src/components/admin/correction/ExternalIdStatus.tsx
  </files>
  <action>
    1. Create DataQualityBadge component:
       
       Props:
       - quality: DataQuality (from @/generated/graphql - LOW | MEDIUM | HIGH)
       - hasAllExternalIds: boolean (true if musicbrainzId AND spotifyId AND discogsId present)
       - onClick?: () => void (optional, for future detail popover)
       
       Logic:
       - If quality === 'HIGH' && hasAllExternalIds: level = "Excellent"
       - If quality === 'HIGH': level = "Good"
       - If quality === 'MEDIUM': level = "Fair"
       - Else: level = "Poor"
       
       Colors (use project palette):
       - Excellent: bg-emeraled-green text-white
       - Good: bg-maximum-yellow text-black
       - Fair: bg-zinc-600 text-white
       - Poor: bg-dark-pastel-red text-white
       
       Use Badge component from @/components/ui/badge with className override.
       Add cursor-pointer if onClick is provided.
    
    2. Create ExternalIdStatus component:
       
       Props:
       - musicbrainzId: string | null
       - spotifyId: string | null  
       - discogsId: string | null
       
       For each ID, display:
       - Present: CheckCircle2 (emeraled-green) + "{Name}: {truncated ID}" as clickable link to external source
         - MusicBrainz: https://musicbrainz.org/release/{id}
         - Discogs: https://www.discogs.com/release/{id}
         - Spotify: https://open.spotify.com/album/{id}
         - Truncate: MB to 8 chars + "...", Spotify to 12 chars + "..."
         - Add ExternalLink icon (h-3 w-3) after text
       - Missing: XCircle (muted-foreground) + "{Name}" in muted text
       
       Layout: horizontal row with gap-3, wrap on small screens
       Use Tooltip from @/components/ui/tooltip to show full ID on hover
       Open links in new tab (target="_blank", rel="noopener noreferrer")
       
       Import icons from lucide-react: CheckCircle2, XCircle, ExternalLink
  </action>
  <verify>
    - Both components render without errors
    - npm run type-check passes
  </verify>
  <done>
    Quality badge shows 4-level status, external IDs show present/missing with links.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TrackListing component</name>
  <files>src/components/admin/correction/TrackListing.tsx</files>
  <action>
    Create TrackListing component for displaying album tracks:
    
    Props:
    - tracks: Array of { trackNumber: number; title: string; durationMs: number | null; discNumber?: number }
    
    Features:
    1. Auto-collapse threshold: 30 tracks
       - If less than 30 tracks: showAll = true (all visible by default)
       - If 30 or more tracks: showAll = false (show first 10, "Show all X tracks" button)
    
    2. Track display:
       - Ordered list (ol) with space-y-1
       - Each track: "{trackNumber}. {title}" on left, duration on right
       - Duration format: mm:ss (e.g., "3:45")
       - If durationMs is null, show dash character
       - If multiple discs, group by discNumber and show "Disc {N}" headers
    
    3. Expand/collapse button:
       - Use Button variant="ghost" size="sm"
       - Full width (w-full)
       - ChevronDown when collapsed, ChevronUp when expanded
       - Text: "Show all {count} tracks" / "Show less"
    
    Helper function formatDuration(ms: number | null):
    - If null, return dash
    - Calculate minutes = Math.floor(ms / 60000)
    - Calculate seconds = Math.floor((ms % 60000) / 1000)
    - Return formatted string with padded seconds
  </action>
  <verify>
    - Component renders track list properly
    - Collapse/expand works for 30+ tracks
    - npm run type-check passes
  </verify>
  <done>
    TrackListing displays tracks with auto-collapse for large albums.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create CurrentDataView and integrate into CorrectionModal</name>
  <files>
    src/components/admin/correction/CurrentDataView.tsx
    src/components/admin/correction/CorrectionModal.tsx
  </files>
  <action>
    1. Create CurrentDataView component:
       
       Props:
       - album: object with album fields (will type with GraphQL types)
         - id, title, releaseDate, releaseType, coverArtUrl, cloudflareImageId
         - musicbrainzId, spotifyId, discogsId
         - dataQuality, label, barcode
         - tracks: Array of {trackNumber, title, durationMs, discNumber}
         - artists: Array of {artist: {id, name}, role, position}
       
       Layout:
       - Top section: Cover art (left) + quality badge + album title + primary artist (right)
         - Cover art: Use AlbumImage from @/components/ui/AlbumImage, size w-32 h-32
         - Pass cloudflareImageId when available for optimized delivery
         - Quality badge: position prominently near title
       
       - Accordion sections (use Accordion type="multiple" with all sections expanded by default):
         
         a) "Basic Info" section:
            - Title: album.title
            - Primary Artist: first artist with role "primary" or position 0
            - Release Date: formatted date or dash
            - Release Type: album.releaseType or dash
            - Label: album.label or dash
            - Barcode: album.barcode or dash
            - Display as definition list (dl/dt/dd pairs)
         
         b) "Tracks ({count})" section:
            - Use TrackListing component
            - Pass tracks array
         
         c) "External IDs" section:
            - Use ExternalIdStatus component
            - Pass musicbrainzId, spotifyId, discogsId
       
       Default expanded sections: ["basic", "tracks", "external-ids"]
       Reset to expanded when key changes (use key={album.id} on Accordion or reset state in useEffect)
    
    2. Update CorrectionModal:
       
       - Accept album prop (same type as CurrentDataView expects)
       - Update header title: "Fixing: {album.title} by {primaryArtistName}"
       - Replace Step 0 placeholder with CurrentDataView component with album prop
       - Keep Steps 1 and 2 as placeholders for future phases
  </action>
  <verify>
    - CurrentDataView renders album data in accordion layout
    - CorrectionModal shows album title in header
    - npm run type-check passes
    - npm run lint passes (fix any issues)
  </verify>
  <done>
    Complete Step 1 content showing album data with collapsible sections.
  </done>
</task>

</tasks>

<verification>
- npm run type-check passes
- npm run lint passes
- All new components properly typed and exported
- CurrentDataView displays all required album fields
</verification>

<success_criteria>
- Modal header shows album title and primary artist
- Cover art displays with proper sizing (w-32 h-32)
- Data quality badge shows correct 4-level status
- External IDs show present (clickable) or missing states
- Tracks auto-collapse when 30+
- All sections expand/collapse via accordion
</success_criteria>

<output>
After completion, create `.planning/phases/06-modal-entry-point/06-02-SUMMARY.md`
</output>
