---
phase: 06-modal-entry-point
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/accordion.tsx
  - src/components/admin/correction/CorrectionModal.tsx
  - src/components/admin/correction/StepIndicator.tsx
  - src/hooks/useCorrectionModalState.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "CorrectionModal opens when albumId is set"
    - "Modal displays 3-step indicator (Current Data, Search, Apply)"
    - "Modal closes on X button and Escape key"
    - "Step state persists in sessionStorage per album"
  artifacts:
    - path: "src/components/ui/accordion.tsx"
      provides: "shadcn accordion primitive"
      min_lines: 40
    - path: "src/components/admin/correction/CorrectionModal.tsx"
      provides: "Main modal component with step navigation"
      exports: ["CorrectionModal"]
    - path: "src/components/admin/correction/StepIndicator.tsx"
      provides: "Step navigation UI"
      exports: ["StepIndicator"]
    - path: "src/hooks/useCorrectionModalState.ts"
      provides: "Session storage state hook"
      exports: ["useCorrectionModalState"]
  key_links:
    - from: "src/components/admin/correction/CorrectionModal.tsx"
      to: "src/hooks/useCorrectionModalState.ts"
      via: "hook import"
      pattern: "useCorrectionModalState"
---

<objective>
Create CorrectionModal shell with step navigation and session persistence.

Purpose: Establish the modal container and navigation infrastructure for the 3-step correction wizard. Later plans will fill in step content (CurrentDataView, SearchView, ApplyView).
Output: Functional modal that opens/closes with step indicator, persists state in sessionStorage.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-modal-entry-point/06-RESEARCH.md
@.planning/phases/06-modal-entry-point/06-CONTEXT.md
@src/components/ui/dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn accordion and create session state hook</name>
  <files>
    src/components/ui/accordion.tsx
    src/hooks/useCorrectionModalState.ts
  </files>
  <action>
    1. Run `npx shadcn@latest add accordion` to install the accordion component.
    
    2. Create useCorrectionModalState hook at src/hooks/useCorrectionModalState.ts:
       - Accept albumId: string | null parameter
       - Manage currentStep state (0-indexed, 3 steps total)
       - Storage key pattern: `correction-modal-state-{albumId}`
       - On albumId change: load state from sessionStorage if exists, else reset to step 0
       - On currentStep change: save to sessionStorage
       - Provide clearState() function to remove storage on modal close or apply success
       - Export interface for ModalState: { currentStep: number }
       
    Note: Use native sessionStorage with JSON.parse/stringify. No external library needed.
  </action>
  <verify>
    - accordion.tsx exists in src/components/ui/
    - useCorrectionModalState.ts exports the hook
    - npm run type-check passes
  </verify>
  <done>
    Accordion primitive installed, session state hook ready for modal integration.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StepIndicator component</name>
  <files>src/components/admin/correction/StepIndicator.tsx</files>
  <action>
    Create StepIndicator component that shows the 3-step wizard progress:
    
    Props:
    - currentStep: number (0, 1, or 2)
    - onStepClick: (step: number) => void
    - steps: string[] = ["Current Data", "Search", "Apply"]
    
    UI requirements:
    - Horizontal layout with numbered circles connected by lines
    - Current step: cosmic-latte fill, black text
    - Other steps: muted-foreground text, border only
    - Completed line segments: cosmic-latte color
    - Pending line segments: muted-foreground color
    - Steps are clickable buttons for free navigation
    - Hide step labels on small screens (sm:inline)
    - Use cn() from @/lib/utils for className merging
    - ARIA: nav element with aria-label="Progress"
    
    Circle sizing: h-8 w-8, rounded-full, border-2
    
    Use Tailwind classes from project color palette (cosmic-latte, muted-foreground).
  </action>
  <verify>
    - Component renders 3 steps with proper styling
    - npm run type-check passes
  </verify>
  <done>
    StepIndicator displays progress and allows step navigation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create CorrectionModal shell</name>
  <files>src/components/admin/correction/CorrectionModal.tsx</files>
  <action>
    Create CorrectionModal component using shadcn Dialog:
    
    Props:
    - albumId: string | null
    - open: boolean
    - onClose: () => void
    
    Structure:
    1. Use Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter from @/components/ui/dialog
    2. DialogContent: className="sm:!max-w-[1100px] max-h-[90vh] overflow-y-auto"
       - The ! prefix is required to override shadcn's built-in max-w-lg
    3. DialogHeader: "Fixing: Album Data" (placeholder - album title comes in Plan 02)
    4. Integrate useCorrectionModalState(albumId) for step management
    5. Add StepIndicator below header
    6. Step content area: placeholder divs for now
       - Step 0: "Current Data content here"
       - Step 1: "Search content here"
       - Step 2: "Apply content here"
    7. DialogFooter: sticky at bottom with navigation buttons
       - Cancel button (always visible, calls onClose after clearState)
       - Back button (visible when currentStep > 0)
       - Next button (visible when currentStep < 2)
       - Apply button (visible when currentStep === 2, disabled for now)
    
    Close behavior:
    - Call clearState() then onClose() when closing
    - Handle Escape via Dialog's onOpenChange
    - No click-outside close (default shadcn behavior is fine - onOpenChange handles it)
    
    Button variants:
    - Cancel: variant="outline"
    - Back: variant="outline"
    - Next: variant="default" (primary)
    - Apply: variant="default" with disabled state
  </action>
  <verify>
    - Component compiles without TypeScript errors
    - npm run type-check passes
    - Modal structure matches specification
  </verify>
  <done>
    CorrectionModal shell ready with step navigation, placeholders for step content.
  </done>
</task>

</tasks>

<verification>
- npm run type-check passes
- All files exist in correct locations
- Accordion component properly installed
- Modal can be tested by temporarily importing in admin page
</verification>

<success_criteria>
- CorrectionModal component exported and typed
- StepIndicator shows 3 clickable steps
- useCorrectionModalState manages step with sessionStorage
- Modal fits extra-large width (1100px)
- Close behavior works (X button, Escape)
</success_criteria>

<output>
After completion, create `.planning/phases/06-modal-entry-point/06-01-SUMMARY.md`
</output>
