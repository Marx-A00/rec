---
phase: 22-discogs-album-search
plan: 03
type: execute
wave: 3
depends_on: ['22-02']
files_modified:
  - src/components/admin/correction/search/SearchView.tsx
  - src/components/admin/correction/search/SearchResultCard.tsx
autonomous: true

must_haves:
  truths:
    - 'SearchView calls Discogs query when source is discogs'
    - 'Discogs results appear in same card format as MusicBrainz'
    - 'Discogs cards have subtle visual distinction (accent color)'
    - 'Selecting Discogs result transitions to preview step'
  artifacts:
    - path: 'src/components/admin/correction/search/SearchView.tsx'
      provides: 'Source-aware query selection'
      contains: 'source: correctionSource'
    - path: 'src/components/admin/correction/search/SearchResultCard.tsx'
      provides: 'Visual distinction for Discogs results'
      contains: "source === 'discogs'"
  key_links:
    - from: 'src/components/admin/correction/search/SearchView.tsx'
      to: 'src/generated/graphql.ts'
      via: 'useSearchCorrectionCandidatesQuery with source param'
      pattern: 'source:.*correctionSource'
    - from: 'src/components/admin/correction/search/SearchResultCard.tsx'
      to: 'result.source'
      via: 'Conditional styling based on source'
      pattern: 'isDiscogs|source.*discogs'
---

<objective>
Wire frontend to use Discogs search when source toggle is set to discogs.

Purpose: Admin sees Discogs album search results in correction modal.
Output: SearchView passes source to GraphQL, results display with Discogs styling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/22-discogs-album-search/22-CONTEXT.md
@.planning/phases/22-discogs-album-search/22-02-SUMMARY.md

<!-- Existing frontend components -->

@src/components/admin/correction/search/SearchView.tsx
@src/components/admin/correction/search/SearchResultCard.tsx
@src/components/admin/correction/search/SearchResults.tsx
@src/stores/useCorrectionStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Pass source to GraphQL query</name>
  <files>
    src/components/admin/correction/search/SearchView.tsx
  </files>
  <action>
1. Import CorrectionSource enum if available, or use string literal:
   ```typescript
   import { CorrectionSource } from '@/generated/graphql';
   ```

2. Update the useSearchCorrectionCandidatesQuery call to include source parameter.
   Find the existing query call and add source to input:

   ```typescript
   const { data, isLoading, error, isFetching } =
     useSearchCorrectionCandidatesQuery(
       {
         input: {
           albumId: album.id,
           albumTitle: currentQuery.albumTitle,
           artistName: currentQuery.artistName,
           limit: 10,
           offset: searchOffset,
           source:
             correctionSource === 'discogs'
               ? CorrectionSource.Discogs
               : CorrectionSource.Musicbrainz,
         },
       },
       {
         // Remove the correctionSource === 'musicbrainz' condition
         // Query should run for BOTH sources now
         enabled:
           isSearchTriggered &&
           !!(currentQuery.albumTitle || currentQuery.artistName),
       }
     );
   ```

3. Remove or update any comments that say "Discogs not implemented yet".

4. If there's a separate Discogs query variable (discogsQuery), remove it â€” we now use single unified query with source parameter.

5. Update any error handling to work for both sources (remove MusicBrainz-specific checks).
   </action>
   <verify>
   TypeScript compiles: `pnpm type-check`
   </verify>
   <done>
   SearchView passes correctionSource to GraphQL query, enabling Discogs search when source is 'discogs'.
   </done>
   </task>

<task type="auto">
  <name>Task 2: Add visual distinction for Discogs results</name>
  <files>
    src/components/admin/correction/search/SearchResultCard.tsx
  </files>
  <action>
1. Check if SearchResultCard receives the result object with source field. The result type should include `source: 'musicbrainz' | 'discogs'`.

2. Add source-based styling. Find the card container element and add conditional classes:

   ```typescript
   // At component level, determine if Discogs
   const isDiscogs = result.source === 'discogs';

   // Apply to card container (look for the main button/div element)
   const cardClasses = cn(
     'w-full flex gap-3 p-3 rounded-md transition-colors',
     isDiscogs
       ? 'border border-orange-900/30 hover:bg-orange-950/20'
       : 'hover:bg-zinc-800/50'
   );
   ```

3. Optionally add a small source indicator badge (if not already shown elsewhere):

   ```typescript
   // In the card content, near the title or in corner
   {isDiscogs && (
     <span className="text-[10px] font-medium text-orange-400/70 uppercase tracking-wide">
       DG
     </span>
   )}
   ```

   Note: Phase 21-03 added source badges to PreviewView. The search card can have a more subtle indicator.

4. Ensure cover art URL handling works for Discogs (uses direct URI, not CAA pattern). The AlbumImage component should handle both gracefully.
   </action>
   <verify>
   TypeScript compiles: `pnpm type-check`
   </verify>
   <done>
   Discogs result cards have subtle orange accent styling, visually distinguishing them from MusicBrainz results.
   </done>
   </task>

<task type="auto">
  <name>Task 3: Verify result selection flow</name>
  <files>
    src/components/admin/correction/search/SearchView.tsx
    src/components/admin/correction/search/SearchResults.tsx
  </files>
  <action>
1. Verify that clicking a Discogs result calls the same selectResult action:
   ```typescript
   const handleResultClick = (result: GraphQLScoredResult) => {
     selectResult(result.releaseGroupMbid);
   };
   ```
   
   This should work unchanged since Discogs uses master ID in releaseGroupMbid field.

2. Verify the store's selectResult action doesn't have MusicBrainz-specific assumptions. It should just store the selected ID and transition to preview step.

3. Check SearchResults component passes source through to SearchResultCard:
   - If SearchResultCard receives full result object, source is included
   - If only specific fields are passed, ensure source is added to props

4. Test flow mentally:
   - Admin selects "Discogs" in source toggle
   - Admin types search query and clicks Search
   - GraphQL query runs with source: DISCOGS
   - Resolver calls DiscogsAlbumSearchService
   - Results return with source: 'discogs'
   - Cards render with orange accent
   - Admin clicks result
   - selectResult stores the Discogs master ID
   - Step transitions to preview (Phase 23 will handle preview for Discogs)
     </action>
     <verify>
     `pnpm type-check` passes
     `pnpm lint` passes or only unrelated warnings
     </verify>
     <done>
     Discogs result selection uses same flow as MusicBrainz, storing master ID for preview step.
     </done>
     </task>

</tasks>

<verification>
1. `pnpm type-check` passes
2. `pnpm lint` passes (or only unrelated warnings)
3. SearchView imports CorrectionSource enum
4. GraphQL query includes source in input
5. SearchResultCard has conditional Discogs styling
6. No TypeScript errors in search components
</verification>

<success_criteria>

- Toggling to Discogs and searching shows Discogs album results
- Discogs results have subtle orange border/accent
- Clicking Discogs result stores selection (preview handled in Phase 23)
- Same card format displays album cover, title, artist, year
  </success_criteria>

<output>
After completion, create `.planning/phases/22-discogs-album-search/22-03-SUMMARY.md`
</output>
