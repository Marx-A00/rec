# Requirements Archive: v1.1 Zustand Correction Modal Refactor

**Archived:** 2026-02-05
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.1.
For current requirements, see `.planning/PROJECT.md` (requirements section).

---

## v1.1 Requirements

### Album Store

- [x] **ASTORE-01**: Zustand store created with full CorrectionState + CorrectionActions interfaces
- [x] **ASTORE-02**: Persist middleware with custom sessionStorage adapter keyed by albumId
- [x] **ASTORE-03**: Selective persistence via partialize (step, mode, query, offset, selectedMbid, manualEditState only)
- [x] **ASTORE-04**: Derived selectors exported as standalone functions (isFirstStep, isLastStep, maxStep, stepLabels, isManualEditMode)
- [x] **ASTORE-05**: Atomic action for selectResult (sets mbid + advances step in one set())
- [x] **ASTORE-06**: Atomic action for setPreviewLoaded (sets previewData + applySelections + resets shouldEnrich in one set())
- [x] **ASTORE-07**: Atomic action for enterSearch/enterManualEdit (mode + step + cleanup in one set())
- [x] **ASTORE-08**: Unsaved changes dialog actions (show, confirm discard, cancel)

### Album Modal Refactor

- [x] **AMODAL-01**: CorrectionModal reads state from useCorrectionStore instead of useState calls
- [x] **AMODAL-02**: CorrectionModal initializes store on open, resets on close
- [x] **AMODAL-03**: Mutation callbacks stay in CorrectionModal (toast + store + queryClient orchestration)

### Album Child Component Refactor

- [x] **ACHILD-01**: SearchView props reduced to `album` only — reads search state from store
- [x] **ACHILD-02**: PreviewView props reduced to `albumId` only — reads selectedResultMbid from store
- [x] **ACHILD-03**: PreviewView preserves lastPreviewKeyRef guard against useEffect loops
- [x] **ACHILD-04**: ApplyView props reduced to `albumId + error` only — reads preview, selections, enrichment from store
- [x] **ACHILD-05**: ManualEditView props reduced to `album` only — reads manualEditState from store
- [x] **ACHILD-06**: ManualEditView internal form state (formState, errors, showValidationBanner) stays as local useState

### Artist Store

- [x] **XSTORE-01**: Zustand store created with ArtistCorrectionState + ArtistCorrectionActions interfaces
- [x] **XSTORE-02**: Persist middleware with custom sessionStorage adapter keyed by artistId
- [x] **XSTORE-03**: Selective persistence via partialize (step, query, offset, selectedMbid only)
- [x] **XSTORE-04**: Atomic action for selectResult (sets mbid + advances step)
- [x] **XSTORE-05**: Atomic action for setPreviewLoaded (sets previewData)

### Artist Modal Refactor

- [x] **XMODAL-01**: ArtistCorrectionModal reads state from useArtistCorrectionStore instead of useState calls
- [x] **XMODAL-02**: ArtistCorrectionModal initializes store on open, resets on close

### Artist Child Component Refactor

- [x] **XCHILD-01**: ArtistSearchView props reduced to `artist` only
- [x] **XCHILD-02**: ArtistPreviewView props reduced to `artistId` only
- [x] **XCHILD-03**: ArtistApplyView props reduced to `artistId + onApply + isApplying + error` only

### Cleanup

- [x] **CLEAN-01**: useCorrectionModalState.ts deleted with zero remaining imports
- [x] **CLEAN-02**: useArtistCorrectionModalState.ts deleted with zero remaining imports
- [x] **CLEAN-03**: Zero `any` types introduced across all changes
- [x] **CLEAN-04**: StepIndicator stays prop-driven (reused by both modals)

---

## Traceability

**Phase 13: Album Correction Store**
- ASTORE-01 through ASTORE-08 → Phase 13
- AMODAL-01 through AMODAL-03 → Phase 13
- ACHILD-01 through ACHILD-06 → Phase 13
- CLEAN-01, CLEAN-03, CLEAN-04 → Phase 13

**Phase 14: Artist Correction Store**
- XSTORE-01 through XSTORE-05 → Phase 14
- XMODAL-01, XMODAL-02 → Phase 14
- XCHILD-01 through XCHILD-03 → Phase 14
- CLEAN-02, CLEAN-03 → Phase 14

---

## Milestone Summary

**Shipped:** 30 of 30 v1.1 requirements

**Adjusted:** None — all requirements implemented as specified

**Dropped:** None

---

_Archived: 2026-02-05 as part of v1.1 milestone completion_
