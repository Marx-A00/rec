# Project Research Summary

**Project:** Daily Album Art Game  
**Domain:** Daily guessing game with progressive image reveal  
**Researched:** 2026-02-12  
**Confidence:** HIGH

## Executive Summary

The daily album art guessing game is a well-understood genre with clear patterns from Wordle and its derivatives (Framed, Heardle, Gamedle). The research indicates that success depends on three pillars: **server-side answer security** (never expose the correct album to the client before completion), **consistent timezone handling** (UTC everywhere to prevent streak loss), and **native image manipulation** (Canvas API for pixelation, CSS filter for blur). The existing rec codebase already provides 80% of the needed infrastructure including Zustand state management, Cloudflare Images for CORS-safe image delivery, and a mature GraphQL/Prisma stack.

The recommended approach is to prototype two reveal styles (CSS blur and Canvas pixelation) early to determine which provides better gameplay feel, then build the full game state system. The Wordle-style share grid is non-negotiable for virality - 23.5M tweets in Wordle's first months came from the emoji share format. The unique differentiator for this platform is **music discovery integration**: after playing, users can discover the album, add it to collections, and explore recommendations - features that competitors like PopIdle and Albumle completely lack.

Key risks include CORS issues when manipulating external images (mitigated by using existing Cloudflare Images infrastructure), hydration mismatches with Next.js SSR (mitigated by Zustand's skipHydration pattern), and Safari's aggressive localStorage clearing (mitigated by server-side persistence for authenticated users). All identified pitfalls have documented prevention strategies and existing codebase patterns to follow.

## Key Findings

### Recommended Stack

No new libraries required. The existing stack handles everything.

**Core technologies:**

- **Canvas API** (native): Pixelation via downscale/upscale with `imageSmoothingEnabled: false` - no library overhead
- **CSS filter: blur()** (native): Hardware-accelerated blur reveal - trivial implementation, smooth transitions
- **Zustand with persist** (existing): State management with localStorage persistence - already in use for multiple stores
- **Cloudflare Images** (existing): CORS-safe image delivery via `cloudflareImageId` - avoids tainted canvas errors
- **BullMQ** (existing): Daily challenge selection via scheduled job at UTC midnight

**Avoid:**

- Konva.js/fabric.js: 50KB+ overhead for two simple effects
- Cloudflare blur transforms: URL parameters can be stripped by users, unsuitable for game mechanics
- Server-side image processing: Adds latency and cost when client-side is instant

### Expected Features

**Must have (table stakes):**

- Single daily puzzle, same for all players
- 5-6 guess limit with progressive reveal
- Autocomplete search against album database
- Win/lose state with answer reveal
- Streak tracking (current + max)
- Guess distribution statistics
- Spoiler-free emoji share grid
- One-click copy to clipboard

**Should have (competitive):**

- "Discover this album" CTA after game (unique platform advantage)
- Year arrow feedback on wrong guess (older/newer hint)
- Genre/decade hints as progressive reveal
- Archive mode for past puzzles
- Streak freeze mechanism (earned reward)

**Defer (v2+):**

- Multiple game modes (hard mode, speed mode)
- Friends leaderboard
- Timer mode
- Push notifications
- Custom puzzle creator

### Architecture Approach

The architecture follows a hybrid state model: client-side game state (Zustand + localStorage) for immediate UX with server-side persistence for authenticated users. The daily challenge is generated by a BullMQ scheduled job at UTC midnight, selecting from albums that have `cloudflareImageId` and `dataQuality >= MEDIUM`. The data model introduces four new Prisma models: `DailyChallenge` (one per day), `GameSession` (one per user per challenge), `GameGuess` (one per attempt), and `PlayerGameStats` (denormalized aggregates for fast lookup).

**Major components:**

1. **Challenge Service** - Daily album selection, scheduling, admin queue management
2. **Session Service** - Game state management, start/resume logic, optimistic locking via `playedAt`
3. **Guess Service** - Validation, hint progression, server-side answer comparison
4. **Stats Service** - Streak calculation, distribution updates, leaderboard queries

### Critical Pitfalls

1. **Answer exposed in frontend code** - NEVER send correct album to client before completion; use server-side validation only. Wordle was publicly exploited for this vulnerability.

2. **Timezone desync causes streak loss** - Use UTC everywhere, reset at UTC midnight, allow 25-hour grace period between plays. Document reset time clearly for users.

3. **Canvas tainted by CORS** - Only use Cloudflare Images (already have `cloudflareImageId` on albums) for game images. External URLs will break pixelation effects.

4. **localStorage hydration mismatch** - Use Zustand's `skipHydration: true` and manual rehydrate in useEffect. Server renders default state, client hydrates with localStorage.

5. **Safari clears localStorage aggressively** - Store authoritative state server-side for authenticated users; localStorage is cache only. Prevents streak loss for 15%+ of mobile users.

## Implications for Roadmap

Based on research, suggested phase structure:

### Phase 1: Foundation

**Rationale:** Security and timezone decisions must be baked into architecture from day one. Changing these later requires full rewrites. Canvas CORS handling must be validated before building reveal mechanics.
**Delivers:** Database schema, BullMQ challenge scheduler, Cloudflare image validation
**Addresses:** Single daily puzzle (table stakes), consistent reset time
**Avoids:** Answer exposure pitfall, timezone desync pitfall, CORS tainted canvas pitfall
**Research flag:** SKIP - well-documented patterns from Wordle clones

### Phase 2: Image Reveal Prototype

**Rationale:** The two reveal styles (pixelation vs blur) have different UX feels and performance characteristics. Must prototype both before committing to UI implementation. Blur performance varies wildly by browser (Firefox issue documented).
**Delivers:** `ObscuredAlbumImage` component with both reveal modes, performance testing across browsers
**Uses:** Canvas API, CSS filter, existing AlbumImage patterns
**Implements:** Core visual mechanic
**Avoids:** Blur performance pitfall, high-DPI blurriness pitfall, image not loaded pitfall
**Research flag:** SKIP - MDN documentation is authoritative

### Phase 3: Game State Management

**Rationale:** Depends on Phase 1 schema. State management patterns (Zustand persist, hydration) must be correct before building UI that depends on them.
**Delivers:** `useDailyGameStore`, server/client sync for authenticated users, localStorage fallback for anonymous
**Uses:** Zustand with persist middleware (existing pattern)
**Implements:** Session tracking, guess history, hint progression
**Avoids:** Hydration mismatch pitfall, Safari localStorage pitfall
**Research flag:** SKIP - existing Zustand patterns in codebase

### Phase 4: Guess Input and Validation

**Rationale:** Autocomplete search already exists in codebase (SimpleSearchBar, UniversalSearchBar). Server-side validation is critical path for security.
**Delivers:** Album autocomplete integrated with game flow, server-side guess validation
**Addresses:** Autocomplete search (table stakes)
**Avoids:** Autocomplete reveals answer pitfall (randomize order, require 3+ chars)
**Research flag:** SKIP - extending existing search components

### Phase 5: Streaks and Statistics

**Rationale:** Depends on completed game state system from Phase 3. Streak logic must handle timezone edge cases correctly.
**Delivers:** `PlayerGameStats` updates, streak calculation, win distribution histogram
**Addresses:** Streak tracking, guess distribution (table stakes)
**Uses:** Prisma transactions for atomic stat updates
**Research flag:** SKIP - straightforward database aggregations

### Phase 6: Share and Discovery

**Rationale:** Share grid is critical for virality but depends on completed game flow. Discovery integration is the unique differentiator.
**Delivers:** Emoji share grid, clipboard copy, "Discover Album" CTA, collection integration
**Addresses:** Spoiler-free share (table stakes), discovery integration (differentiator)
**Research flag:** SKIP - standard clipboard API and existing album detail pages

### Phase Ordering Rationale

- **Security first:** Phases 1 and 4 establish server-side validation before any UI exposes game flow
- **Prototype early:** Phase 2 validates the core visual mechanic before heavy investment in UI
- **Dependencies respected:** Phase 3 depends on Phase 1 schema; Phase 5 depends on Phase 3 state
- **Differentiators last:** Phase 6 adds unique platform value once core game works
- **Pitfall mapping:** Each phase explicitly addresses pitfalls from research

### Research Flags

**Phases needing deeper research during planning:** None - all patterns are well-documented or exist in codebase

**Phases with standard patterns (skip /gsd:research-phase):**

- **Phase 1:** Wordle-style daily game architecture is extensively documented
- **Phase 2:** Canvas API and CSS filter usage covered by MDN
- **Phase 3:** Zustand persist patterns already implemented in this codebase
- **Phase 4:** Search components already exist, just need integration
- **Phase 5:** Standard database aggregations
- **Phase 6:** Clipboard API and existing UI patterns

## Confidence Assessment

| Area | Confidence | Notes |
|------|------------|-------|
| Stack | HIGH | No new libraries needed; Canvas API and CSS filter well-documented by MDN |
| Features | HIGH | Wordle/Framed/Heardle provide clear template; 10+ games researched |
| Architecture | HIGH | Follows existing Prisma/GraphQL/Zustand patterns in codebase |
| Pitfalls | HIGH | Verified with official security research, Mozilla bugs, game developer accounts |

**Overall confidence:** HIGH

### Gaps to Address

- **Album selection criteria:** Need to define filters for eligible challenge albums (data quality, cover art availability, genre diversity)
- **Hint progression order:** Exact sequence of progressive hints (genre first? year? track count?) needs UX decision
- **Share format:** Specific emoji grid design (what emoji represents each guess state) needs design input
- **Anonymous play scope:** Decide if fully anonymous play is supported or if auth is required for stats

## Sources

### Primary (HIGH confidence)

- MDN: Canvas API, cross-origin images, CSS filter, devicePixelRatio, image-rendering
- Zustand documentation: persist middleware, skipHydration pattern
- Mozilla Bugzilla: CSS blur performance issues (Bug 925025, Bug 1498291)
- SiliconANGLE: Wordle API vulnerability disclosure

### Secondary (MEDIUM confidence)

- Wordle Wikipedia: Core mechanics, viral statistics (23.5M tweets)
- Framed, Heardle, Gamedle: Feature comparison, progressive reveal patterns
- Josh Comeau: localStorage React patterns
- Chess.com forums: Streak reset user complaints (timezone issues)

### Tertiary (LOW confidence)

- The Daily Spell devlog: Safari localStorage clearing (single developer account, but validated by Apple ITP documentation)
- Unity discussions: Daily game seed generation patterns

---

_Research completed: 2026-02-12_  
_Ready for roadmap: yes_
